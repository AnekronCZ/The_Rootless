#textdomain wesnoth-rtl

#define CHECK_VARIABLE NAME VALUE
    [variable]
        name={NAME}
        equals={VALUE}
    [/variable]
#enddef

#define HINT MESSAGE
    notes_string= _ "Hint:"

    [note]
        description={MESSAGE}
    [/note]
#enddef

#define LOGALMIER_APPEARS
    [unit]
        type=Elvish Champion Kalian
        id=Lord Logalmier
        name=_ "Lord Logalmier"
        canrecruit=yes
        profile="portraits/logalmier.png"
        x,y=3,44
        [modifications]
            {PLOT_ARMOR}
        [/modifications]
        facing=ne
        side=4
    [/unit]

    [unit]
        type=Elvish Ranger
        x,y=2,44
        facing=ne
        side=4
    [/unit]

    [unit]
        type=Elvish Hero
        x,y=2,43
        facing=ne
        side=4
    [/unit]

    [unit]
        type=Elvish Marksman
        x,y=3,43
        facing=ne
        side=4
    [/unit]

    [unit]
        type=Cavalryman
        x,y=4,43
        facing=ne
        side=2
    [/unit]

    [unit]
        type=Elvish Outrider
        name=Lethir
        id=Lethir
        x,y=4,44
        facing=ne
        side=4
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
    [/unit]

    [unit]
        type=Elvish Hero
        x,y=1,42
        facing=ne
        side=4
    [/unit]

    [unit]
        type=Elvish Rider
        x,y=2,42
        facing=ne
        side=4
    [/unit]

    [unit]
        type=Elvish Marksman
        x,y=1,43
        facing=ne
        side=4
    [/unit]

    [unit]
        type=Elvish Captain
        x,y=1,44
        facing=ne
        side=4
    [/unit]

#enddef

#define ELVISH_ARMY

    [while]
        [not]
            [have_unit]
                side=4
                count=20-99
            [/have_unit]
        [/not]
            [and]
                [variable]
                    name=elvish_units
                    less_than=5
                [/variable]
            [/and]

        [do]

            [set_variable]  
                name=elvish_army 
                rand=Elvish Rider,Elvish Rider,Elvish Hero,Elvish Ranger,Elvish Rider
            [/set_variable]

            [unit]
                type=$elvish_army
                placement=leader
                facing=ne
                side=4
            [/unit]

            {VARIABLE_OP elvish_units add 1}

        [/do]

    [/while]

#enddef

#define ELENSEFAR_DEFENDERS

    [unit]
        type=Spearman
        x,y=14,11
        facing=ne
        side=2
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
    [/unit]

    [unit]
        type=Bowman
        x,y=16,11
        facing=se
        side=2
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
    [/unit]

    [unit]
        type=Pikeman
        x,y=18,12
        facing=ne
        side=2
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
    [/unit]

    [unit]
        type=Spearman
        x,y=12,18
        facing=se
        side=2
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
    [/unit]

    [unit]
        type=Longbowman
        x,y=12,16
        facing=se
        side=2
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
    [/unit]

    [unit]
        type=Javelineer
        x,y=20,19
        facing=se
        side=2
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
    [/unit]

    [unit]
        type=Swordsman
        x,y=20,21
        facing=ne
        side=2
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
    [/unit]

    [unit]
        type=Pikeman
        x,y=16,23
        facing=se
        side=2
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
    [/unit]

    [unit]
        type=Spearman
        x,y=18,23
        facing=sw
        side=2
        [modifications]
            {TRAIT_LOYAL}
        [/modifications]
    [/unit]

    [unit]
        type=Orcish Grunt
        x,y=17,24
        facing=nw
        side=5
    [/unit]

    [unit]
        type=Orcish Archer
        x,y=21,21
        facing=nw
        side=5
    [/unit]

    [unit]
        type=Orcish Grunt
        x,y=15,11
        facing=sw
        side=5
    [/unit]

    [unit]
        type=Goblin Spearman
        x,y=17,12
        facing=sw
        side=5
    [/unit]

#enddef

#define HALDRIC

    [while]
        [not]
            [have_unit]
                side=4
                count=6-99
            [/have_unit]
        [/not]

        [do]

            [set_variable]  
                name=haldric_army 
                rand=Knight,Lancer,Lancer,Cavalryman,Cavalryman,Dragoon,Horseman,Horseman,Horseman
            [/set_variable]

            [unit]
                type=$haldric_army
                placement=leader
                facing=nw
                side=4
            [/unit]

        [/do]

    [/while]
    {CLEAR_VARIABLE haldric_army}
#enddef

#define GIFT_SHIELD
[event]
    name=moveto
    first_time_only=no
    [filter]
        side=1
        x,y=38,29
        [not]
            id=Arshag,Toruk
        [/not]
        [not]
            role=Eternal Servitude
        [/not]
        [not]
            role=Gift Bearer
        [/not]
        [not]
            role=Gift User
        [/not]
    [/filter]

    [if]
        {CHECK_VARIABLE shield_taken no}
        [then]
            [message]
                speaker=$unit.id|
                caption=""
                image="wesnoth-icon.png"
                male_message= _ "What should $unit.name| do with the the shield?"
                female_message= _ "What should female^Should $unit.name| do with the the shield?"
                [option]
                    label= _ "Equip the shield"
                    [command]
                        [object]
                            id=shield_gift
                            name= _ "A grunt's shield"
                            image=items/buckler-2.png
                            duration=forever
                            description= _ "The mighty warrior lifts the heavy buckler like it was nothing. Suddenly he feels almost invincible."
                            cannot_use_message= _ "The shield is so heavy that only a true orc warrior can carry it."
                            [filter]
                                x,y=38,29
                                type_adv_tree=Orcish Grunt
                            [/filter]
                            [then]
                                {CLEAR_VARIABLE shield_taken}
                                [remove_item]
                                    x,y=38,29
                                [/remove_item]
                                [role]
                                    x,y=38,29
                                    role=Gift User
                                [/role]
                                [fire_event]
                                    name=goto_reminder
                                [/fire_event]
                                {VARIABLE_OP picked_up_gifts add 1}
                            [/then]
                            [effect]
                                apply_to=resistance
                                replace=yes
                                [resistance]
                                    blade=80
                                    pierce=80
                                    impact=80
                                [/resistance]
                            [/effect]
                            [effect]
                                apply_to=overlay
                                add="misc/gift-icon.png"
                            [/effect]
                        [/object]
                        {PROTECT_CHECK}
                    [/command]
                [/option]
                [option]
                    label= _ "Carry it (the shield's bonus does not apply)"
                    [command]
                        [object]
                            id=shield_gift
                            name= _ "A grunt's shield"
                            image=items/buckler-2.png
                            duration=forever
                            description= _ "$unit.name| now carries the shield!"
                            [filter]
                                x,y=38,29
                            [/filter]
                            [then]
                                {CLEAR_VARIABLE shield_taken}
                                [remove_item]
                                    x,y=38,29
                                [/remove_item]
                                [role]
                                    x,y=38,29
                                    role=Gift Bearer
                                [/role]
                                {HINT_ITEM}
                                [fire_event]
                                    name=goto_reminder
                                [/fire_event]
                                {VARIABLE_OP picked_up_gifts add 1}
                            [/then]
                        [/object]
                        {PROTECT_CHECK}
                    [/command]
                [/option]
                [option]
                    label= _ "Nothing"
                    [command]
                        [allow_undo][/allow_undo]
                    [/command]
                [/option]
            [/message]
        [/then]
        [else]
            [allow_undo][/allow_undo]
        [/else]
    [/if]
[/event]
#enddef

#define GIFT_NECKLACE
[event]
    name=moveto
    first_time_only=no
    [filter]
        side=1
        x,y=38,30
        [not]
            id=Arshag,Toruk
        [/not]
        [not]
            role=Eternal Servitude
        [/not]
        [not]
            role=Gift Bearer
        [/not]
        [not]
            role=Gift User
        [/not]
    [/filter]

    [if]
        {CHECK_VARIABLE necklace_taken no}
        [then]
            [message]
                speaker=$unit.id|
                caption=""
                image="wesnoth-icon.png"
                male_message= _ "What should $unit.name| do with the the necklace?"
                female_message= _ "What should female^Should $unit.name| do with the the necklace?"
                [option]
                    label= _ "Equip the necklace"
                    [command]
                        [object]
                            id=necklace_gift
                            name= _ "A wolf rider's bone necklace"
                            image=items/necklace-bone.png
                            duration=forever
                            description= _ "The rider takes the necklace and shows it to his wolf. The beast smells wind, rain and death from it and it pours new vigor into its muscles."
                            cannot_use_message= _ "The necklace can only whisper to a wolf and his rider."
                            [filter]
                                x,y=38,30
                                type_adv_tree=Wolf Rider
                            [/filter]
                            [then]
                                {CLEAR_VARIABLE necklace_taken}
                                [remove_item]
                                    x,y=38,30
                                [/remove_item]
                                [role]
                                    x,y=38,30
                                    role=Gift User
                                [/role]
                                [fire_event]
                                    name=goto_reminder
                                [/fire_event]
                                {VARIABLE_OP picked_up_gifts add 1}
                            [/then]
                            [effect]
                                apply_to=movement
                                increase=1
                            [/effect]
                            [effect]
                                apply_to=overlay
                                add="misc/gift-icon.png"
                            [/effect]
                        [/object]
                        {PROTECT_CHECK}
                    [/command]
                [/option]
                [option]
                    label= _ "Carry it (the necklace's bonus does not apply)"
                    [command]
                        [object]
                            id=necklace_gift
                            name= _ "A wolf rider's bone necklace"
                            image=items/necklace-bone.png
                            duration=forever
                            description= _ "$unit.name| now carries the necklace!"
                            [filter]
                                x,y=38,30
                            [/filter]
                            [then]
                                {CLEAR_VARIABLE necklace_taken}
                                [remove_item]
                                    x,y=38,30
                                [/remove_item]
                                [role]
                                    x,y=38,30
                                    role=Gift Bearer
                                [/role]
                                {HINT_ITEM}
                                [fire_event]
                                    name=goto_reminder
                                [/fire_event]
                                {VARIABLE_OP picked_up_gifts add 1}
                            [/then]
                        [/object]
                        {PROTECT_CHECK}
                    [/command]
                [/option]
                [option]
                    label= _ "Nothing"
                    [command]
                        [allow_undo][/allow_undo]
                    [/command]
                [/option]
            [/message]
        [/then]
        [else]
            [allow_undo][/allow_undo]
        [/else]
    [/if]
[/event]
#enddef

#define GIFT_DAGGER
[event]
    name=moveto
    first_time_only=no
    [filter]
        side=1
        x,y=38,29
        [not]
            id=Arshag,Toruk
        [/not]
        [not]
            role=Eternal Servitude
        [/not]
        [not]
            role=Gift Bearer
        [/not]
        [not]
            role=Gift User
        [/not]
    [/filter]

    [if]
        {CHECK_VARIABLE dagger_taken no}
        [then]
            [message]
                speaker=$unit.id|
                caption=""
                image="wesnoth-icon.png"
                male_message= _ "What should $unit.name| do with the the dagger?"
                female_message= _ "What should female^Should $unit.name| do with the the dagger?"
                [option]
                    label= _ "Equip the dagger"
                    [command]
                        [object]
                            id=dagger_gift
                            name= _ "An assassin's dagger"
                            image=items/dagger-poison-bare.png
                            duration=forever
                            description= _ "The skillful assassin makes a few practice stabs with the dagger. It is much sharper than the one he usually uses."
                            cannot_use_message= _ "Only a skillful assassin can use the dagger to its full potential."
                            [filter]
                                side=1
                                x,y=38,29
                                type_adv_tree=Orcish Assassin
                            [/filter]
                            [then]
                                {CLEAR_VARIABLE dagger_taken}
                                [remove_item]
                                    x,y=38,29
                                [/remove_item]
                                [role]
                                    x,y=38,29
                                    role=Gift User
                                [/role]
                                [fire_event]
                                    name=goto_reminder
                                [/fire_event]
                                {VARIABLE_OP picked_up_gifts add 1}
                            [/then]
                            [effect]
                                apply_to=attack
                                range=melee
                                [set_specials]
                                    {WEAPON_SPECIAL_BACKSTAB}
                                [/set_specials]
                            [/effect]
                            [effect]
                                apply_to=overlay
                                add="misc/gift-icon.png"
                            [/effect]
                            [effect]
                                apply_to=attack
                                range=ranged
                                set_icon="data/core/images/attacks/blade-curved.png"
                            [/effect]
                        [/object]
                        {PROTECT_CHECK}
                    [/command]
                [/option]
                [option]
                    label= _ "Carry it (the dagger's bonus does not apply)"
                    [command]
                        [object]
                            id=dagger_gift
                            name= _ "An assassin's dagger"
                            image=items/dagger-poison-bare.png
                            duration=forever
                            description= _ "$unit.name| now carries the dagger!"
                            [filter]
                                side=1
                                x,y=38,29
                            [/filter]
                            [then]
                                {CLEAR_VARIABLE dagger_taken}
                                [remove_item]
                                    x,y=38,29
                                [/remove_item]
                                [role]
                                    x,y=38,29
                                    role=Gift Bearer
                                [/role]
                                {HINT_ITEM}
                                [fire_event]
                                    name=goto_reminder
                                [/fire_event]
                                {VARIABLE_OP picked_up_gifts add 1}
                            [/then]
                        [/object]
                        {PROTECT_CHECK}
                    [/command]
                [/option]
                [option]
                    label= _ "Nothing"
                    [command]
                        [allow_undo][/allow_undo]
                    [/command]
                [/option]
            [/message]
        [/then]
        [else]
            [allow_undo][/allow_undo]
        [/else]
    [/if]
[/event]
#enddef

#define GIFT_BOW
[event]
    name=moveto
    first_time_only=no
    [filter]
        side=1
        x,y=38,30
        [not]
            id=Arshag,Toruk
        [/not]
        [not]
            role=Eternal Servitude
        [/not]
        [not]
            role=Gift Bearer
        [/not]
        [not]
            role=Gift User
        [/not]
    [/filter]

    [if]
        {CHECK_VARIABLE bow_taken no}
        [then]
            [message]
                speaker=$unit.id|
                caption=""
                image="wesnoth-icon.png"
                male_message= _ "What should $unit.name| do with the the bow?"
                female_message= _ "What should female^Should $unit.name| do with the the bow?"
                [option]
                    label= _ "Equip the bow"
                    [command]
                        [object]
                            id=bow_gift
                            name= _ "An archer's bow"
                            image=items/bow.png
                            duration=forever
                            description= _ "The archer nocks an arrow into his new bow and smiles. It seems he really likes his new weapon."
                            cannot_use_message= _ "Only an archer can shoot the bow."
                            [filter]
                                x,y=38,30
                                type=Orcish Archer #todo: should I add Orcish Warlord as well? :D
                            [/filter]
                            [then]
                                {CLEAR_VARIABLE bow_taken}
                                [remove_item]
                                    x,y=38,30
                                [/remove_item]
                                [role]
                                    x,y=38,30
                                    role=Gift User
                                [/role]
                                [fire_event]
                                    name=goto_reminder
                                [/fire_event]
                                {VARIABLE_OP picked_up_gifts add 1}
                            [/then]
                            [effect]
                                apply_to=attack
                                range=ranged
                                increase_damage=-1
                                increase_attacks=2
                            [/effect]
                            [effect]
                                apply_to=overlay
                                add="misc/gift-icon.png"
                            [/effect]
                            [effect]
                                apply_to=attack
                                range=ranged
                                set_icon="data/core/images/attacks/bow-short-reinforced.png"
                            [/effect]
                            [effect]
                                apply_to=remove_advancement
                                types=Orcish Crossbowman
                            [/effect]
                            [effect]
                                apply_to=new_advancement
                                replace=yes
                                {AMLA_ARCHER}
                            [/effect]
                        [/object]
                        {PROTECT_CHECK}
                    [/command]
                [/option]
                [option]
                    label= _ "Carry it (the bow's bonus does not apply)"
                    [command]
                        [object]
                            id=bow_gift
                            name= _ "An archer's bow"
                            image=items/bow.png
                            duration=forever
                            description= _ "$unit.name| now carries the bow!"
                            [filter]
                                x,y=38,30
                            [/filter]
                            [then]
                                {CLEAR_VARIABLE bow_taken}
                                [remove_item]
                                    x,y=38,30
                                [/remove_item]
                                [role]
                                    x,y=38,30
                                    role=Gift Bearer
                                [/role]
                                {HINT_ITEM}
                                [fire_event]
                                    name=goto_reminder
                                [/fire_event]
                                {VARIABLE_OP picked_up_gifts add 1}
                            [/then]
                        [/object]
                        {PROTECT_CHECK}
                    [/command]
                [/option]
                [option]
                    label= _ "Nothing"
                    [command]
                        [allow_undo][/allow_undo]
                    [/command]
                [/option]
            [/message]
        [/then]
        [else]
            [allow_undo][/allow_undo]
        [/else]
    [/if]
[/event]
#enddef

#define GIFT_STAFF
[event]
    name=moveto
    first_time_only=no
    [filter]
        side=1
        x,y=38,29
        [not]
            id=Arshag,Toruk
        [/not]
        [not]
            role=Eternal Servitude
        [/not]
        [not]
            role=Gift Bearer
        [/not]
        [not]
            role=Gift User
        [/not]
        [not]
            role=Xbowman
        [/not]
    [/filter]

    [if]
        {CHECK_VARIABLE staff_taken no}
        [then]
            [message]
                speaker=$unit.id|
                caption=""
                image="wesnoth-icon.png"
                male_message= _ "What should $unit.name| do with the the staff?"
                female_message= _ "What should female^Should $unit.name| do with the the staff?"
                [option]
                    label= _ "Equip the staff"
                    [command]
                        [object]
                            id=staff_gift
                            name= _ "A staff of haunting"
                            image=items/staff-magic.png
                            duration=forever
                            description= _ "$unit.name| winces as the staff is cold to the touch."
                            [filter]
                                x,y=38,29
                            [/filter]
                            [then]
                                {CLEAR_VARIABLE staff_taken}
                                [remove_item]
                                    x,y=38,29
                                [/remove_item]
                                [role]
                                    x,y=38,29
                                    role=Eternal Servitude
                                [/role]
                                [fire_event]
                                    name=goto_reminder
                                [/fire_event]
                                {VARIABLE_OP picked_up_gifts add 1}
                            [/then]
                            [effect]
                                apply_to=overlay
                                add="misc/gift-icon.png"
                            [/effect]
                            [effect]
                                apply_to=new_ability
                                [abilities]
                                    {ABILITY_STAFF_DUMMY}
                                [/abilities]
                            [/effect]
                        [/object]
                        {PROTECT_CHECK}
                    [/command]
                [/option]
                [option]
                    label= _ "Carry it (the staff's bonus does not apply)"
                    [command]
                        [object]
                            id=staff_gift
                            name= _ "A staff of haunting"
                            image=items/staff-magic.png
                            duration=forever
                            description= _ "$unit.name| now carries the staff!"
                            [filter]
                                x,y=38,29
                            [/filter]
                            [then]
                                {CLEAR_VARIABLE staff_taken}
                                [remove_item]
                                    x,y=38,29
                                [/remove_item]
                                [role]
                                    x,y=38,29
                                    role=Gift Bearer
                                [/role]
                                {HINT_ITEM}
                                [fire_event]
                                    name=goto_reminder
                                [/fire_event]
                                {VARIABLE_OP picked_up_gifts add 1}
                            [/then]
                        [/object]
                        {PROTECT_CHECK}
                    [/command]
                [/option]
                [option]
                    label= _ "Nothing"
                    [command]
                        [allow_undo][/allow_undo]
                    [/command]
                [/option]
            [/message]
        [/then]
        [else]
            [allow_undo][/allow_undo]
        [/else]
    [/if]
[/event]
#enddef

#define GIFT_CLOAK
[event]
    name=moveto
    first_time_only=no
    [filter]
        side=1
        x,y=38,30
        [not]
            id=Arshag,Toruk
        [/not]
        [not]
            role=Eternal Servitude
        [/not]
        [not]
            role=Gift Bearer
        [/not]
        [not]
            role=Gift User
        [/not]
        [not]
            role=Xbowman
        [/not]
    [/filter]

    [if]
        {CHECK_VARIABLE cloak_taken no}
        [then]
            [message]
                speaker=$unit.id|
                caption=""
                image="wesnoth-icon.png"
                male_message= _ "What should $unit.name| do with the the bow?"
                female_message= _ "What should female^Should $unit.name| do with the the bow?"
                [option]
                    label= _ "Equip the cloak"
                    [command]
                        [object]
                            id=cloak_gift
                            name= _ "A midnight cloak"
                            image=items/cloak-dark.png
                            duration=forever
                            description= _ "$unit.name| wraps the cloak around the shoulders and nearby shadows shimmer, like if they are drawn into the fabric."
                            cannot_use_message= _ "A wolf is too large to fit under the cloak."
                            [filter]
                                x,y=38,30
                                [not]
                                    type_adv_tree=Wolf Rider #todo: Rider can't carry the cloak after he failed to equip it
                                [/not]
                            [/filter]
                            [then]
                                {CLEAR_VARIABLE cloak_taken}
                                [remove_item]
                                    x,y=38,30
                                [/remove_item]
                                [role]
                                    x,y=38,30
                                    role=Gift User
                                [/role]
                                [fire_event]
                                    name=goto_reminder
                                [/fire_event]
                                {VARIABLE_OP picked_up_gifts add 1}
                            [/then]
                            [effect]
                                apply_to=new_ability
                                [abilities]
                                    {ABILITY_NIGHTSTALK}
                                [/abilities]
                            [/effect]
                            [effect]
                                apply_to=overlay
                                add="misc/gift-icon.png"
                            [/effect]
                        [/object]
                        {PROTECT_CHECK}
                    [/command]
                [/option]
                [option]
                    label= _ "Carry it (the cloak's bonus does not apply)"
                    [command]
                        [object]
                            id=cloak_gift
                            name= _ "A midnight cloak"
                            image=items/cloak-dark.png
                            duration=forever
                            description= _ "$unit.name| now carries the cloak!"
                            [filter]
                                x,y=38,30
                            [/filter]
                            [then]
                                {CLEAR_VARIABLE cloak_taken}
                                [remove_item]
                                    x,y=38,30
                                [/remove_item]
                                [role]
                                    x,y=38,30
                                    role=Gift Bearer
                                [/role]
                                {HINT_ITEM}
                                [fire_event]
                                    name=goto_reminder
                                [/fire_event]
                                {VARIABLE_OP picked_up_gifts add 1}
                            [/then]
                        [/object]
                        {PROTECT_CHECK}
                    [/command]
                [/option]
                [option]
                    label= _ "Nothing"
                    [command]
                        [allow_undo][/allow_undo]
                    [/command]
                [/option]
            [/message]
        [/then]
        [else]
            [allow_undo][/allow_undo]
        [/else]
    [/if]
[/event]
#enddef

#define STAFF_OF_HAUNTING
    [event]
        name=last breath
        [filter]
            role=Eternal Servitude
        [/filter]
        [message]
            speaker=unit
            message= _ "I feel darkness... and cold. That cursed staff... what will become of me?"
        [/message]
        [store_unit]
            [filter]
                role=Eternal Servitude
            [/filter]
            variable=ghost_store
        [/store_unit]
        [kill]
            role=Eternal Servitude
            animate=yes
        [/kill]
        [unit]
            type=Ghost
            name=Ghost of $ghost_store.name|
            x,y=$ghost_store.x,$ghost_store.y
            facing=$ghost_store.facing
            side=1
        [/unit]
        {CLEAR_VARIABLE ghost_store}
    [/event]

    [event] #a secret property of the shield: it saves it's bearer from 1 melee impact or blade killing blow
        name=last breath

        [filter]
            [filter_wml]
                [modifications]
                    [object]
                        id=shield_gift
                    [/object]
                [/modifications]
            [/filter_wml]
        [/filter]

        [filter_second_attack]
                type=blade,impact
                range=melee
        [/filter_second_attack]

        [sound]
            name=club.ogg
        [/sound]

        [message]
            speaker=narrator
            message= _ "The shield breaks into splinters, saving the bearer from a killing blow!"
            image=wesnoth-icon.png
        [/message]

        [remove_object]
            id=$unit.id
            object_id=shield_gift
        [/remove_object]

        {VARIABLE unit.hitpoints 1} #todo: clear up this section

        [unstore_unit]
            variable=unit
        [/unstore_unit]

        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]
            [effect]
                apply_to=hitpoints
                heal_full=yes
            [/effect]
        [/modify_unit]

        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]
            [effect]
                apply_to=hitpoints
                increase=-55%
            [/effect]
        [/modify_unit]

        [set_achievement]
            content_for=RTL_SP
            id=RTL_shield
        [/set_achievement]
    [/event]
#enddef

#define ABILITY_STAFF_DUMMY
     [leadership]
        value=0
		id=hanting_staff
        cumulative=no
		name= _ "haunted"
		description=_ "This unit will turn into a ghost when killed."
        special_note= _ "This unit will turn into a ghost when killed."
    [/leadership]
#enddef

#define RELOAD_OBJECTIVES
#This is a major cheese. Wesnoth does not update the hint bellow automatically, so I reload the entire objective list every time the variable changes. There is a way to make it work with lua and whatnot (HttT does it in the Test of the Clans scenario), but I'm far too lazy for that.
    [objectives]
        [objective]
            [show_if]
                [have_unit]
                    id=Birmaglost
                [/have_unit]
            [/show_if]
            description= _ "Defeat Birmaglost, the renegade leader"
            condition=win
        [/objective]
        [objective]
            [show_if]
                [have_unit]
                    type=Yeti,RTL Sleeping Yeti
                [/have_unit]
            [/show_if]
            description= _ "Slay the Yeti in the mountains"
            condition=win
        [/objective]
        [objective]
            [show_if]
                [variable]
                    name=materials
                    greater_than=2
                [/variable]
            [/show_if]
            description= _ "Find some materials for the orc craftsmen to use"
            condition=win
        [/objective]
        [objective]
            [show_if]
                [variable]
                    name=materials
                    less_than=3
                [/variable]
                [and]
                    [variable]
                        name=gift_delivered
                        not_equals=yes
                    [/variable]
                [/and]
            [/show_if]
            description= _ "Craft a gift and deliver it to the dwarves"
            condition=win
        [/objective]
        {HINT "Sources of material left on the map: $materials"}
        {HINT "Each unit can equip or carry just one item."}
        {HINT "As they have to lead the band, Arshag and Toruk will neither carry nor equip items."}
        [objective]
            description= _ "Death of Arshag"
            condition=lose
        [/objective]
        [objective]
            description= _ "Death of Toruk"
            condition=lose
        [/objective]

        [gold_carryover]
            carryover_percentage=0
            bonus=no
        [/gold_carryover]

        {TURNS_RUN_OUT}

    [/objectives]
#enddef

#define ABILITY_HEARTENS
    [dummy]
        id=rtl_heartens    
        name= _ "heartens"
        female_name= _ "female^heartens"
        description= _ "This unit boosts the defense of the surrounding units of it's own side so they get an extra strike for all their attacks."
        description_inactive= _ "Move your other units next to this one so they get an extra strike for all their attacks on defense."
        special_note= _ "This unit boosts the defense of the surrounding units of it's own side so they get an extra strike for all their attacks."
        [filter]
            [filter_adjacent]
                side=$other_unit.side
            [/filter_adjacent]
        [/filter]
    [/dummy]
#enddef

#define MAIN_CHARACTERS_EVENTS
    [event]
        name=side 1 turn end
        first_time_only=no

        [modify_unit]
            [filter]
                side=$side_number
                [filter_adjacent]
                    is_enemy=no
                    ability=rtl_heartens
                [/filter_adjacent]
            [/filter]
            [object]
                duration=turn
                [effect]
                    apply_to=attack
                    increase_attacks=1
                [/effect]
                [effect]
                    apply_to=overlay
                    add="misc/shield-icon.png"
                [/effect]
            [/object]
        [/modify_unit]

        [if]
            [have_unit]
                side=$side_number
                [filter_adjacent]
                    is_enemy=no
                    ability=rtl_heartens
                [/filter_adjacent]
            [/have_unit]
            [then]
                [sound]
                    name=fanfare-short.wav
                [/sound]
                [animate_unit]
                    [filter]
                        ability=rtl_heartens
                    [/filter]
                    flag=leading
                    hits=miss
                    text="heartens"
                    red=206
                    green=165
                [/animate_unit]
            [/then]
        [/if]

    [/event]

    [event] #todo: delete (?) after porting the campaign to 1.17 (have to decide first if I allow Nightblades then)
        name=post advance
        [filter]
            id=Arshag
            type=Orcish Slayer
        [/filter]
        [modify_unit]
            [filter]
                id=Arshag
            [/filter]
            [object]
                id=arshag_slayer_compatibility
                duration=forever
                [effect]
                    apply_to=new_advancement
                    replace=yes
                    types=Orcish Nightblade
                [/effect]
                [effect]
                    apply_to=max_experience
                    set=51 #Arshag is intelligent
                [/effect]
            [/object]
        [/modify_unit]
    [/event]

    [event]
        name=post advance
        [filter]
            id=Arshag
            type=Orcish Nightblade
        [/filter]
        [filter_condition]
            [variable]
                name=hunting_phase
                not_equals=yes
            [/variable]
        [/filter_condition]
        [remove_object]
            id=Arshag
            object_id=arshag_slayer_compatibility
        [/remove_object]
        [modify_unit]
            [filter]
                id=Arshag
            [/filter]
            [object]
                id=arshag_nightblade_compatibility
                duration=forever
                [effect]
                    apply_to=new_advancement
                    replace=yes
                    types=null
                    {AMLA_ARSHAG}
                [/effect]
                [effect]
                    apply_to=max_experience
                    set=36
                [/effect]
            [/object]
        [/modify_unit]
    [/event]

    [event] #needed since The Hunt hunting bit breaks otherwise
        name=post advance
        [filter]
            id=Arshag
            type=Orcish Nightblade
        [/filter]
        [filter_condition]
            [variable]
                name=hunting_phase
                equals=yes
            [/variable]
        [/filter_condition]
        [remove_object]
            id=Arshag
            object_id=arshag_slayer_compatibility
        [/remove_object]
    [/event]

    [event] #todo: move to hints maybe?
        name=post advance
        [filter]
            id=Arshag
            type=Orcish Nightblade,RTL Mounted Nightblade
        [/filter]
        [filter_condition]
            [variable]
                name=rootless_hints
                equals=yes
            [/variable]
            [and]
                [variable]
                    name=hint_amlas
                    not_equals=yes
                [/variable]
            [/and]
        [/filter_condition]
        [message]
            speaker=narrator
            image=help/amlas-overlay.png
            message= _ "Arshag can gain additional abilities even if he has reached level 3. Be careful though, because such advancement <i>will not</i> restore his hitpoints."
        [/message]
        {VARIABLE hint_amlas yes}
    [/event]

    [event] #todo: move to hints maybe?
        name=post advance
        [filter]
            id=Toruk
            type=RTL Orcish Veteran
        [/filter]
        [filter_condition]
            [variable]
                name=rootless_hints
                equals=yes
            [/variable]
            [and]
                [variable]
                    name=hint_heartens
                    not_equals=yes
                [/variable]
            [/and]
        [/filter_condition]
        [message]
            speaker=narrator
            image=help/heartens-overlay.png
            message= _ "At level 2, Toruk gains a useful ability. Units that stand next to him at the end of his turn gain one extra strike to defend against enemy attacks."
        [/message]
        {VARIABLE hint_heartens yes}
    [/event]

    [event] #in case Not_Toruk starts as a Grunt
        name=post advance

        [filter]
            type=RTL Orcish Veteran
            id=Not_Toruk
        [/filter]
        
        [modify_unit]
            [filter]
                type=RTL Orcish Veteran
                id=Not_Toruk
            [/filter]
            [effect]
                apply_to=remove_ability
                [experimental_filter_ability] #todo: experimental feature, prone to change
                    id=rtl_heartens
                [/experimental_filter_ability]
            [/effect]
        [/modify_unit]
    [/event]
#enddef

#define ABILITY_BURNED
    [dummy]
        id=rtl_burned
        name= _ "burned"
        female_name= _ "female^burned"
        description= _ "This is a ghost of someone who died by burning. That makes it very resistant to fire damage compared to a regular ghost. It also heals 8 hitpoints each turn while inside the lava cave."
    [/dummy]
#enddef

#define PLOT_ARMOR
[object]
    [effect]
        apply_to=resistance
        replace=yes
        [resistance]
            blade=10
            pierce=10
            fire=10
            impact=10
            arcane=10
            cold=10
        [/resistance]
    [/effect]
[/object]
#enddef

#define RECALL_DISCOUNT
    [event]
        name=victory
        [modify_unit]
            [filter]
                side=1
                level=0
            [/filter]
            [effect]
                apply_to=recall_cost
                set={ON_DIFFICULTY 10 12 14}
            [/effect]
        [/modify_unit]
        [modify_unit]
            [filter]
                side=1
                type=Goblin Rouser,Goblin Impaler
            [/filter]
            [effect]
                apply_to=recall_cost
                set={ON_DIFFICULTY 14 15 16}
            [/effect]
        [/modify_unit]
    [/event]
#enddef

#define EE_RESET
    [remove_item]
        x,y=3,19
    [/remove_item]
    [remove_item]
        x,y=3,18
    [/remove_item]
    [remove_item]
        x,y=5,19
    [/remove_item]
    [remove_item]
        x,y=5,18
    [/remove_item]
    {PLACE_IMAGE (items/bonestack.png) 3 18}
    {PLACE_IMAGE (items/bonestack.png) 3 19}
    {PLACE_IMAGE (items/bonestack.png) 5 18}
    {PLACE_IMAGE (items/bonestack.png) 5 19}
    {VARIABLE ghoul_ee 1}
    [sound]
        name=magic-dark-miss.ogg
    [/sound]
#enddef

#define WC TYPE VARIATION X Y
    [unit]
        side=4
        type={TYPE}
        variation={VARIATION}
        x={X}
        y={Y}
    [/unit]
#enddef

#define SCHEDULE_LAVA_CAVE
	[time]
		blue=-45
		green=-45
        red=15
		id="lava_cave"
		image="schedule/lava-underground.png"
		name=_"Lava Cave"
	[/time]
#enddef

#define FIRE_LIGHT X Y Z
[time_area]
    id={Z}
    x,y={X},{Y}
    radius=1
    # Stolen from TRoW
    # Schedule using the red, green, blue values from other ToDs,
    # but overriding the image to fit the current ToD, and applying a bonus.
    {MORNING} # (actually dawn)
    [+time]
        image=misc/time-schedules/default/schedule-dawn.png~BLIT(misc/tod-bright.png)
        lawful_bonus=25
    [/time]
    {MORNING}
    {AFTERNOON}
    {AFTERNOON} # (actually dusk)
    [+time]
        image=misc/time-schedules/default/schedule-dusk.png~BLIT(misc/tod-bright.png)
        lawful_bonus=25
    [/time]
    {DAWN} # (actually 1st night)
    [+time]
        image=misc/time-schedules/default/schedule-firstwatch.png~BLIT(misc/tod-bright.png)
        lawful_bonus=0
    [/time]
    {DAWN} # (actually 2nd night)
    [+time]
        image=misc/time-schedules/default/schedule-secondwatch.png~BLIT(misc/tod-bright.png)
        lawful_bonus=0
    [/time]
[/time_area]
#enddef

#define SHAMANS_ARE_COOL
[event] #shamans can do cool stuff
    name=moveto
    [filter]
        side=1
        type=Troll Shaman,RTL Great Shaman
        x,y=26,14
    [/filter]

    [animate_unit]
        flag=attack
        [filter]
            x,y=26,14
        [/filter]
        hits=kill
        [primary_attack]
            range=ranged
        [/primary_attack]
        [facing]
            x,y=26,15
        [/facing]
        text="+1 attack"
        red=255
        green=102
    [/animate_unit]

    {MODIFY_TERRAIN Co 26 14}

    [remove_item]
        x,y=26,14
    [/remove_item]

    [modify_unit]
        [filter]
            x,y=26,14
        [/filter]
        side=1
        [object]
            duration=turn
            [effect]
                apply_to=attack
                range=ranged
                increase_attacks=1
            [/effect]
        [/object]
    [/modify_unit]

    [remove_time_area]
        id=right
    [/remove_time_area]

[/event]

[event]
    name=moveto
    [filter]
        side=1
        type=Troll Shaman,RTL Great Shaman
        x,y=14,2
    [/filter]

    [animate_unit]
        flag=attack
        [filter]
            x,y=14,2
        [/filter]
        hits=kill
        [primary_attack]
            range=ranged
        [/primary_attack]
        [facing]
            x,y=14,3
        [/facing]
        text="+1 attack"
        red=255
        green=102
    [/animate_unit]

    {MODIFY_TERRAIN Co 14 2}

    [remove_item]
        x,y=14,2
    [/remove_item]

    [modify_unit]
        [filter]
            x,y=14,2
        [/filter]
        side=1
        [object]
            duration=turn
            [effect]
                apply_to=attack
                range=ranged
                increase_attacks=1
            [/effect]
        [/object]
    [/modify_unit]

    [remove_time_area]
        id=top
    [/remove_time_area]

[/event]

[event]
    name=moveto
    [filter]
        side=1
        type=Troll Shaman,RTL Great Shaman
        x,y=8,17
    [/filter]

    [animate_unit]
        flag=attack
        [filter]
            x,y=8,17
        [/filter]
        hits=kill
        [primary_attack]
            range=ranged
        [/primary_attack]
        [facing]
            x,y=8,18
        [/facing]
        text="+1 attack"
        red=255
        green=102
    [/animate_unit]

    {MODIFY_TERRAIN Co 8 17}

    [remove_item]
        x,y=8,17
    [/remove_item]

    [modify_unit]
        [filter]
            x,y=8,17
        [/filter]
        side=1
        [object]
            duration=turn
            [effect]
                apply_to=attack
                range=ranged
                increase_attacks=1
            [/effect]
        [/object]
    [/modify_unit]

    [remove_time_area]
        id=left
    [/remove_time_area]

[/event]
#enddef

#define COND_SAY VARIABLE SPEAKER MSG1 MSG2
    [if]
        [variable]
            name={VARIABLE}
            equals=yes
        [/variable]
        [then]
            [message]
                speaker={SPEAKER}
                message= _ {MSG1}
            [/message]
        [/then]
        [else]
            [message]
                speaker={SPEAKER}
                message= _ {MSG2}
            [/message]
        [/else]
    [/if]
#enddef

#define COND_SAY_R VARIABLE SPEAKER MSG1 MSG2
    [if]
        [variable]
            name={VARIABLE}
            equals=yes
        [/variable]
        [then]
            [message]
                speaker={SPEAKER}
                message= _ {MSG1}
                image_pos=right
            [/message]
        [/then]
        [else]
            [message]
                speaker={SPEAKER}
                message= _ {MSG2}
                image_pos=right
            [/message]
        [/else]
    [/if]
#enddef

#define ABILITY_WING_LEADER
    [dummy]
        id=rtl_wing_leader   
        name= _ "wing leader"
        description= _ "The drake leader takes little damage until his wing is destroyed."
    [/dummy]
#enddef

#define VARIANT_SAY TROLL NAGA ORC
    [if]
        [have_unit]
            id=$unit.id
            race=troll,ogre
            [not]
                type=Troll Shaman, RTL Great Shaman
            [/not]
        [/have_unit]
        [then]
            [message]
                speaker=unit
                message= _ {TROLL}
            [/message]
        [/then]
        [elseif]
            [have_unit]
                id=$unit.id
                race=naga
            [/have_unit]
            [then]
                [message]
                    speaker=unit
                    message= _ {NAGA}
                [/message]
            [/then]
        [/elseif]
        [else]
            [message]
                speaker=unit
                message= _ {ORC}
            [/message]
        [/else]
    [/if]
#enddef

#define IF_WOLF_SAY X
    [if]
        [have_unit]
            id=Arshag
            type_adv_tree=RTL Mounted Assassin
        [/have_unit]
        [then]
            [message]
                speaker=narrator
                image=portraits/wolves/wolf-dark.webp
                message= _ {X}
            [/message]
        [/then]
    [/if]
#enddef

#define THE_FIRE_ENDING
#option 1: Grokutin caged, ally not angered
#option 2: Grokutin caged, ally angered
#option 3: Grokutin not caged, ally not angered, Grokutin survives
#option 4: Grokutin not caged, ally angered, Grokutin survives
#option 5: Grokutin not caged, ally angered, Grokutin dies
#option 6: Grokutin not caged, ally not angered, Grokutin dies
    [if]
        [variable]
            name=grokutin_caged
            equals=yes
        [/variable]
        [variable]
            name=ally_angered
            not_equals=yes
        [/variable]
        [variable]
            name=grokutin_dead
            not_equals=yes
        [/variable]
        [then]
            {VARIABLE the_fire_ending 1}
        [/then]
    [/if]

    [if]
        [variable]
            name=grokutin_caged
            equals=yes
        [/variable]
        [variable]
            name=ally_angered
            equals=yes
        [/variable]
        [variable]
            name=grokutin_dead
            not_equals=yes
        [/variable]
        [then]
            {VARIABLE the_fire_ending 2}
        [/then]
    [/if]

    [if]
        [variable]
            name=grokutin_caged
            not_equals=yes
        [/variable]
        [variable]
            name=ally_angered
            not_equals=yes
        [/variable]
        [variable]
            name=grokutin_dead
            not_equals=yes
        [/variable]
        [then]
            {VARIABLE the_fire_ending 3}
        [/then]
    [/if]

    [if]
        [variable]
            name=grokutin_caged
            not_equals=yes
        [/variable]
        [variable]
            name=ally_angered
            equals=yes
        [/variable]
        [variable]
            name=grokutin_dead
            not_equals=yes
        [/variable]
        [then]
            {VARIABLE the_fire_ending 4}
        [/then]
    [/if]

    [if]
        [variable]
            name=grokutin_caged
            not_equals=yes
        [/variable]
        [variable]
            name=ally_angered
            equals=yes
        [/variable]
        [variable]
            name=grokutin_dead
            equals=yes
        [/variable]
        [then]
            {VARIABLE the_fire_ending 5}
        [/then]
    [/if]

    [if]
        [variable]
            name=grokutin_caged
            not_equals=yes
        [/variable]
        [variable]
            name=ally_angered
            not_equals=yes
        [/variable]
        [variable]
            name=grokutin_dead
            equals=yes
        [/variable]
        [then]
            {VARIABLE the_fire_ending 6}
        [/then]
    [/if]

    {CLEAR_VARIABLE grokutin_caged}
    {CLEAR_VARIABLE ally_angered}
    {CLEAR_VARIABLE grokutin_dead}
#enddef
#define THE_DEEP_BRAZIERS
    [event]
        name=moveto
        [filter]
            x="21,22,23,24,25"
	        y="44,43,43-45,42-44,43-45"
            side=1
        [/filter]
        {MODIFY_TERRAIN Uu^Ebn 23 44}
        {MODIFY_TERRAIN Uu^Ebn 25 44}
        {BRAZIERS_ACHIEVEMENT_CHECK}
    [/event]
    [event]
        name=moveto
        [filter]
            x="18,19,20,21,22,23"
	        y="40-41,40-42,39-42,40-42,39-40,40"
            side=1
        [/filter]
        {MODIFY_TERRAIN Uu^Ebn 20 40}
        {MODIFY_TERRAIN Uu^Ebn 22 40}
        {BRAZIERS_ACHIEVEMENT_CHECK}
    [/event]
    [event]
        name=moveto
        [filter]
            x="19,20,21,22"
		    y="37,36-37,36-39,36-37"
            side=1
        [/filter]
        {MODIFY_TERRAIN Uu^Ebn 20 37}
        {MODIFY_TERRAIN Uu^Ebn 22 37}
        {BRAZIERS_ACHIEVEMENT_CHECK}
    [/event]
    [event]
        name=moveto
        [filter]
            x="15,16"
		    y="35-36,35-36"
            side=1
        [/filter]
        {MODIFY_TERRAIN Tb^Ebn 16 36}
        {BRAZIERS_ACHIEVEMENT_CHECK}
    [/event]
    [event]
        name=moveto
        [filter]
            x="12,13,14,15"
		    y="32-33,32-33,32-34,33-34"
            side=1
        [/filter]
        {MODIFY_TERRAIN Uu^Ebn 13 33}
        {MODIFY_TERRAIN Uu^Ebn 15 33}
        {BRAZIERS_ACHIEVEMENT_CHECK}
    [/event]
    [event]
        name=moveto
        [filter]
            x="15,16,17"
		    y="28-29,27-29,28-29"
            side=1
        [/filter]
        {MODIFY_TERRAIN Urb^Ebn 16 27}
        {MODIFY_TERRAIN Urb^Ebn 16 29}
        {BRAZIERS_ACHIEVEMENT_CHECK}
    [/event]
    [event]
        name=moveto
        [filter]
            x="19,20,21"
		    y="28-29,27-29,28-29"
            side=1
        [/filter]
        {MODIFY_TERRAIN Urb^Ebn 20 27}
        {MODIFY_TERRAIN Urb^Ebn 20 29}
        {BRAZIERS_ACHIEVEMENT_CHECK}
    [/event]
    [event]
        name=moveto
        [filter]
            x="23,24,25"
		    y="28-29,27-29,28-29"
            side=1
        [/filter]
        {MODIFY_TERRAIN Urb^Ebn 24 27}
        {MODIFY_TERRAIN Urb^Ebn 24 29}
        {BRAZIERS_ACHIEVEMENT_CHECK}
    [/event]
#enddef

#define BRAZIERS_ACHIEVEMENT_CHECK
        [sound]
            name=thunderstick-miss.ogg
        [/sound]
        {VARIABLE_OP braziers_count add 1}
        [if]
            [variable]
                name=braziers_count
                equals=8
            [/variable]
            [then]
                [set_achievement]
                    content_for=RTL_SP
                    id=RTL_braziers
                [/set_achievement]
            [/then]
        [/if]
#enddef

#define DEEP_SAURIANS
    [event]
        name=unit placed
        first_time_only=no

        [filter]
            race=lizard
            side=2
            [not]
                [filter_wml]
                    [modifications]
                        [object]
                            scale_color_shift=yes
                        [/object]
                    [/modifications]
                [/filter_wml]
                [or]
                    type=Saurian Flanker,Saurian Oracle
                [/or]
            [/not]
        [/filter]

        [object]
            scale_color_shift=yes
            silent=yes

            [effect]
                apply_to=image_mod
                add={SCALE_SHIFT_IPF}
            [/effect]
        [/object]
    [/event]
#enddef

#define DEEP_SAURIANS_ORACLE
    [event]
        name=unit placed
        first_time_only=no

        [filter]
            type=Saurian Flanker,Saurian Oracle
            [not]
                [filter_wml]
                    [modifications]
                        [object]
                            oracle_color_shift=yes
                        [/object]
                    [/modifications]
                [/filter_wml]
            [/not]
        [/filter]

        [object]
            oracle_color_shift=yes
            silent=yes

            [effect]
                apply_to=image_mod
                add={ORACLE_SHIFT_IPF}
            [/effect]
        [/object]
    [/event]
#enddef

#define SCALE_SHIFT_IPF
"CHAN({SCALE_SHIFT green blue}, {SCALE_SHIFT red blue}, {SCALE_SHIFT red red})"#enddef

#define SCALE_SHIFT NEWCHAN ORIGCHAN
if(green <= blue +30 <= red +20, ({NEWCHAN} / 255.0)^2 * 290.0, {ORIGCHAN})#enddef

#define ORACLE_SHIFT_IPF
"CHAN({SCALE_SHIFT green blue}, {SCALE_SHIFT red blue}, {SCALE_SHIFT red red})"#enddef

#define ORACLE_SHIFT NEWCHAN ORIGCHAN
if(green -200 <= blue -200 <= red -225, ({NEWCHAN} / 255.0)^1.1 * 800.0, {ORIGCHAN})#enddef

#define ITEM_HALO
    halo = "halo/misc/leadership-flare-1.png:20,halo/misc/leadership-flare-2.png:20,halo/misc/leadership-flare-3.png:20,halo/misc/leadership-flare-4.png:20,halo/misc/leadership-flare-4.png:20,halo/misc/leadership-flare-6.png:20,halo/misc/leadership-flare-7.png:20,halo/misc/leadership-flare-8.png:20,halo/misc/leadership-flare-9.png:20,halo/misc/leadership-flare-10.png:20,halo/misc/leadership-flare-11.png:20,halo/misc/leadership-flare-12.png:20,halo/misc/leadership-flare-13.png:20,misc/blank-hex.png:5000"
#enddef

#define GHOST_UNIT TYPE X Y ROLE_STRING
    [unit]
        side=5
        type={TYPE}
        role={ROLE_STRING}
        x={X}
        y={Y}
        random_traits=no
        random_gender=yes
        [modifications]
            name=""
            race=undead
            {TRAIT_IMAGINARY}
            [object]
                [effect]
                    apply_to=image_mod
                    add=~O(70%)~GS()~CS(-200,-40,-40)
                [/effect]
            [/object]
        [/modifications]
    [/unit]

    [store_unit]
        [filter]
            x={X}
            y={Y}
        [/filter]
        variable=ghost_xp_unit
    [/store_unit]

    {VARIABLE ghost_xp_unit.advances_to null}

    [unstore_unit]
        variable=ghost_xp_unit
    [/unstore_unit]

    {CLEAR_VARIABLE ghost_xp_unit}
#enddef

#define GHOST_LEADER TYPE X Y ID NAME
    [unit]
        id={ID}
        name={NAME}
        side=5
        type={TYPE}
        canrecruit=yes
        x={X}
        y={Y}
        random_traits=no
        random_gender=no
        [modifications]
            name=""
            race=undead
            {TRAIT_IMAGINARY}
            [object]
                [effect]
                    apply_to=image_mod
                    add=~O(70%)~GS()~CS(-200,-40,-40)
                [/effect]
            [/object]
        [/modifications]
    [/unit]

    [store_unit]
        [filter]
            x={X}
            y={Y}
        [/filter]
        variable=ghost_xp_unit
    [/store_unit]

    {VARIABLE ghost_xp_unit.advances_to null}

    [unstore_unit]
        variable=ghost_xp_unit
    [/unstore_unit]

    {CLEAR_VARIABLE ghost_xp_unit}
#enddef

#define TRAIT_IMAGINARY
    [trait]
        id=undead
        availability="musthave"
        male_name= _ "imaginary"
        female_name= _ "female^imaginary"
        description= _ "Immune to poison and plague"
        help_text= _ "<italic>text='Imaginary'</italic> units are immune to poison and plague."
        [effect]
            apply_to=status
            add=unpoisonable
        [/effect]
        [effect]
            apply_to=status
            add=unplagueable
        [/effect]
    [/trait]
#enddef

#define WEAPON_SPECIAL_LUCIDITY
    [drains]
        id=drains
        name= _ "lucidity"
        description= _ "As the unit destroys the products of its dormant mind, it heals itself for half the damage it deals (rounded down)."
        special_note= _ "As the unit destroys the products of its dormant mind, it heals itself for half the damage it deals (rounded down)."
    [/drains]
#enddef

#define WEAPON_SPECIAL_ATTACK_EFFECT
    [dummy]
        id=rtl_attack_effect
        name= _ "effect on attack"
        description= _ "The effects of this weapon will only apply while attacking with it."
        special_note= _ "The effects of this weapon will only apply while attacking with it."
    [/dummy]
#enddef

#define ABILITY_RESURGES
    [regenerate]
        value=3
        id=resurges
        name=_"resurges"
        description=_"+ 3 HP per round. Toruk's long life has allowed Toruk to accumulate enough experience to keep his spirit from being easily extinguished."
        special_note= _ "Toruk's long life has allowed Toruk to accumulate enough experience to keep his spirit from being easily extinguished."
        affect_self=yes
    [/regenerate]
#enddef

#define ABILITY_REPAIR
    [regenerate]
        value=50
        id=quintain_repair
        name=_"repair"
        description=_"Orcs will repair the quintain periodically."
        special_note= _ "The quintain will get repaired on turn start."
        affect_self=yes
    [/regenerate]
#enddef

#define SAURIAN_GUARD XY
        [micro_ai]
            action=add
            side=2
            [filter]
                x,y={XY}
            [/filter]
            ai_type=return_guardian
            return_x,return_y={XY}
        [/micro_ai]
#enddef

#define DREAM_CLEARED ROLE
[event]
    name=last breath
    first_time_only=no
    [filter]
        role={ROLE}
        side=5
    [/filter]
    [filter_condition]
        [not]
            [have_unit]
                role={ROLE}
            [/have_unit]
        [/not]
    [/filter_condition]
    [kill]
        id=$unit.id
        animate=yes
    [/kill]
    [heal_unit]
        amount=full
        [filter]
            id=Arshag_Ghost,Toruk_Ghost
        [/filter]
    [/heal_unit]
    [fire_event]
        name={ROLE}
    [/fire_event]
[/event]
#enddef

#define SAURIAN_WAVE
[event]
    name=new turn
    first_time_only=no

    [filter_condition]
        [not]
            [have_unit]
                side=2
                count=18-99
            [/have_unit]
        [/not]
        [and]
            [variable]
                name=stop_saurians
                not_equals=yes
            [/variable]
        [/and]
    [/filter_condition]

    [set_variable]  
        name=saurian_wave
#ifdef EASY
        rand=Saurian Skirmisher,Saurian Skirmisher,Saurian Skirmisher,Saurian Skirmisher,Saurian Augur,Saurian Augur,Saurian Augur,Saurian Ambusher,Saurian Spearthrower,Saurian Soothsayer
#endif
#ifdef NORMAL
        rand=Saurian Skirmisher,Saurian Skirmisher,Saurian Augur,Saurian Augur,Saurian Ambusher,Saurian Spearthrower,Saurian Soothsayer
#endif
#ifdef HARD
        rand=Saurian Skirmisher,Saurian Augur,Saurian Ambusher,Saurian Spearthrower,Saurian Soothsayer
#endif
    [/set_variable]

    [unit]
        type=$saurian_wave
        x,y=11,6
        find_vacant=yes
        facing=sw
        side=2
    [/unit]

#    [if] #todo: somehow implement for the hard mode? too hard for other difficulties
#        [not]
#            [have_unit]
#                side=2
#                count=10-99
#            [/have_unit]
#        [/not]
#        [then]
#
#            [set_variable]  
#                name=saurian_wave
##ifdef EASY
#                rand=Saurian Skirmisher,Saurian Skirmisher,Saurian Skirmisher,Saurian Skirmisher,Saurian Augur,Saurian Augur,Saurian Augur,Saurian Ambusher,Saurian Spearthrower,Saurian Soothsayer
##endif
##ifdef NORMAL
#                rand=Saurian Skirmisher,Saurian Skirmisher,Saurian Augur,Saurian Augur,Saurian Ambusher,Saurian Spearthrower,Saurian Soothsayer
##endif
##ifdef HARD
#                rand=Saurian Skirmisher,Saurian Augur,Saurian Ambusher,Saurian Spearthrower,Saurian Soothsayer
##endif
#            [/set_variable]
#
#            [unit]
#                type=$saurian_wave
#                x,y=12,6
#                find_vacant=yes
#                facing=sw
#                side=2
#            [/unit]
#
#        [/then]
#    [/if]

    {CLEAR_VARIABLE saurian_wave}

[/event]
#enddef

#define IF_TORUK SPEAKER MSG1 MSG2
[if]
    [have_unit]
        id=Toruk
    [/have_unit]
    [then]
        [message]
            speaker={SPEAKER}
            message= _ {MSG1}
        [/message]
    [/then]
    [else]
        [message]
            speaker={SPEAKER}
            message= _ {MSG2}
        [/message]
    [/else]
[/if]
#enddef

#define DEAD_TORUK SPEAKER MSG
[if]
    [not]
        [have_unit]
            id=Toruk
        [/have_unit]
    [/not]
    [then]
        [message]
            speaker={SPEAKER}
            message= _ {MSG}
        [/message]
    [/then]
[/if]
#enddef

#define ABILITY_DARK_WILL
    [dummy]
        id=rtl_dark_will
        name= _ "dark will"
        description= _ "If any living creature dies around them, this unit will bring it back as a walking corpse."
        special_note= _ "If any living creature dies around them, this unit will bring it back as a walking corpse."
    [/dummy]
#enddef

#define DARK_WILL_MACRO
[event]
    name=last breath
    first_time_only=no
    [filter]
        [not]
            race=undead,mechanical
        [/not]
        [filter_adjacent]
            type_adv_tree=RTL Wesfolk Adept
        [/filter_adjacent]
    [/filter]
    [filter_condition]
        [variable]
            name=unit.id
            not_equals=Clerila
        [/variable]
        [and]
            [variable]
                name=unit.id
                not_equals=ShamanKiller
            [/variable]
        [/and]
    [/filter_condition]
    [store_unit_type]
        type=$unit.type
    [/store_unit_type]
    [if]
        [variable]
            name=unit_type.race
            equals=troll
        [/variable]
        [then]
            {VARIABLE dark_will_variant troll}
        [/then]
        [elseif]
            [variable]
                name=unit_type.race
                equals=naga
            [/variable]
            [then]
                {VARIABLE dark_will_variant swimmer}
            [/then]
        [/elseif]
        [elseif]
            [variable]
                name=unit_type.race
                equals=goblin
            [/variable]
            [then]
                {VARIABLE dark_will_variant goblin}
            [/then]
        [/elseif]
        [elseif]
            [variable]
                name=unit_type.race
                equals=wolf
            [/variable]
            [then]
                {VARIABLE dark_will_variant wolf}
            [/then]
        [/elseif]
        [elseif]
            [variable]
                name=unit_type.race
                equals=drake
            [/variable]
            [then]
                {VARIABLE dark_will_variant drake}
            [/then]
        [/elseif]
        [else]
        [/else]
    [/if]
    [kill]
        id=$unit.id
        animate=yes
    [/kill]
    [unit] #stupid way to make Adept line actually play the animation
        type=RTL Blank
        id=Temp Hack
        x,y=$unit.x,$unit.y
        side=2
    [/unit]
    [hide_unit]
        id=Temp Hack
    [/hide_unit]
    [animate_unit]
        flag=healing
        [filter]
            type_adv_tree=RTL Wesfolk Adept
            [filter_adjacent]
                id=Temp Hack
            [/filter_adjacent]
        [/filter]
        [facing]
            x=$unit.x
            y=$unit.y
        [/facing]
    [/animate_unit]
    [kill]
        id=Temp Hack
        animate=no
    [/kill]
    [unit]
#ifdef HARD
        type=Soulless
#else
        type=Walking Corpse
#endif
        name=$unit.name
        x,y=$unit.x,$unit.y
        facing=$unit.facing
        variation=$dark_will_variant
        side=2
    [/unit]
#ifdef EASY
    [modify_unit] #newly spawned units do not attack immediately on Easy
        [filter]
            x,y=$unit.x,$unit.y
        [/filter]
        moves=0
        attacks_left=0
    [/modify_unit]
#else
#endif
    {CLEAR_VARIABLE dark_will_variant}
    {CLEAR_VARIABLE dark_will_unit}
[/event]
#enddef

#define ARSHAG_PLACE_IMAGE X Y
[if]
    [have_unit]
        id=Arshag
        type=Orcish Assassin
    [/have_unit]
    [then]
        {PLACE_IMAGE ("units/orcs/assassin.png~RC(magenta>red)~FL(horiz)") {X} {Y}}
    [/then]
    [elseif]
        [have_unit]
            id=Arshag
            type=Orcish Slayer
        [/have_unit]
        [then]
            {PLACE_IMAGE ("units/orcs/slayer.png~RC(magenta>red)~FL(horiz)") {X} {Y}}
        [/then]
    [/elseif]
    [elseif]
        [have_unit]
            id=Arshag
            type=Orcish Nightblade
        [/have_unit]
        [then]
            {PLACE_IMAGE ("units/orcs/nightblade.png~RC(magenta>red)~FL(horiz)") {X} {Y}}
        [/then]
    [/elseif]
    [elseif]
        [have_unit]
            id=Arshag
            type=RTL Mounted Assassin
        [/have_unit]
        [then]
            {PLACE_IMAGE ("units/orcs/mounted-assassin.png~RC(magenta>red)~FL(horiz)") {X} {Y}}
        [/then]
    [/elseif]
    [elseif]
        [have_unit]
            id=Arshag
            type=RTL Mounted Slayer
        [/have_unit]
        [then]
            {PLACE_IMAGE ("units/orcs/mounted-slayer.png~RC(magenta>red)~FL(horiz)") {X} {Y}}
        [/then]
    [/elseif]
    [elseif]
        [have_unit]
            id=Arshag
            type=RTL Mounted Nightblade
        [/have_unit]
        [then]
            {PLACE_IMAGE ("units/orcs/mounted-nightblade.png~RC(magenta>red)~FL(horiz)") {X} {Y}}
        [/then]
    [/elseif]
[/if]
#enddef

#define WEAPON_SPECIAL_FROSTBIND
    [dummy]
        id=rtl_frostbind
        name= _ "frostbind"
        female_name= _ "female^frostbind"
        description=_ "If this attack hits, it will freeze the opponent for one turn."
        special_note="If this attack hits, it will freeze the opponent for one turn."
    [/dummy]
#enddef


#define RING_OF_FROST
    [event]
        name=attacker hits
        first_time_only=no

        [filter_attack]
            special_id=rtl_frostbind
        [/filter_attack]

        {VARIABLE frozen_unit $second_unit.side}

        [modify_unit]
            [filter]
                id=$second_unit.id
                [not]
                    type=Frost Stoat
                [/not]
            [/filter]
            side=5
            [object] #todo: prevent units from playing idle animations somehow
                id=rtl_frozen #todo? unit could be hidden via [hide_unit], would just display image modded second_unit.image (it would mean, however, that the rotation is lost)
                [effect]
                    apply_to=image_mod
                    add=~GS()~CS(40,60,120)
                [/effect]
            [/object]
        [/modify_unit]

        [sound]
            name=frozen.ogg
        [/sound]

    [/event]

    [event]
        name=turn end
        first_time_only=no

        [modify_unit]
            [filter]
                side=5
                [filter_wml]
                    [modifications]
                        [object]
                            id=rtl_frozen
                        [/object]
                    [/modifications]
                [/filter_wml]
            [/filter]
            side=$frozen_unit
        [/modify_unit]

        [remove_object]
            object_id=rtl_frozen
        [/remove_object]

        {CLEAR_VARIABLE frozen_unit}

    [/event]
#enddef

#define ABILITY_EMPOWERS
    [regenerate]
        value=99
        id=empowers
        name=_"empowers"
        description=_"The magic that overflows this unit's body allows it to fully heal at the beginning of each turn."
        affect_self=yes
        poison=cured
        special_note= _ "The magic that overflows this unit's body allows it to fully heal at the beginning of each turn."
    [/regenerate]
#enddef

#define ZOFARIAS_LOYAL
    [event]
        name=unit placed
        first_time_only=no

        [filter]
            side=2
            [not]
                [filter_wml]
                    [modifications]
                        [object]
                            id=elf_color_shift
                        [/object]
                    [/modifications]
                [/filter_wml]
            [/not]
        [/filter]

        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]
            [object]
                id=elf_color_shift
                silent=yes
                [effect]
                    apply_to=image_mod
                    add=~RC(magenta>black)
                [/effect]
            [/object]
        [/modify_unit]
    [/event]
#enddef

#define READY_THE_ARMIES
{GENERIC_UNIT 1 (Goblin Impaler) 16 29}
{GENERIC_UNIT 1 (Goblin Impaler) 17 24}
{GENERIC_UNIT 1 (Goblin Impaler) 33 18}
#the orcs
{GENERIC_UNIT 1 (Wolf Rider) 18 23}
{GENERIC_UNIT 1 (Orcish Grunt) 19 23}
{GENERIC_UNIT 1 (Orcish Grunt) 20 22}
{GENERIC_UNIT 1 (Troll) 21 22}
{GENERIC_UNIT 1 (Orcish Grunt) 22 21}
{GENERIC_UNIT 1 (Orcish Grunt) 23 21}
{GENERIC_UNIT 1 (Troll Whelp) 24 20}
{GENERIC_UNIT 1 (Orcish Grunt) 25 20}
{GENERIC_UNIT 1 (Orcish Grunt) 26 19}
{GENERIC_UNIT 1 (Wolf Rider) 27 19}
{GENERIC_UNIT 1 (Goblin Knight) 19 24}
{GENERIC_UNIT 1 (Orcish Archer) 20 23}
{GENERIC_UNIT 1 (Orcish Assassin) 21 23}
{GENERIC_UNIT 1 (Orcish Archer) 22 22}
{GENERIC_UNIT 1 (Orcish Assassin) 23 22}
{GENERIC_UNIT 1 (Orcish Archer) 24 21}
{GENERIC_UNIT 1 (Orcish Assassin) 25 21}
{GENERIC_UNIT 1 (Orcish Archer) 26 20}
{GENERIC_UNIT 1 (Orcish Assassin) 27 20}
{GENERIC_UNIT 1 (Goblin Pillager) 28 19}
{GENERIC_UNIT 1 (Orcish Warrior) 20 24}
{GENERIC_UNIT 1 (Troll Whelp) 23 23}
{GENERIC_UNIT 1 (Troll Whelp) 26 21}
{GENERIC_UNIT 1 (Orcish Warrior) 29 20}
{GENERIC_UNIT 1 (Orcish Crossbowman) 21 25}
{GENERIC_UNIT 1 (Orcish Crossbowman) 22 24}
{GENERIC_UNIT 1 (Orcish Crossbowman) 29 21}
{GENERIC_UNIT 1 (Orcish Crossbowman) 30 20}
#the elves
{GENERIC_UNIT 6 (Elvish Rider) 12 22}
{GENERIC_UNIT 6 (Elvish Scout) 13 22}
{GENERIC_UNIT 6 (Wose) 14 21}
{GENERIC_UNIT 6 (Elvish Fighter) 15 21}
{GENERIC_UNIT 6 (Wose) 16 20}
{GENERIC_UNIT 6 (Elvish Fighter) 17 20}
{GENERIC_UNIT 6 (Elvish Fighter) 18 19}
{GENERIC_UNIT 6 (Wose) 19 19}
{GENERIC_UNIT 6 (Elvish Fighter) 20 18}
{GENERIC_UNIT 6 (Elvish Fighter) 21 18}
{GENERIC_UNIT 6 (Wose) 22 17}
{GENERIC_UNIT 6 (Elvish Fighter) 23 17}
{GENERIC_UNIT 6 (Elvish Scout) 12 22}
{GENERIC_UNIT 6 (Elvish Scout) 12 21}
{GENERIC_UNIT 6 (Elvish Archer) 13 21}
{GENERIC_UNIT 6 (Elvish Archer) 14 20}
{GENERIC_UNIT 6 (Elvish Archer) 15 20}
{GENERIC_UNIT 6 (Elvish Shaman) 16 19}
{GENERIC_UNIT 6 (Elvish Captain) 17 19}
{GENERIC_UNIT 6 (Elvish Archer) 18 18}
{GENERIC_UNIT 6 (Elvish Archer) 19 18}
{NAMED_GENERIC_UNIT 6 (Elvish Captain) 20 17 (Leras) ( _ "Leras")}
{GENERIC_UNIT 6 (Elvish Druid) 21 17}
{GENERIC_UNIT 6 (Elvish Ranger) 12 20}
{GENERIC_UNIT 6 (Elvish Ranger) 13 20}
{GENERIC_UNIT 6 (Elvish Sorceress) 15 19}
{GENERIC_UNIT 6 (Elvish Marksman) 16 18}
{GENERIC_UNIT 6 (Elvish Hero) 18 17}
{GENERIC_UNIT 6 (Elvish Hero) 19 17}
{GENERIC_UNIT 6 (Elvish Ranger) 24 14}

[modify_unit]
    [filter]
        side=1
        x="9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31"
        y="20-22,18-22,18-23,17-23,18-24,17-24,17-25,16-25,16-26,15-26,15-27,14-26,14-26,14-25,15-25,15-24,16-24,16-23,17-23,17-22,18-22,18-21,19-21"
    [/filter]
    facing=nw
[/modify_unit]
[modify_unit]
    [filter]
        side=6
        x="9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31"
        y="20-22,18-22,18-23,17-23,18-24,17-24,17-25,16-25,16-26,15-26,15-27,14-26,14-26,14-25,15-25,15-24,16-24,16-23,17-23,17-22,18-22,18-21,19-21"
    [/filter]
    facing=se
[/modify_unit]
#enddef


#define TSUNAMI_1
[terrain_mask] #todo: make it a proper mask to save space?
    x,y=0,0
    alignment=even
    mask="
Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Hh, Hh^Fms, Hh^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gll^Fmw, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Rb, Rb, Rb, Wwf, Ww, Wwf, Wwf, Wwg, Ww, Ww, Ww, Ww, Ww
Gs^Fms, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fp, Gs^Fds, Gs^Fds, Gs^Fds, Hh^Fds, Hh^Fms, Hh^Fms, Hh^Fms, Gs^Fms, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fms, Gs^Fms, Rb, Rb, Wwf, Wwf, Wwf, Wwg, Wwg, Wwg, Wwg, Ww, Ww, Ww, Ww
Gs^Fds, Gs^Fds, Gs^Fp, Gs^Fms, Gs^Fp, Gs^Fms, Hh, Hh^Fds, Ms, Hh^Fmw, Hh^Fmw, Hh^Fds, Gs^Fms, Gs^Fds, Gs^Fds, Gll^Fmw, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fp, Gs^Fds, Gs^Fp, Gs^Fms, Gs^Fms, Rb, Rb, Rb, Wwf, Wwg, Wwg, Wwg, Ww, Ww, Ww, Ww, Ww, Ww
Gs^Fds, Gs^Fds, Gs^Fp, Gs^Fp, Gs^Fms, Gs^Fms, Gs, Mm, Mm, Mm, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Fms, Gg^Efm, Gs^Fms, Gs, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fp, Gs^Fp, Gs^Fds, Gs^Fms, Gs^Fms, Gs^Fms, Rb, Rb, Rb, Wwf, Wwg, Wwg, Wwg, Ww, Ww, Ww, Ww, Ww
Gs^Fms, Gs^Fp, Gs^Fms, Gs^Fmw, Aa, Gs^Esa, Co^Vct, Hh, Hh^Fp, Mm, Hh, Gs^Fms, Gs^Fms, Gs^Fp, Gs^Fp, Gs^Fp, Gs^Fms, Gs, Gg^Efm, Gg, Gs^Es, Gg^Edb, Gs^Esa, Gd, Gs^Fmw, Gs^Fp, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Fms, Gs^Fms, Ds, Rb, Rb, Wwf, Wwf, Wwg, Wwg, Ww, Ww, Ww, Ww, Ww
Gs, Gs^Fms, Gs, Gs, Hh, Hh^Esa, Hh, Hhd, Hhd, Hhd, Hh, Gs, Aa^Esa, Gs^Fp, Gs^Fms, Gs^Fms, Gd, Gs^Efm, Ce, Ket, Ce, Re^Esa, Aa, Aa, Gs^Esa, Gs^Fp, Gs^Fms, Gs^Fds, Gs^Fms, Gs^Fms, Gd, Gg, Ds, Rb, Rb, Wwf, Wwg, Wwg, Wwg, Ww, Ww, Ww, Ww, Ww
Gs, Gs^Edb, Gs, Hh, Gs, Gs^Edb, Hh^Fp, Hh, Gs, Wo, Gg, Hh, Gs, Gs^Esa, Gs, Gd, Ce, Ce, Ce, Cv, Ce, Ce, Gs^Vct, Aa, Gs, Gs^Fms, Gs^Fms, Gs^Fds, Gs^Fms, Gd, Aa^Esa, Gg, Gs^Esa, Rb, Rb, Rb, Wwg, Wwg, Wwg, Wwg, Wwg, Ww, Ww, Ww
Gs, Aa, Gs^Esa, Hh, Gs^Esa, Aa, Hh, Hh, Gs, Ww^Ewl, Wo, Hh, Gs^Esa, Gs, Gs^Vct, Re, Re, Ce, Ce, Ce, Gs^Vct, Gs^Vct, Gs^Vct, Gs^Vct, Gg, Gs^Fms, Gs^Fms, Gs^Fms, Gll^Fmw, Gd, Aa^Es, Aa, Gs^Esa, Rb, Rb, Rb, Wwf, Wwf, Wwf, Wwg, Wwg, Wwg, Ww, Ww
Gs, Aa, Aa, Gs^Esa, Aa, Gs^Esa, Hh, Gs, Gd, Gs, Wo, Aa, Aa, Gs^Vct, Gs^Vct, Gs^Vct, Gs^Vct, Re, Re, Re, Re, Gs^Vct, Gs^Efm, Gs^Efm, Gs^Fms, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fms, Gs, Gs^Esa, Aa, Hh, Rb^Es, Rb^Es, Wwf^Vm, Rb, Wwf, Wwf, Wwf, Wwg, Wwg, Ww, Ww
Gs, Hh^Es, Gs, Gs^Esa, Gs, Gs, Gg^Efm, Gg, Gd, Hh, Wwg, Aa^Esa, Wo, Wo, Wwg, Gs^Vct, Ww, Re, Gd, Re, Gg, Gs, Gs^Fmw, Gs^Fms, Hh^Fp, Hh^Fp, Gs^Fms, Gs^Fds, Gs^Fms, Gs^Es, Gs^Efm, Aa, Gs, Rb^Es, Ds, Rb, Rb, Rb, Rb, Wwf, Wwf, Wwg, Wwg, Ww
Hhd, Hh, Gg, Gg, Gg^Efm, Gg^Efm, Gg^Efm, Gs, Gs^Edb, Hh^Fp, Ww, Ww, Hh, Hh^Fp, Hh, Ww^Ewl, Hh, Wo, Wo, Gs^Es, Gs^Esa, Hh, Hh^Fms, Gs^Fp, Hh^Fp, Hh^Fms, Hh^Fms, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Fms, Gs^Efm, Co^Vct, Gs, Gd, Ds, Ce, Rb, Rb, Wwf, Wwf, Wwg, Wwg, Wwg
Hh, Hhd, Gg^Es, Gs^Efm, Gg, Gg, Gs, Gs, Gs, Hh, Hh^Efm, Mm, Mm, Hh, Hhd, Hh, Gs, Gs^Es, Wwf^Es, Gs, Aa, Aa, Aa, Hh^Fds, Hh^Fp, Mm, Hh^Fms, Hh^Fms, Gs, Gs^Fms, Gs, Gs, Gs, Gs^Efm, Gs^Efm, Ce, Cv^Kov, Ce, Ds, Rb, Rb, Wwf, Wwg, Ww
Gs, Hh, Gg, Gg^Es, Gs, Gs^Efm, Gs, Aa, Aa, Gd, Mm, Ms, Hh^Fmw, Hhd, Ur^Kov, Ur^Kov, Ur^Kov, Gg, Wwf, Gd, Gs, Aa, Hh, Hh^Fms, Hh^Fp, Hh^Fmw, Hh^Fms, Hhd, Gs^Efm, Gd^Efm, Gs^Fp, Gs^Fp, Gs^Fds, Gs^Efm, Gs^Fms, Ce, Ce, Ce, Gg, Hh, Hhd, Rb, Wwg, Wwg
Gs, Gs, Gd, Gd, Gd, Gs, Hh^Fms, Aa, Hh, Hhd, Mm, Mm, Hh^Fds, Gs, Ur^Kov, Gll^Feth, Ur^Kov, Gs, Wo, Gs, Hh, Gs^Esa, Hhd, Hh^Fms, Hh^Fp, Hh^Fp, Hh^Fms, Gs^Efm, Gs^Efm, Gd^Efm, Gs^Fms, Gs^Fp, Gs^Fds, Gs^Fds, Gs^Fds, Gs, Gs^Fms, Gs, Gg^Efm, Gs, Hhd, Rb, Wwf^Vm, Ww
Gs, Gd, Hh, Gs, Gs, Hh^Fms, Hh^Fmw, Hh^Fmw, Hh^Fms, Hhd, Hh^Fp, Hh, Hh^Fds, Gs^Efm, Gs^Efm, Ur^Kov, Gs, Gd, Gg, Wo, Wwg, Hh^Fp, Hh, Hhd, Gs^Fms, Gs^Fp, Gd, Hh, Hh, Gd, Gs, Gs^Fp, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Efm, Gg^Efm, Hh^Efm, Hhd, Rb^Es, Rb, Rb
Gs, Gs, Ce, Hhd, Hh^Fms, Gs^Fds, Hh^Fms, Hh, Aa, Hh^Fp, Hh^Fp, Hh^Fp, Hh^Fms, Hh, Hh, Gs, Co^Vct, Gd, Gs, Gg, Gs, Wo, Co^Vct, Gd, Gs, Gs, Gs^Esa, Aa, Aa^Esa, Gs, Gs^Fms, Gs^Fmw, Gs, Gs^Fms, Gs, Gs^Fms, Gs^Efm, Gs^Efm, Gs, Hh, Hh, Rb, Rb, Wwg
Gg, Ce, Cv^Kov, Ce, Gs^Fms, Hh^Fds, Gs^Fms, Gs^Esa, Aa, Aa^Edb, Hh^Fms, Hh^Fds, Gs^Fds, Gs^Fms, Gs^Edb, Hh, Gs, Gd, Gd, Gg, Gs, Ww, Wo, Wo, Wo, Gs^Edb, Gs, Aa, Gs^Esa, Gs, Wo, Gs, Ww, Gs, Gg^Es, Gg^Edb, Gg, Gs^Efm, Ds, Ds, Rb^Es, Rb, Wwg, Wwg
Gs, Ce, Ce, Ce, Gs^Fms, Gs^Fds, Gs^Fp, Gs^Fms, Gs^Esa, Aa, Gs^Fms, Hh^Fds, Gs^Fds, Gs, Aa, Aa, Gs^Esa, Gs^Efm, Gs^Efm, Gg, Gs^Efm, Gs^Efm, Gd, Gd, Gs, Ww^Es, Ww, Wwg, Wwg, Wo, Ww^Ewl, Wo, Gs, Wo, Wo, Wo, Wo, Ds, Rb, Rb^Es, Rb, Wwg, Wwg, Ww
Gs^Efm, Gs, Gs, Gs, Gs, Hh^Fms, Hh^Fp, Hh^Fds, Gs^Efm, Gs^Efm, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Esa, Aa, Gs^Esa, Gs^Efm, Gs^Efm, Gg^Efm, Gs, Gs^Efm, Gs, Gs, Gg^Es, Gs, Gd, Gs, Gs^Fms, Gs, Gs^Fms, Gs, Hh, Co^Vct, Ds, Wwg, Wwg, Wwg, Wwg, Rb, Rb, Rb, Wwg, Ww
Gs^Efm, Gs^Efm, Hhd, Gs, Gs^Es, Gs^Fms, Hh^Fms, Hh^Fp, Hh^Fmw, Gs^Efm, Gs^Fds, Gs^Fds, Gs^Fds, Gs, Gs, Aa, Gg, Gs, Gs, Gs, Gs, Gs, Gg, Gg^Edb, Gs^Efm, Gs^Efm, Gd^Efm, Gs, Gs^Fds, Gs^Fms, Gs^Fms, Hh, Hhd, Ds, Rb, Wwg, Wwg, Wwg, Wwg, Wwg, Rb, Rb, Wwg, Ww
Gg^Efm, Gs^Efm, Gs, Hhd, Hhd^Es, Gs, Hh, Hh^Fp, Hh^Fp, Hh^Fms, Hh^Fds, Hh^Fms, Hh^Fds, Hh^Fms, Gs, Gg^Es, Gg, Gg, Gs, Gs^Es, Gs, Gs, Gs, Gg, Gs, Gs, Gs^Esa, Gd, Gs, Gs^Fms, Gs, Gs^Edb, Rb^Es, Rb, Rb, Rb, Rb, Wwg, Wwg, Wwg, Wwg, Wwg, Ww, Ww
Gs, Gg^Efm, Gs, Gs, Gs, Hh, Gs, Hh^Fms, Hh^Fms, Hh^Fp, Hh^Fp, Hh^Fds, Hh^Fds, Gs^Fds, Gs, Gg, Gg^Efm, Gs^Efm, Gs, Gg^Es, Gs, Gs, Gs^Efm, Gs, Aa, Gs^Esa, Gs^Esa, Gs, Gs^Fds, Gs^Fms, Gs^Fms, Rb, Rb, Rb, Rb, Rb, Rb, Wwg, Wwg, Ww, Ww, Wwg, Ww, Ww
Sm, Gs^Em, Ss, Ss, Sm, Gs, Gd^Em, Gd, Hhd, Hh^Fms, Hh^Fms, Hh^Fp, Hh^Fp, Hh^Fms, Gs^Fms, Gs^Efm, Gs, Gs^Efm, Gs, Gg, Gg^Efm, Gs, Gs, Gs^Esa, Aa, Aa^Esa, Gs^Edb, Gs^Fms, Gs^Efm, Gs, Rb^Es, Rb^Es, Rb, Rb, Rb, Rb, Rb, Wwf^Vm, Wwg, Wwg, Wwg, Ww, Ww, Ww
Ss, Sm, Sm, Ss, Ss, Ss, Sm, Gd, Gd, Hh, Gs, Hh^Fms, Hh^Fds, Hh^Fms, Hh^Fms, Gs^Fmw, Gs, Gs, Gs, Gs, Gs^Efm, Gg, Gs, Gs^Esa, Aa, Aa, Gs, Gd, Gd^Efm, Gs^Efm, Rb^Es, Rb^Es, Rb, Rb, Wwf, Wwg, Wwg, Rb, Wwg, Wwg, Wwg, Ww, Ww, Ww
Sm, Sm, Sm, Ss, Ss, Ss, Sm, Ss, Ss, Gd^Es, Gd, Hh, Hh^Fms, Hh^Fms, Hh, Hh^Fms, Hh, Co^Vct, Gs, Gs, Gs, Gg, Gg^Es, Gs, Gs^Esa, Gs, Gs, Gs^Efm, Ds, Rb^Es, Rb, Rb, Rb, Wwf, Wwf, Wwg, Wwg, Wwg, Wwg, Wwg, Ww, Ww, Ww, Ww
Ss, Rb, Sm, Ss, Ss, Sm, Rb, Rb, Rb, Ss, Gs, Hh, Hhd, Mm, Hh^Fms, Hh^Fms, Gs^Esa, Hh^Esa, Hh^Esa, Hh, Gs, Gs^Efm, Gg^Efm, Gs, Gs, Gs, Gg^Efm, Ds, Wwg, Rb, Wwg, Wwg, Wwg, Wwf, Wwg, Wwg, Wwg, Ww, Ww, Ww, Ww, Ww, Ww, Ww
Sm, Ss, Ss, Sm, Sm, Ss^Vhs, Sm, Ss, Sm, Sm, Gs^Efm, Gs^Efm, Mm, Mm, Mm, Hh, Gs^Esa, Aa^Esa, Aa^Esa, Hh^Fp, Hh, Gs, Gs, Gs, Gd, Gs^Es, Gg, Ds, Wo, Wwg, Wwg, Wwg, Wwg, Wwg, Wwf, Wwg, Wwg, Ww, Ww, Ww, Ww, Ww, Ww, Ww
Rb, Sm, Ss, Ss, Ss, Ss, Sm, Ss, Ss, Sm, Gs, Hh, Mm, Mm, Hh^Fp, Hh, Gs, Aa, Aa, Gs^Esa, Gs, Gs, Gd^Efm, Gd^Efm, Gd, Gs, Wo, Wo, Wo, Wwg, Rb, Wwg, Wwf, Wwf, Rb, Wwf, Wwf, Wwg, Wwg, Ww, Ww, Ww, Ww, Ww
Rb, Rb, Ss, Ss, Ss, Sm, Sm, Rb, Sm, Sm, Gs, Hh^Efm, Hh^Fmw, Hh, Hhd, Hhd, Gs, Gs, Gs^Esa, Aa, Gs, Gd, Gs^Efm, Gs^Efm, Gg, Wo, Gs, Gs, Gd, Ds, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Wwf, Wwg, Wwg, Wwg, Ww, Ww, Ww
Ss, Ss, Ss, Ss, Ss, Sm, Sm, Sm, Sm, Gs, Gs^Efm, Hh^Fp, Hh^Fms, Hh, Gs^Es, Hh, Co^Vct, Gs, Gs, Gs^Esa, Gs, Gs^Efm, Gs, Gs, Wo, Wo, Gs^Esa, Aa, Aa, Aa, Ds, Rb, Rb^Es, Rb, Rb, Wwf^Vm, Rb, Rb, Rb^Es, Wwg, Wwg, Ww, Ww, Ww
Ss, Ss^Vhs, Sm, Sm, Sm, Sm, Ss, Ss, Gs^Esa, Gs, Hh^Esa, Hh^Fp, Hh^Fds, Hh^Fms, Gs, Gs, Gs, Hh, Gs, Gs, Wo, Gg^Es, Ww, Gs, Wo, Gs, Gs, Aa^Esa, Aa, Gs^Esa, Gs^Fds, Gs^Fds, Gs^Fds, Rb^Es, Rb^Es, Rb^Es, Rb, Rb^Es, Rb^Es, Wwg, Wwg, Ww, Ww, Ww
Ss, Ss, Rb, Rb, Rb, Sm, Ss, Sm, Aa, Aa, Hh, Hh^Fds, Hh^Fds, Hh^Fms, Gs, Gg^Efm, Gs^Efm, Gd, Gd, Wo, Hh, Wwg, Hh, Wo, Gg^Efm, Gs^Es, Gs^Efm, Gs^Esa, Gd, Gs^Fds, Gs^Fds, Gs^Fms, Ds, Ds, Rb^Es, Rb, Rb, Rb, Wwf, Wwg, Wwg, Wwg, Ww, Ww
Sm, Sm, Ss, Rb, Sm, Sm, Ss, Gs^Esa, Aa, Aa^Esa, Gs, Hh^Fms, Gs^Fds, Hh^Fds, Hh^Fms, Gg^Efm, Gs, Gd^Efm, Gs^Efm, Wwg, Hh, Hhd, Gs, Gs, Gs^Efm, Gg^Efm, Gs, Gd, Gd, Gs, Gs^Efm, Gg, Ds, Rb^Es, Rb^Es, Rb, Rb, Rb, Wwf, Wwg, Wwg, Wwg, Ww, Ww
Sm, Sm, Ss, Sm, Ss, Sm, Sm, Gs, Gs, Gs^Esa, Gs, Gs^Fms, Gs, Hh^Fds, Hh^Fmw, Gs, Gd, Gd, Wwf, Ww, Gs, Gs^Es, Gs, Gs, Gs^Efm, Gg, Gg, Gs, Gd, Gs^Efm, Gg, Gs^Edb, Gs^Fds, Rb^Es, Rb, Rb, Rb, Rb, Wwf, Wwf, Wwg, Wwg, Ww, Ww
Ss, Sm, Ss, Ss, Sm, Sm, Sm, Ss, Gs^Em, Gs^Efm, Gs^Efm, Gs^Efm, Gs, Gs^Fms, Gs, Gs, Wwf, Wwf^Es, Gs, Gs, Co^Edt, Ko, Co^Edt, Gs^Edt, Gs, Gs, Hh^Es, Hh^Efm, Gd, Gg^Es, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Fds, Rb, Rb, Rb, Rb, Rb, Wwf, Wwg, Wwg, Ww, Ww
Sm, Sm, Sm, Ss, Ss, Ss, Ss, Sm, Gs, Gg, Hh, Hh^Es, Gs, Gs, Wo, Ww, Gs, Gs, Rb, Co, Rd, Rb, Rb, Co, Rd, Gs, Gs, Hh, Gd, Gs, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Rb, Rb, Rb, Rb^Es, Rb, Wwg, Wwg, Ww, Ww
Sm, Sm, Ss, Sm, Sm, Ss, Sm, Sm, Gs, Gg, Hh, Gs^Es, Wo, Wo, Gs, Gs^Edt, Co, Co^Edt, Re, Rb, Rb^Vct, Rd^Vct, Re^Vct, Rb^Edt, Rb, Co, Co^Edt, Gs, Gd, Gs, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fds, Rb, Rb, Rb^Es, Rb^Es, Rb, Wwf, Wwg, Ww, Ww
Sm, Ss, Sm, Sm, Ss, Ss, Ss, Sm, Gs, Gg^Efm, Gs, Ww, Gs, Gs^Efm, Gs^Efm, Gs, Ko^Edt, Gd^Edt, Rb^Vct, Rb^Vct, Re^Vct, Rb^Vct, Rd^Vct, Re^Vct, Rb^Vct, Re^Edt, Ko^Edt, Gs, Gs, Gs, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fds, Gd, Rb, Rb, Rb, Rb, Wwf, Wwg, Wwg, Ww
Ss, Ss, Ss, Rb, Ss, Ss, Ss, Gs, Gs^Efm, Gs^Efm, Gs, Wwf, Gs, Gs^Efm, Gd^Es, Gs, Co, Rb, Rb^Vct, Re^Vct, Rb^Vct, Rb^Vct, Rb^Vct, Re^Vct, Rb^Vct, Rb, Co, Gs^Efm, Gs^Efm, Gs^Fds, Gs^Fms, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fds, Ds, Ds, Rb, Rb, Rb, Wwf, Wwg, Wwg, Wwg
Sm, Sm, Ss, Ss^Vhs, Ss, Sm, Gs, Gs, Gd^Efm, Gd, Gs, Wwf, Gs^Es, Gd, Gd^Efm, Gs, Gs, Co, Rd, Rd^Vct, Re^Vct, Gd^Vct, Rb^Vct, Rd^Vct, Rb, Co, Gs, Gs, Gg^Efm, Gg, Gg, Gg, Gg, Gs^Fds, Gs, Gd^Efm, Ds, Rb, Rb, Rb, Wwf, Wwf, Wwf, Wwg
Sm, Rb, Ss, Ss, Gs^Em, Gs, Gs, Gd, Gd, Gd, Ww, Wwf, Gs, Gs, Gd^Efm, Gd, Gs, Rb, Co, Gd^Edt, Rb^Edt, Rb, Rb, Rb, Co, Rb, Gs, Gs, Gg^Efm, Gg, Gs, Gs, Gs, Gg, Gg^Efm, Gs^Efm, Gs, Ds, Rb, Rb, Rb, Wwf, Wwf, Ww
Ss, Rb, Ss, Ss, Hh^Efm, Hh, Gd, Gd, Wwg, Ww, Gg, Gs, Hh, Gs^Efm, Gd, Gd, Gd, Gs^Edt, Co, Rb, Co, Ko, Co, Rd^Edt, Co^Edt, Gs, Gs, Gs, Gs, Gs, Gg^Efm, Gs^Efm, Gs^Efm, Gs^Efm, Gs, Gg^Efm, Gs^Efm, Gd^Efm, Ds, Rb, Rb, Ww^Vm, Rb^Es, Ww
Rb, Rb, Ss, Ss, Hh, Gd, Gs, Gs, Wwg, Gs, Gs, Hh^Efm, Hh, Gs^Efm, Gs^Efm, Gd^Efm, Gd, Gs, Gs, Co, Gs, Gs^Edt, Gs, Co^Edt, Gs^Edt, Gs^Edt, Hh, Hh, Hh, Gs^Es, Gg, Gg, Gs, Gs, Gs, Gg, Gs^Fds, Gs^Fds, Gs^Fms, Ds, Rb, Rb^Es, Rb^Es, Rb^Es
Ss, Ss, Ss, Ss, Gs, Gs, Gs, Gd, Wwg, Gs, Gs, Hh, Gs, Gs, Gs, Gs, Gs, Gd, Gs, Gs, Gs, Gs, Gs, Gs, Gs, Gs, Gs, Hh^Efm, Gs, Gg, Gs, Gs, Gs, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fms, Gd, Gs^Fms, Gs, Rb, Rb, Rb   
"
[/terrain_mask]
#enddef

#define TSUNAMI_2
[terrain_mask]
    x,y=0,0
    alignment=even
    mask="
Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Hh, Hh^Fms, Hh^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gll^Fmw, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Re, Re, Re, Rb, Ww, Rb, Rb, Rb, Rb, Rb, Rb, Wwf, Wwf
Gs^Fms, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fp, Gs^Fds, Gs^Fds, Gs^Fds, Hh^Fds, Hh^Fms, Hh^Fms, Hh^Fms, Gs^Fms, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fms, Gs^Fms, Re, Re, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Wwf, Wwf
Gs^Fds, Gs^Fds, Gs^Fp, Gs^Fms, Gs^Fp, Gs^Fms, Hh, Hh^Fds, Ms, Hh^Fmw, Hh^Fmw, Hh^Fds, Gs^Fms, Gs^Fds, Gs^Fds, Gll^Fmw, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fp, Gs^Fds, Gs^Fp, Gs^Fms, Gs^Fms, Re, Re, Re, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Wwf, Wwf
Gs^Fds, Gs^Fds, Gs^Fp, Gs^Fp, Gs^Fms, Gs^Fms, Gs, Mm, Mm, Mm, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Fms, Gg^Efm, Gs^Fms, Gs, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fp, Gs^Fp, Gs^Fds, Gs^Fms, Gs^Fms, Gs^Fms, Re, Re, Re, Rb, Rb, Rb, Rb, Rb, Wwf, Wwf, Wwf, Wwf
Gs^Fms, Gs^Fp, Gs^Fms, Gs^Fmw, Aa, Gs^Esa, Co^Vct, Hh, Hh^Fp, Mm, Hh, Gs^Fms, Gs^Fms, Gs^Fp, Gs^Fp, Gs^Fp, Gs^Fms, Gs, Gg^Efm, Gg, Gs^Es, Gg^Edb, Gs^Esa, Gd, Gs^Fmw, Gs^Fp, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Fms, Gs^Fms, Ds, Re, Re, Rb, Rb, Rb, Rb, Rb, Wwf, Wwf, Wwf, Wwf
Gs, Gs^Fms, Gs, Gs, Hh, Hh^Esa, Hh, Hhd, Hhd, Hhd, Hh, Gs, Aa^Esa, Gs^Fp, Gs^Fms, Gs^Fms, Gd, Gs^Efm, Ce, Ket, Ce, Re^Esa, Aa, Aa, Gs^Esa, Gs^Fp, Gs^Fms, Gs^Fds, Gs^Fms, Gs^Fms, Gd, Gg, Ds, Re, Re, Rb, Rb, Rb, Rb, Rb, Rb, Wwf, Wwf, Wwf
Gs, Gs^Edb, Gs, Hh, Gs, Gs^Edb, Hh^Fp, Hh, Gs, Wo, Gg, Hh, Gs, Gs^Esa, Gs, Gd, Ce, Ce, Ce, Cv, Ce, Ce, Gs^Vct, Aa, Gs, Gs^Fms, Gs^Fms, Gs^Fds, Gs^Fms, Gd, Aa^Esa, Gg, Gs^Esa, Re, Re, Re, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Wwf
Gs, Aa, Gs^Esa, Hh, Gs^Esa, Aa, Hh, Hh, Gs, Ww^Ewl, Wo, Hh, Gs^Esa, Gs, Gs^Vct, Re, Re, Ce, Ce, Ce, Gs^Vct, Gs^Vct, Gs^Vct, Gs^Vct, Gg, Gs^Fms, Gs^Fms, Gs^Fms, Gll^Fmw, Gd, Aa^Es, Aa, Gs^Esa, Re, Re, Re, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Wwf
Gs, Aa, Aa, Gs^Esa, Aa, Gs^Esa, Hh, Gs, Gd, Gs, Wo, Aa, Aa, Gs^Vct, Gs^Vct, Gs^Vct, Gs^Vct, Re, Re, Re, Re, Gs^Vct, Gs^Efm, Gs^Efm, Gs^Fms, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fms, Gs, Gs^Esa, Aa, Hh, Re^Es, Re^Es, Wwf^Vm, Re, Rb, Rb, Rb, Rb, Rb, Rb, Wwf
Gs, Hh^Es, Gs, Gs^Esa, Gs, Gs, Gg^Efm, Gg, Gd, Hh, Wwg, Aa^Esa, Wo, Wo, Wwg, Gs^Vct, Ww, Re, Gd, Re, Gg, Gs, Gs^Fmw, Gs^Fms, Hh^Fp, Hh^Fp, Gs^Fms, Gs^Fds, Gs^Fms, Gs^Es, Gs^Efm, Aa, Gs, Re^Es, Ds, Re, Re, Re, Re, Rb, Rb, Rb, Rb, Rb
Hhd, Hh, Gg, Gg, Gg^Efm, Gg^Efm, Gg^Efm, Gs, Gs^Edb, Hh^Fp, Ww, Ww, Hh, Hh^Fp, Hh, Ww^Ewl, Hh, Wo, Wo, Gs^Es, Gs^Esa, Hh, Hh^Fms, Gs^Fp, Hh^Fp, Hh^Fms, Hh^Fms, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Fms, Gs^Efm, Co^Vct, Gs, Gd, Ds, Ce, Re, Re, Rb, Rb, Rb, Rb, Rb
Hh, Hhd, Gg^Es, Gs^Efm, Gg, Gg, Gs, Gs, Gs, Hh, Hh^Efm, Mm, Mm, Hh, Hhd, Hh, Gs, Gs^Es, Wwf^Es, Gs, Aa, Aa, Aa, Hh^Fds, Hh^Fp, Mm, Hh^Fms, Hh^Fms, Gs, Gs^Fms, Gs, Gs, Gs, Gs^Efm, Gs^Efm, Ce, Cv^Kov, Ce, Ds, Re, Re, Rb, Rb, Rb
Gs, Hh, Gg, Gg^Es, Gs, Gs^Efm, Gs, Aa, Aa, Gd, Mm, Ms, Hh^Fmw, Hhd, Ur^Kov, Ur^Kov, Ur^Kov, Gg, Wwf, Gd, Gs, Aa, Hh, Hh^Fms, Hh^Fp, Hh^Fmw, Hh^Fms, Hhd, Gs^Efm, Gd^Efm, Gs^Fp, Gs^Fp, Gs^Fds, Gs^Efm, Gs^Fms, Ce, Ce, Ce, Gg, Hh, Hhd, Re, Rb, Rb
Gs, Gs, Gd, Gd, Gd, Gs, Hh^Fms, Aa, Hh, Hhd, Mm, Mm, Hh^Fds, Gs, Ur^Kov, Gll^Feth, Ur^Kov, Gs, Wo, Gs, Hh, Gs^Esa, Hhd, Hh^Fms, Hh^Fp, Hh^Fp, Hh^Fms, Gs^Efm, Gs^Efm, Gd^Efm, Gs^Fms, Gs^Fp, Gs^Fds, Gs^Fds, Gs^Fds, Gs, Gs^Fms, Gs, Gg^Efm, Gs, Hhd, Re, Wwf^Vm, Rb
Gs, Gd, Hh, Gs, Gs, Hh^Fms, Hh^Fmw, Hh^Fmw, Hh^Fms, Hhd, Hh^Fp, Hh, Hh^Fds, Gs^Efm, Gs^Efm, Ur^Kov, Gs, Gd, Gg, Wo, Wwg, Hh^Fp, Hh, Hhd, Gs^Fms, Gs^Fp, Gd, Hh, Hh, Gd, Gs, Gs^Fp, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Efm, Gg^Efm, Hh^Efm, Hhd, Re^Es, Re, Re
Gs, Gs, Ce, Hhd, Hh^Fms, Gs^Fds, Hh^Fms, Hh, Aa, Hh^Fp, Hh^Fp, Hh^Fp, Hh^Fms, Hh, Hh, Gs, Co^Vct, Gd, Gs, Gg, Gs, Wo, Co^Vct, Gd, Gs, Gs, Gs^Esa, Aa, Aa^Esa, Gs, Gs^Fms, Gs^Fmw, Gs, Gs^Fms, Gs, Gs^Fms, Gs^Efm, Gs^Efm, Gs, Hh, Hh, Re, Re, Rb
Gg, Ce, Cv^Kov, Ce, Gs^Fms, Hh^Fds, Gs^Fms, Gs^Esa, Aa, Aa^Edb, Hh^Fms, Hh^Fds, Gs^Fds, Gs^Fms, Gs^Edb, Hh, Gs, Gd, Gd, Gg, Gs, Ww, Wo, Wo, Wo, Gs^Edb, Gs, Aa, Gs^Esa, Gs, Wo, Gs, Ww, Gs, Gg^Es, Gg^Edb, Gg, Gs^Efm, Ds, Ds, Re^Es, Re, Rb, Wwf
Gs, Ce, Ce, Ce, Gs^Fms, Gs^Fds, Gs^Fp, Gs^Fms, Gs^Esa, Aa, Gs^Fms, Hh^Fds, Gs^Fds, Gs, Aa, Aa, Gs^Esa, Gs^Efm, Gs^Efm, Gg, Gs^Efm, Gs^Efm, Gd, Gd, Gs, Ww^Es, Ww, Wwg, Wwg, Wo, Ww^Ewl, Wo, Gs, Wo, Wo, Wo, Wo, Ds, Re, Re^Es, Re, Rb, Wwf, Wwf
Gs^Efm, Gs, Gs, Gs, Gs, Hh^Fms, Hh^Fp, Hh^Fds, Gs^Efm, Gs^Efm, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Esa, Aa, Gs^Esa, Gs^Efm, Gs^Efm, Gg^Efm, Gs, Gs^Efm, Gs, Gs, Gg^Es, Gs, Gd, Gs, Gs^Fms, Gs, Gs^Fms, Gs, Hh, Co^Vct, Ds, Wwg, Wwf, Wwg, Wwg, Re, Re, Re, Rb, Wwf
Gs^Efm, Gs^Efm, Hhd, Gs, Gs^Es, Gs^Fms, Hh^Fms, Hh^Fp, Hh^Fmw, Gs^Efm, Gs^Fds, Gs^Fds, Gs^Fds, Gs, Gs, Aa, Gg, Gs, Gs, Gs, Gs, Gs, Gg, Gg^Edb, Gs^Efm, Gs^Efm, Gd^Efm, Gs, Gs^Fds, Gs^Fms, Gs^Fms, Hh, Hhd, Ds, Re, Rb, Wwf, Wwg, Wwf, Wwg, Re, Re, Rb, Rb
Gg^Efm, Gs^Efm, Gs, Hhd, Hhd^Es, Gs, Hh, Hh^Fp, Hh^Fp, Hh^Fms, Hh^Fds, Hh^Fms, Hh^Fds, Hh^Fms, Gs, Gg^Es, Gg, Gg, Gs, Gs^Es, Gs, Gs, Gs, Gg, Gs, Gs, Gs^Esa, Gd, Gs, Gs^Fms, Gs, Gs^Edb, Re^Es, Re, Re, Re, Re, Wwg, Wwg, Wwf, Wwf, Rb, Rb, Rb
Gs, Gg^Efm, Gs, Gs, Gs, Hh, Gs, Hh^Fms, Hh^Fms, Hh^Fp, Hh^Fp, Hh^Fds, Hh^Fds, Gs^Fds, Gs, Gg, Gg^Efm, Gs^Efm, Gs, Gg^Es, Gs, Gs, Gs^Efm, Gs, Aa, Gs^Esa, Gs^Esa, Gs, Gs^Fds, Gs^Fms, Gs^Fms, Re, Re, Re, Re, Re, Re, Rb, Rb, Wwg, Wwg, Wwf, Rb, Rb
Sm, Gs^Em, Ss, Ss, Sm, Gs, Gd^Em, Gd, Hhd, Hh^Fms, Hh^Fms, Hh^Fp, Hh^Fp, Hh^Fms, Gs^Fms, Gs^Efm, Gs, Gs^Efm, Gs, Gg, Gg^Efm, Gs, Gs, Gs^Esa, Aa, Aa^Esa, Gs^Edb, Gs^Fms, Gs^Efm, Gs, Re^Es, Re^Es, Re, Re, Re, Re, Re, Wwf^Vm, Rb, Rb, Wwg, Wwf, Rb, Rb
Ss, Sm, Sm, Ss, Ss, Ss, Sm, Gd, Gd, Hh, Gs, Hh^Fms, Hh^Fds, Hh^Fms, Hh^Fms, Gs^Fmw, Gs, Gs, Gs, Gs, Gs^Efm, Gg, Gs, Gs^Esa, Aa, Aa, Gs, Gd, Gd^Efm, Gs^Efm, Re^Es, Re^Es, Re, Re, Rb, Rb, Rb, Re, Rb, Rb, Wwg, Wwf, Rb, Rb
Sm, Sm, Sm, Ss, Ss, Ss, Sm, Ss, Ss, Gd^Es, Gd, Hh, Hh^Fms, Hh^Fms, Hh, Hh^Fms, Hh, Co^Vct, Gs, Gs, Gs, Gg, Gg^Es, Gs, Gs^Esa, Gs, Gs, Gs^Efm, Ds, Re^Es, Re, Re, Re, Rb, Rb, Rb, Rb, Rb, Wwf, Wwg, Wwf, Wwf, Wwf, Wwf
Ss, Rb, Sm, Ss, Ss, Sm, Rb, Rb, Rb, Ss, Gs, Hh, Hhd, Mm, Hh^Fms, Hh^Fms, Gs^Esa, Hh^Esa, Hh^Esa, Hh, Gs, Gs^Efm, Gg^Efm, Gs, Gs, Gs, Gg^Efm, Ds, Rb, Re, Rb, Rb, Wwf, Rb, Rb, Rb, Rb, Wwf, Wwf, Wwg, Wwg, Wwf, Wwf, Wwf
Sm, Ss, Ss, Sm, Sm, Ss^Vhs, Sm, Ss, Sm, Sm, Gs^Efm, Gs^Efm, Mm, Mm, Mm, Hh, Gs^Esa, Aa^Esa, Aa^Esa, Hh^Fp, Hh, Gs, Gs, Gs, Gd, Gs^Es, Gg, Ds, Wo, Wwf, Wwf, Wwf, Wwf, Wwf, Wwg, Wwg, Wwg, Wwg, Wwg, Wwg, Wwg, Wwg, Wwg, Wwg
Rb, Sm, Ss, Ss, Ss, Ss, Sm, Ss, Ss, Sm, Gs, Hh, Mm, Mm, Hh^Fp, Hh, Gs, Aa, Aa, Gs^Esa, Gs, Gs, Gd^Efm, Gd^Efm, Gd, Gs, Wo, Wo, Wo, Wwg, Wwg, Wwg, Wwg, Wwg, Wwf, Wwf, Wwf, Wwf, Wwf, Wwf, Wwf, Wwg, Wwg, Wwg
Rb, Rb, Ss, Ss, Ss, Sm, Sm, Rb, Sm, Sm, Gs, Hh^Efm, Hh^Fmw, Hh, Hhd, Hhd, Gs, Gs, Gs^Esa, Aa, Gs, Gd, Gs^Efm, Gs^Efm, Gg, Wo, Gs, Gs, Gd, Ds, Re, Re, Re, Re, Re, Re, Re, Rb, Rb, Wwf, Wwf, Wwf, Wwf, Wwg
Ss, Ss, Ss, Ss, Ss, Sm, Sm, Sm, Sm, Gs, Gs^Efm, Hh^Fp, Hh^Fms, Hh, Gs^Es, Hh, Co^Vct, Gs, Gs, Gs^Esa, Gs, Gs^Efm, Gs, Gs, Wo, Wo, Gs^Esa, Aa, Aa, Aa, Ds, Re, Re^Es, Re, Re, Wwf^Vm, Re, Re, Re^Es, Rb, Rb, Rb, Wwf, Wwg
Ss, Ss^Vhs, Sm, Sm, Sm, Sm, Ss, Ss, Gs^Esa, Gs, Hh^Esa, Hh^Fp, Hh^Fds, Hh^Fms, Gs, Gs, Gs, Hh, Gs, Gs, Wo, Gg^Es, Ww, Gs, Wo, Gs, Gs, Aa^Esa, Aa, Gs^Esa, Gs^Fds, Gs^Fds, Gs^Fds, Re^Es, Re^Es, Re^Es, Re, Re^Es, Re^Es, Rb, Rb, Rb, Rb, Wwg
Ss, Ss, Rb, Rb, Rb, Sm, Ss, Sm, Aa, Aa, Hh, Hh^Fds, Hh^Fds, Hh^Fms, Gs, Gg^Efm, Gs^Efm, Gd, Gd, Wo, Hh, Wwg, Hh, Wo, Gg^Efm, Gs^Es, Gs^Efm, Gs^Esa, Gd, Gs^Fds, Gs^Fds, Gs^Fms, Ds, Ds, Re^Es, Re, Re, Re, Rb, Rb, Rb, Rb, Rb, Rb
Sm, Sm, Ss, Rb, Sm, Sm, Ss, Gs^Esa, Aa, Aa^Esa, Gs, Hh^Fms, Gs^Fds, Hh^Fds, Hh^Fms, Gg^Efm, Gs, Gd^Efm, Gs^Efm, Wwg, Hh, Hhd, Gs, Gs, Gs^Efm, Gg^Efm, Gs, Gd, Gd, Gs, Gs^Efm, Gg, Ds, Re^Es, Re^Es, Re, Re, Re, Rb, Rb, Rb, Rb, Wwf, Wwf
Sm, Sm, Ss, Sm, Ss, Sm, Sm, Gs, Gs, Gs^Esa, Gs, Gs^Fms, Gs, Hh^Fds, Hh^Fmw, Gs, Gd, Gd, Wwf, Ww, Gs, Gs^Es, Gs, Gs, Gs^Efm, Gg, Gg, Gs, Gd, Gs^Efm, Gg, Gs^Edb, Gs^Fds, Re^Es, Re, Re, Re, Re, Rb, Rb, Rb, Rb, Wwf, Wwf
Ss, Sm, Ss, Ss, Sm, Sm, Sm, Ss, Gs^Em, Gs^Efm, Gs^Efm, Gs^Efm, Gs, Gs^Fms, Gs, Gs, Wwf, Wwf^Es, Gs, Gs, Co^Edt, Ko, Co^Edt, Gs^Edt, Gs, Gs, Hh^Es, Hh^Efm, Gd, Gg^Es, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Fds, Re, Re, Re, Re, Re, Rb, Rb, Rb, Rb, Wwf
Sm, Sm, Sm, Ss, Ss, Ss, Ss, Sm, Gs, Gg, Hh, Hh^Es, Gs, Gs, Wo, Ww, Gs, Gs, Rb, Co, Rd, Rb, Rb, Co, Rd, Gs, Gs, Hh, Gd, Gs, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Re, Re, Re, Re^Es, Re, Rb, Rb, Rb, Rb
Sm, Sm, Ss, Sm, Sm, Ss, Sm, Sm, Gs, Gg, Hh, Gs^Es, Wo, Wo, Gs, Gs^Edt, Co, Co^Edt, Re, Rb, Rb^Vct, Rd^Vct, Re^Vct, Rb^Edt, Rb, Co, Co^Edt, Gs, Gd, Gs, Gs^Fds, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fds, Re, Re, Re^Es, Re^Es, Re, Rb, Rb, Rb, Rb
Sm, Ss, Sm, Sm, Ss, Ss, Ss, Sm, Gs, Gg^Efm, Gs, Ww, Gs, Gs^Efm, Gs^Efm, Gs, Ko^Edt, Gd^Edt, Rb^Vct, Rb^Vct, Re^Vct, Rb^Vct, Rd^Vct, Re^Vct, Rb^Vct, Re^Edt, Ko^Edt, Gs, Gs, Gs, Gs^Fds, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fds, Gd, Re, Re, Re, Re, Rb, Rb, Wwf, Wwf
Ss, Ss, Ss, Rb, Ss, Ss, Ss, Gs, Gs^Efm, Gs^Efm, Gs, Wwf, Gs, Gs^Efm, Gd^Es, Gs, Co, Rb, Rb^Vct, Re^Vct, Rb^Vct, Rb^Vct, Rb^Vct, Re^Vct, Rb^Vct, Rb, Co, Gs^Efm, Gs^Efm, Gs^Fds, Gs^Fms, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fds, Ds, Ds, Re, Re, Re, Rb, Rb, Wwf, Wwf
Sm, Sm, Ss, Ss^Vhs, Ss, Sm, Gs, Gs, Gd^Efm, Gd, Gs, Wwf, Gs^Es, Gd, Gd^Efm, Gs, Gs, Co, Rd, Rd^Vct, Re^Vct, Gd^Vct, Rb^Vct, Rd^Vct, Rb, Co, Gs, Gs, Gg^Efm, Gg, Gg, Gg, Gg, Gs^Fds, Gs, Gd^Efm, Ds, Re, Re, Re, Rb, Rb, Wwf, Wwf
Sm, Rb, Ss, Ss, Gs^Em, Gs, Gs, Gd, Gd, Gd, Ww, Wwf, Gs, Gs, Gd^Efm, Gd, Gs, Rb, Co, Gd^Edt, Rb^Edt, Rb, Rb, Rb, Co, Rb, Gs, Gs, Gg^Efm, Gg, Gs, Gs, Gs, Gg, Gg^Efm, Gs^Efm, Gs, Ds, Re, Re, Re, Rb, Rb, Wwf
Ss, Rb, Ss, Ss, Hh^Efm, Hh, Gd, Gd, Wwg, Ww, Gg, Gs, Hh, Gs^Efm, Gd, Gd, Gd, Gs^Edt, Co, Rb, Co, Ko, Co, Rd^Edt, Co^Edt, Gs, Gs, Gs, Gs, Gs, Gg^Efm, Gs^Efm, Gs^Efm, Gs^Efm, Gs, Gg^Efm, Gs^Efm, Gd^Efm, Ds, Re, Re, Ww^Vm, Re^Es, Wwf
Rb, Rb, Ss, Ss, Hh, Gd, Gs, Gs, Wwg, Gs, Gs, Hh^Efm, Hh, Gs^Efm, Gs^Efm, Gd^Efm, Gd, Gs, Gs, Co, Gs, Gs^Edt, Gs, Co^Edt, Gs^Edt, Gs^Edt, Hh, Hh, Hh, Gs^Es, Gg, Gg, Gs, Gs, Gs, Gg, Gs^Fds, Gs^Fds, Gs^Fms, Ds, Re, Re^Es, Re^Es, Re^Es
Ss, Ss, Ss, Ss, Gs, Gs, Gs, Gd, Wwg, Gs, Gs, Hh, Gs, Gs, Gs, Gs, Gs, Gd, Gs, Gs, Gs, Gs, Gs, Gs, Gs, Gs, Gs, Hh^Efm, Gs, Gg, Gs, Gs, Gs, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fds, Gs^Fms, Gd, Gs^Fms, Gs, Re, Re, Re    
"
[/terrain_mask]
#enddef

#define TSUNAMI_3
[terrain_mask]
    x,y=0,0
    alignment=even
    mask="
    Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Gs^Fms, Hh, Hh^Fms, Hh^Fms, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Wwg, Wwg, Wwg, Wog, Ww, Wog, Wog, Wo, Wo, Wo, Wo, Wo, Wo
    Gs^Fms, Gs^Fms, Gs^Fds, Gs^Fds, Gs^Fp, Gs^Fds, Gs^Fds, Gs^Fds, Hh^Fds, Hh^Fms, Hh^Fms, Hh^Fms, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Wwg, Wwg, Wog, Wog, Wog, Wo, Wo, Wo, Wo, Wo, Wo, Wo, Wo
    Gs^Fds, Gs^Fds, Gs^Fp, Gs^Fms, Gs^Fp, Gs^Fms, Hh, Hh^Fds, Ms, Hh^Fmw, Hh^Fmw, Hh^Fds, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Wwg, Wwg, Wwg, Wog, Wo, Wo, Wo, Wo, Wo, Wo, Wo, Wo, Wo
    Gs^Fds, Gs^Fds, Gs^Fp, Gs^Fp, Gs^Fms, Gs^Fms, Gs, Mm, Mm, Mm, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Rb^Es, Gll^Fdw, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Wwg, Wwg, Wwg, Wog, Wo, Wo, Wo, Wo, Wo, Wo, Wo, Wo
    Gs^Fms, Gs^Fp, Gs^Fms, Gs^Fmw, Aa, Gs^Esa, Co^Vct, Hh, Hh^Fp, Mm, Hh, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Rb, Rb^Es, Rb^Es, Rb, Rb, Rb, Sm, Sm, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Ds, Wwg, Wwg, Wog, Wog, Wo, Wo, Wo, Wo, Wo, Wo, Wo
    Gs, Gs^Fms, Gs, Gs, Hh, Hh^Esa, Hh, Hhd, Hhd, Hhd, Hh, Rb^Es, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Rb, Rb, Rb^Edt, Rb^Dr, Rb^Edt, Rb, Sm, Sm, Sm, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Sm, Rb, Ds, Wwg, Wwg, Wog, Wo, Wo, Wo, Wo, Wo, Wo, Wo, Wo
    Gs, Gs^Edb, Gs, Hh, Gs, Gs^Edb, Hh^Fp, Hh, Rb, Wog, Rb, Hh, Rb, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Dr, Rb^Edt, Rb^Dr, Rb^Edt, Rb^Edt, Rb^Edt, Sm, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Sm, Sm, Rb, Rb^Es, Wwg, Wwg, Wwg, Wo, Wo, Wo, Wo, Wo, Wo, Wo, Wo
    Gs, Aa, Gs^Esa, Hh, Gs^Esa, Aa, Hh, Hh, Rb^Es, Wog, Wog, Hh, Sm, Rb^Edt, Rb^Edt, Rb^Dr, Rb^Edt, Rb^Edt, Rb^Dr, Rb^Dr, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Edt, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Sm, Sm, Rb, Rb, Wwg, Wwg, Wwg, Wog, Wog, Wog, Wo, Wo, Wo, Wo, Wo
    Gs, Aa, Aa, Gs^Esa, Aa, Gs^Esa, Hh, Rb, Rb^Es, Rb^Edt, Wog, Sm, Sm, Sm^Edt, Sm^Edt, Rb^Edt, Sm^Edt, Rb^Edt, Rb, Rb, Rb^Edt, Rb^Edt, Rb, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Rb, Rb^Es, Rb, Hh, Wwg^Es, Wwg^Es, Ww^Dr, Wwg, Wog, Wog, Wog, Wo, Wo, Wo, Wo
    Gs, Hh^Es, Gs, Gs^Esa, Gs, Gs, Gg^Efm, Gg, Gd, Hh, Wog, Sm, Wog, Wog, Wog, Sm^Edt, Wog, Sm, Sm, Rb, Rb, Rb^Es, Gll^Fdw, Gll^Fdw, Hh^Fp, Hh^Fp, Gll^Fdw, Gll^Fdw, Gll^Fdw, Rb, Rb^Edt, Rb^Es, Rb, Wwg^Es, Ds, Wwg, Wwg, Wwg, Wwg, Wog, Wog, Wo, Wo, Wo
    Hhd, Hh, Gg, Gg, Gg^Efm, Gg^Efm, Gg^Efm, Gs, Gs^Edb, Hh^Fp, Wog, Wog, Hh, Hh^Fp, Hh, Wog, Hh, Wog, Wog, Sm, Sm, Hh, Hh^Fms, Gll^Fdw, Hh^Fp, Hh^Fms, Hh^Fms, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Rb, Rb^Dr, Rb, Rb, Ds^Edt, Rb^Edt, Wwg, Wwg, Wog, Wog, Wo, Wo, Wo
    Hh, Hhd, Gg^Es, Gs^Efm, Gg, Gg, Gs, Gs, Gs, Hh, Hh^Efm, Mm, Mm, Hh, Hhd, Hh, Sm, Sm, Wog, Sm, Sm, Rb^Es, Rb^Es, Hh^Fds, Hh^Fp, Mm, Hh^Fms, Hh^Fms, Rb, Gll^Fdw, Rb, Rb, Rb, Rb, Rb, Rb^Dr, Rb^Dr, Rb^Dr, Ds^Edt, Wwg, Wwg, Wog, Wo, Wo
    Gs, Hh, Gg, Gg^Es, Gs, Gs^Efm, Gs, Aa, Aa, Gd, Mm, Ms, Hh^Fmw, Hhd, Ur^Edt, Ur^Edt, Ur, Sm, Wog, Sm, Sm, Rb^Es, Hh, Hh^Fms, Hh^Fp, Hh^Fmw, Hh^Fms, Hhd, Rb^Es, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Rb, Gll^Fdw, Rb^Edt, Rb^Dr, Rb^Edt, Rb^Edt, Hh, Hhd, Wwg, Wo, Wo
    Gs, Gs, Gd, Gd, Gd, Gs, Hh^Fms, Aa, Hh, Hhd, Mm, Mm, Hh^Fds, Rb, Ur, Rb^Edt, Ur, Sm, Wog, Sm, Hh, Rb, Hhd, Hh^Fms, Hh^Fp, Hh^Fp, Hh^Fms, Rb, Rb^Es, Rb^Es, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Rb^Edt, Gll^Fdw, Rb, Rb, Rb, Hhd, Wwg, Ww^Dr, Wo
    Gs, Gd, Hh, Gs, Gs, Hh^Fms, Hh^Fmw, Hh^Fmw, Hh^Fms, Hhd, Hh^Fp, Hh, Hh^Fds, Rb^Es, Rb, Ur, Rb, Sm, Sm, Wog, Wog, Hh^Fp, Hh, Hhd, Gll^Fdw, Gll^Fdw, Rb, Hh, Hh, Rb, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Rb, Rb^Es, Hh^Efm, Hhd, Wwg^Es, Wwg, Wwg
    Gs, Gs, Ce, Hhd, Hh^Fms, Gs^Fds, Hh^Fms, Hh, Rb, Hh^Fp, Hh^Fp, Hh^Fp, Hh^Fms, Hh, Hh, Rb, Rb^Dr, Rb, Rb, Sm, Sm, Wog, Sm^Dr, Sm, Sm, Rb, Rb^Es, Rb, Rb, Rb, Gll^Fdw, Gll^Fdw, Sm, Gll^Fdw, Sm, Gll^Fdw, Sm, Rb, Rb^Es, Hh, Hh, Wwg, Wwg, Wog
    Gg, Ce, Cv^Kov, Ce, Gs^Fms, Hh^Fds, Gs^Fms, Rb, Rb^Es, Rb, Hh^Fms, Hh^Fds, Gll^Fdw, Gll^Fdw, Rb, Hh, Rb, Rb, Rb, Rb, Sm, Wog, Wog, Wog, Wog, Sm, Sm, Sm, Sm, Sm, Wog, Sm, Wog, Sm, Sm, Sm, Sm, Rb, Ds, Ds, Wwrg, Wwg, Wog, Wog
    Gs, Ce, Ce, Ce, Gs^Fms, Gs^Fds, Gs^Fp, Gs^Fms, Rb, Rb, Gll^Fdw, Hh^Fds, Gll^Fdw, Rb, Rb, Rb, Rb, Rb^Es, Rb, Rb, Rb, Sm, Sm, Sm, Sm, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Sm, Wog, Wog, Wog, Wog, Ds, Wwg, Wwrg, Wwg, Wog, Wog, Wog
    Gs^Efm, Gs, Gs, Gs, Gs, Hh^Fms, Hh^Fp, Hh^Fds, Rb, Rb^Es, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Rb, Sm, Sm, Rb, Rb, Rb^Edt, Rb, Rb, Sm, Sm, Sm, Sm, Sm, Sm, Gll^Fdw, Sm, Gll^Fdw, Sm, Hh, Sm^Dr, Ds, Wog, Wog, Wog, Wog, Wwg, Wwg, Wwg, Wog, Wog
    Gs^Efm, Gs^Efm, Hhd, Gs, Gs^Es, Gs^Fms, Hh^Fms, Hh^Fp, Hh^Fmw, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Rb, Rb, Sm, Sm, Rb, Rb, Rb, Rb^Es, Rb^Es, Rb, Sm, Sm, Sm, Rb, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Hh, Hhd, Ds, Wwg, Wwg, Wwg, Wog, Wog, Wog, Wwg, Wwg, Wog, Wog
    Gg^Efm, Gs^Efm, Gs, Hhd, Hhd^Es, Gs, Hh, Hh^Fp, Hh^Fp, Hh^Fms, Hh^Fds, Hh^Fms, Hh^Fds, Hh^Fms, Rb, Sm, Sm, Sm, Rb, Rb, Rb, Rb^Es, Rb, Sm, Rb, Rb, Rb^Edt, Rb^Es, Rb, Gll^Fdw, Rb, Rb, Ww^Es, Wwg, Wwg, Wwg, Wwg, Wog, Wog, Wog, Wog, Wog, Wog, Wog
    Gs, Gg^Efm, Gs, Gs, Gs, Hh, Gs, Hh^Fms, Hh^Fms, Hh^Fp, Hh^Fp, Hh^Fds, Hh^Fds, Gll^Fdw, Rb, Rb^Es, Rb, Rb, Rb^Es, Rb, Rb, Rb, Rb, Sm, Rb, Rb, Rb, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Wwg, Wwg, Wwg, Wwg, Wwg, Wwg, Wog, Wog, Wog, Wog, Wog, Wog, Wog
    Sm, Gs^Em, Ss, Ss, Sm, Gs, Gd^Em, Gd, Hhd, Hh^Fms, Hh^Fms, Hh^Fp, Hh^Fp, Hh^Fms, Gll^Fdw, Rb, Sm, Sm, Rb, Rb, Rb, Rb^Edt, Rb, Rb, Rb, Rb, Rb, Gll^Fdw, Rb, Rb, Wwrg, Wwrg, Wwg, Wwg, Wwg, Wwg, Wwg, Ww^Dr, Wog, Wog, Wog, Wog, Wog, Wog
    Ss, Sm, Sm, Ss, Ss, Ss, Sm, Gd, Gd, Hh, Gs, Hh^Fms, Hh^Fds, Hh^Fms, Hh^Fms, Gll^Fdw, Sm, Sm, Rb, Rb, Rb, Rb, Rb, Rb^Es, Rb^Es, Rb, Rb, Rb, Rb, Rb^Es, Wwrg, Wwrg, Wwg, Wwg, Wog, Wog, Wog, Wwg, Wog, Wog, Wog, Wog, Wog, Wog
    Sm, Sm, Sm, Ss, Ss, Ss, Sm, Ss, Ss, Gd^Es, Gd, Hh, Hh^Fms, Hh^Fms, Hh, Hh^Fms, Hh, Rb^Dr, Rb, Rb, Rb, Rb, Rb, Rb^Es, Rb, Rb^Es, Rb, Rb, Ds, Wwg^Es, Wwg, Wwg, Wwg, Wo, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog
    Ss, Rb, Sm, Ss, Ss, Sm, Rb, Rb, Rb, Ss, Gs, Hh, Hhd, Mm, Hh^Fms, Hh^Fms, Rb, Hh^Esa, Hh^Esa, Hh, Rb, Rb, Rb, Rb^Edt, Rb, Rb, Rb, Ds, Wwg, Wwg, Wwg, Wwg, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog
    Sm, Ss, Ss, Sm, Sm, Ss^Vhs, Sm, Ss, Sm, Sm, Gs^Efm, Gs^Efm, Mm, Mm, Mm, Hh, Rb^Edt, Rb, Rb, Hh^Fp, Hh, Rb, Rb^Es, Rb, Rb, Rb, Sm, Ds, Wog, Wwg, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog
    Rb, Sm, Ss, Ss, Ss, Ss, Sm, Ss, Ss, Sm, Gs, Hh, Mm, Mm, Hh^Fp, Hh, Rb, Rb^Es, Rb, Rb, Rb, Rb, Rb, Rb, Sm, Sm, Wo, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wwg, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog, Wog
    Rb, Rb, Ss, Ss, Ss, Sm, Sm, Rb, Sm, Sm, Gs, Hh^Efm, Hh^Fmw, Hh, Hhd, Hhd, Rb, Rb, Rb^Es, Rb, Sm, Rb, Sm, Sm, Sm, Wo, Sm, Sm, Sm, Ds, Wwg, Wog, Wwg, Wwg, Wwg, Wwg, Wwg, Wog, Wog, Wog, Wog, Wog, Wog, Wog
    Ss, Ss, Ss, Ss, Ss, Sm, Sm, Sm, Sm, Gs, Gs^Efm, Hh^Fp, Hh^Fms, Hh, Rb, Hh, Rb^Dr, Rb, Rb, Sm, Sm, Sm, Sm, Sm, Wo, Wo, Sm, Sm, Sm, Rb, Ds, Wwg, Wwg^Es, Wwg, Wwg, Ww^Dr, Wwg, Wwg, Wwrg, Wog, Wog, Wog, Wog, Wog
    Ss, Ss^Vhs, Sm, Sm, Sm, Sm, Ss, Ss, Rb, Gs, Hh^Esa, Hh^Fp, Hh^Fds, Hh^Fms, Rb, Rb^Edt, Rb, Hh, Sm, Sm, Wo, Sm, Wog, Sm, Wo, Sm, Sm, Rb^Es, Rb, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Wwrg, Wwrg, Wwg^Es, Wwg, Wwrg, Wwrg, Wog, Wog, Wog, Wog, Wog
    Ss, Ss, Rb, Rb, Rb, Sm, Ss, Sm, Rb^Edt, Rb, Hh, Hh^Fds, Hh^Fds, Hh^Fms, Rb, Rb^Es, Sm, Sm, Sm, Wo, Hh, Wog, Hh, Wog, Sm, Sm, Rb, Rb, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Ds, Ds, Wwrg, Wwg, Wwg, Wwg, Wog, Wog, Wog, Wog, Wog, Wog
    Sm, Sm, Ss, Rb, Sm, Sm, Ss, Rb, Rb^Es, Rb, Rb, Hh^Fms, Gll^Fdw, Hh^Fds, Hh^Fms, Rb, Sm, Sm, Sm, Wog, Hh, Hhd, Rb, Sm, Rb, Sm, Rb, Rb, Rb^Es, Rb, Sm, Sm, Ds, Wwrg, Wwg^Es, Wwg, Wwg, Wwg, Wog, Wog, Wog, Wog, Wog, Wog
    Sm, Sm, Ss, Sm, Ss, Sm, Sm, Rb, Rb, Rb^Es, Rb, Gll^Fdw, Rb, Hh^Fds, Hh^Fmw, Sm, Sm, Sm, Wog, Wog, Sm, Rb, Rb, Rb, Rb^Es, Rb, Rb, Rb, Rb, Rb, Sm, Sm, Gll^Fdw, Wwrg, Wwg, Wwg, Wwg, Wwg, Wog, Wog, Wog, Wog, Wog, Wog
    Ss, Sm, Ss, Ss, Sm, Sm, Sm, Ss, Rb, Rb, Rb, Rb^Edt, Rb, Gll^Fdw, Sm, Sm, Wog, Wog, Sm, Sm, Rb^Dr, Ko, Rb^Dr, Rb, Rb, Rb, Hh^Es, Hh^Efm, Rb, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Wwg, Wwg, Wwg, Wwg, Wwg, Wog, Wog, Wog, Wog, Wog
    Sm, Sm, Sm, Ss, Ss, Ss, Ss, Sm, Rb^Edt, Rb, Hh, Hh^Es, Sm, Sm, Wog, Wog, Sm, Sm, Rb^Edt, Co, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Dr, Rb, Rb, Rb, Hh, Rb, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Wwg, Wwg, Wwg, Wwrg, Wwg, Wog, Wog, Wog, Wog
    Sm, Sm, Ss, Sm, Sm, Ss, Sm, Sm, Rb, Rb, Hh, Sm, Wog, Wog, Sm, Sm, Rb^Dr, Rb^Dr, Rb, Rb^Edt, Rb, Rb^Edt, Rb^Edt, Rb, Rb^Edt, Rb^Dr, Rb^Dr, Sm, Sm, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Wwg, Wwg, Ww^Es, Wwrg, Wwg, Wog, Wog, Wog, Wog
    Sm, Ss, Sm, Sm, Ss, Ss, Ss, Sm, Rb^Es, Rb, Sm, Wog, Sm, Sm, Rb^Es, Sm, Ko, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Dr, Sm, Sm, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Rb, Wwg, Wwg, Wwg, Wwg, Wog, Wog, Wog, Wog
    Ss, Ss, Ss, Rb, Ss, Ss, Ss, Rb, Rb, Sm, Sm, Wog, Sm, Sm, Rb, Rb, Rb^Dr, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Edt, Rb^Edt, Rb, Rb^Edt, Rb^Dr, Rb, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Ds, Ds, Wwg, Wwg, Wwg, Wog, Wog, Wog, Wog
    Sm, Sm, Ss, Ss^Vhs, Ss, Sm, Rb, Rb, Sm, Sm, Sm, Wog, Sm, Sm, Sm, Rb, Rb, Rb^Dr, Rb, Rb^Edt, Rb^Edt, Sm, Rb^Edt, Rb^Edt, Rb^Edt, Co, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Gll^Fdw, Rb, Rb, Ds, Wwg, Wwg, Wwg, Wog, Wog, Wog, Wog
    Sm, Rb, Ss, Ss, Rb, Rb, Sm, Sm, Sm, Sm, Wog, Wog, Sm, Sm, Sm, Sm, Rb, Rb, Rb^Dr, Rb^Edt, Rb^Edt, Sm, Rb^Edt, Rb, Rb^Dr, Rb, Rb, Rb^Es, Rb, Rb, Sm, Rb^Es, Sm, Rb, Rb^Edt, Rb, Rb^Es, Ds, Wwg, Wwg, Wwg, Wog, Wog, Wog
    Ss, Rb, Ss, Ss, Hh^Efm, Hh, Sm, Sm, Wog, Wog, Sm, Sm, Hh, Sm, Sm, Sm, Rb, Rb^Edt, Co, Rb, Rb^Dr, Rb^Dr, Rb^Dr, Rb^Edt, Rb^Dr, Rb^Edt, Rb, Rb, Rb, Rb, Rb, Sm, Sm, Rb, Rb^Edt, Rb, Rb, Rb, Ds, Wwg, Wwg, Ww^Dr, Wwrg, Ww
    Rb, Rb, Ss, Ss, Hh, Rb, Sm, Sm, Wog, Sm, Sm, Hh^Efm, Hh, Rb^Es, Rb, Sm, Rb, Rb, Rb^Edt, Co, Rb^Edt, Rb, Rb, Rb^Dr, Rb, Rb^Edt, Hh, Hh, Hh, Rb, Rb, Rb, Rb, Rb, Gll^Fdw, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Ds, Wwg, Wwg^Es, Wwrg, Wwrg
    Ss, Ss, Ss, Ss, Gs, Rb, Sm, Sm, Wog, Sm, Rb, Hh, Gs, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Rb, Hh^Efm, Rb, Rb, Rb, Rb^Es, Rb, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gll^Fdw, Gd, Rb, Rb, Wwg, Wwg, Wwg
"
[/terrain_mask]
#enddef

#define TSUNAMI_WAVE
{INCIDENTAL_MUSIC silence.ogg}
[sound]
    name=tsunami.ogg
[/sound]
[terrain]
    terrain=Wog
    layer=base
    include_borders=yes
    x=42,43
[/terrain]
[terrain]
    terrain=^Edt
    layer=overlay
    x=42
    [and]
        terrain=*^V*,*^F*
    [/and]
[/terrain]
{VARIABLE tsunami 41}
[while]
    [variable]
        name=tsunami
        greater_than=11
    [/variable]
    [do]
        [switch]
            variable=tsunami
            [case]
                value=41
                {VARIABLE type_water Wog}
            [/case]
            [case]
                value=33
                {VARIABLE type_water Wo}
            [/case]
            [case]
                value=25
                {VARIABLE type_water Wwg}
            [/case]
            [case]
                value=17
                {VARIABLE type_water Ww}
            [/case]
            [else][/else]
        [/switch]
        [terrain]
            terrain=$type_water
            layer=base
            x=$tsunami
            [and]
                [not]
                    terrain=H*^*,M*^*,Co*^*,Ko*^*
                [/not]
            [/and]
            [or]
                terrain=Co^Vct
                x=$tsunami
            [/or]
        [/terrain]
        [terrain]
            terrain=$type_water
            layer=overlay
            x=$tsunami
            [and]
                terrain=$type_water^Es*,$type_water^Efm,$type_water^Ewl
            [/and]
        [/terrain]
        [terrain]
            terrain=^Edt
            layer=overlay
            x=$tsunami
            [and]
                terrain=$type_water^V*,$type_water^F*
            [/and]
        [/terrain]
        [kill]
            x=$tsunami
            [filter_location]
                terrain=W*^*
            [/filter_location]
            #[not] #todo: decide what to do with the naga and merfolk
            #    race=naga,merman,drake
            #[/not]
        [/kill]
        [switch]
            variable=tsunami
            [case]
                value=23
                [remove_item]
                    x,y=23,41
                [/remove_item]
            [/case]
            [case]
                value=17
                [remove_item]
                    x,y=17,"37-38"
                [/remove_item]
            [/case]
            [else][/else]
        [/switch]
        [redraw][/redraw]
        [delay]
            time=25
        [/delay]
        {VARIABLE_OP tsunami sub 1}
    [/do]
[/while]
[while]
    [variable]
        name=tsunami
        not_equals=4
    [/variable]
    [do]
        [switch]
            variable=tsunami
            [case]
                value=11
                {VARIABLE y_wave "26"}
            [/case]
            [case]
                value=10
                {VARIABLE y_wave "23-29"}
            [/case]
            [case]
                value=9
                {VARIABLE y_wave "12,24,21-29,30"}
            [/case]
            [case]
                value=8
                {VARIABLE y_wave "9-12,21-29"}
            [/case]
            [case]
                value=7
                {VARIABLE y_wave "1,9-13,21-29"}
            [/case]
            [case]
                value=6
                {VARIABLE y_wave "1-29"}
            [/case]
            [else][/else]
        [/switch]
        [terrain]
            terrain=Ww
            layer=base
            x=$tsunami
            include_borders=no
            [not]
                y=$y_wave
            [/not]
            [and]
                [not]
                    terrain=H*^*,M*^*,Co*^*,Ko*^*,S*^*
                [/not]
            [/and]
        [/terrain]
        [terrain]
            terrain=Ww
            layer=overlay
            x=$tsunami
            [and]
                terrain=Ww^Es*,Ww^Efm,Ww^Ewl,*^Em
            [/and]
        [/terrain]
        [terrain]
            terrain=^Edt
            layer=overlay
            x=$tsunami
            [and]
                terrain=Ww^V*,Ww^F*
            [/and]
        [/terrain]
        [kill]
            x=$tsunami
            [filter_location]
                terrain=W*^*
            [/filter_location]
            #[not] #todo: think about what makes the most sense
            #    race=naga,merman,drake
            #[/not]
        [/kill]
        [redraw][/redraw]
        [delay]
            time=25
        [/delay]
        {VARIABLE_OP tsunami sub 1}
    [/do]
[/while]
{CLEAR_VARIABLE tsunami}
{CLEAR_VARIABLE y_wave}
{CLEAR_VARIABLE type_water}
{MODIFY_TERRAIN Ww "5-10" 43}
#enddef

#define ASSIGN_ROLES_TO_THE_ELVES
[modify_unit]
    [filter]
        x,y=15,12
        side=2
    [/filter]
    role=ritual1
[/modify_unit]
[modify_unit]
    [filter]
        x,y=16,12
        side=2
    [/filter]
    role=ritual2
[/modify_unit]
[modify_unit]
    [filter]
        x,y=16,13
        side=2
    [/filter]
    role=ritual3
[/modify_unit]
[modify_unit]
    [filter]
        x,y=15,14
        side=2
    [/filter]
    role=ritual4
[/modify_unit]
[modify_unit]
    [filter]
        x,y=14,13
        side=2
    [/filter]
    role=ritual5
[/modify_unit]
[modify_unit]
    [filter]
        x,y=14,12
        side=2
    [/filter]
    role=ritual6
[/modify_unit]
#enddef

#define SCHEDULE_VOLCANIC_CLOUD
	[time]
        red=-10
        green=-35
        blue=-35
		id="lava_cave"
		image="schedule/volcanic-cloud.png"
		name=_"Volcanic Cloud"
        lawful_bonus=-25
	[/time]
#enddef

#define ERUPTION
    {QUAKE "rumble.ogg"}
    [repeat]
        times=17
        [do]
            {QUAKE ""}
        [/do]
    [/repeat]
    [sound]
        name=rumble.ogg
    [/sound]
    [scroll]
        x=20
        y=0
    [/scroll]
    [sound]
        name=dragostick.ogg
    [/sound]
    [scroll]
        x=-30
        y=0
    [/scroll]
    [sound]
        name=explosion.ogg
    [/sound]
    [scroll]
        x=30
        y=30
    [/scroll]
    [scroll]
        x=0
        y=-20
    [/scroll]
    [scroll]
        x=0
        y=20
    [/scroll]
    [replace_schedule]
        {SCHEDULE_VOLCANIC_CLOUD}
    [/replace_schedule]
    [repeat]
        times=12
        [do]
            {QUAKE ""}
        [/do]
    [/repeat]
    {QUAKE "rumble.ogg"}
    [repeat]
        times=138
        [do]
            {QUAKE ""}
        [/do]
    [/repeat]
#enddef

#define LOGALMIER_ARMY
[event]
    name=side 6 turn
    first_time_only=no

    [filter_condition]
        [have_unit]
            id=Lord Logalmier
        [/have_unit]
    [/filter_condition]

    [lua]
        code = << wml.variables.logalmier_force = #wesnoth.get_units { side=6 } >>
    [/lua]

    [lua]
        code = << wml.variables.arshag_force = #wesnoth.get_units { side=1 } >>
    [/lua]

    {VARIABLE_OP logalmier_force sub $arshag_force}

    [if]
        [variable]
            name=logalmier_force
            greater_than_equal_to=12
        [/variable]
        [then]
            {VARIABLE elvish_units 8}
        [/then]
        [else]
            {VARIABLE elvish_units 0}
        [/else]
    [/if]

    [while]
        [variable]
            name=elvish_units
            less_than=8
        [/variable]
        [do]

            [set_variable]  
                name=elvish_army 
                rand=Elvish Rider,Elvish Captain,Elvish Hero,Elvish Ranger,Elvish Outrider,Elvish Marksman,Elvish Sharpshooter,Elvish Champion,Elvish Avenger,Elvish Sorceress,Elvish Enchantress
            [/set_variable]

            [unit]
                type=$elvish_army
                placement=leader
                facing=ne
                side=6
            [/unit]

            {VARIABLE_OP elvish_units add 1}

        [/do]

    [/while]

    {CLEAR_VARIABLE elvish_army}
    {CLEAR_VARIABLE elvish_units}
[/event]
#enddef

#define WAVE_BREAK TERRAIN XY SOUND
[sound]
    name={SOUND}
[/sound]
[terrain]
    terrain={TERRAIN}^Edt
    x,y={XY}
[/terrain]
[kill]
    x,y={XY}
    animate=yes
[/kill]
#enddef

#define DEFEAT_IF_NOT_SPARE
[kill]
    id=$unit.id
[/kill]
[if]
    [variable]
        name=picked_up_gifts
        greater_than_equal_to=2
    [/variable]
    [then]
        [if]
            [not]
                [have_unit]
                    role=Eternal Servitude
                [/have_unit]
            [/not]
            [then]
                [if]
                    [not]
                        [have_unit]
                            role=Gift User
                        [/have_unit]
                    [/not]
                    [then]
                        [if]
                            [not]
                                [have_unit]
                                    role=Gift Bearer
                                [/have_unit]
                            [/not]
                            [then]
                                [endlevel]
                                    result=defeat
                                [/endlevel]
                            [/then]
                        [/if]
                    [/then]
                [/if]
            [/then]
        [/if]
    [/then]
[/if]
#enddef

#define PROTECT_CHECK
[if]
    [variable]
        name=gift_delivered
        not_equals=yes
    [/variable]
    [then]
        [modify_unit]
            [filter]
                id=$unit.id
            [/filter]
            [object]
                id=protect_delivery
                [effect]
                    apply_to=overlay
                    add="misc/protect-icon.png"
                [/effect]
            [/object]
        [/modify_unit]
    [/then]
[/if]
#enddef

#define CLEAR_TENT
[if]
    [variable]
        name=materials
        equals=0
    [/variable]
    [and]
        [variable]
            name=web
            not_equals=1
        [/variable]
    [/and]
    [and]
        [variable]
            name=bone
            not_equals=1
        [/variable]
    [/and]
    [and]
        [variable]
            name=branch
            not_equals=1
        [/variable]
    [/and]
    [and]
        [variable]
            name=iron
            not_equals=1
        [/variable]
    [/and]
    [then]
        [sound]
            name=pincers.ogg
        [/sound]
        [remove_item]
            x,y=39,30
        [/remove_item]
        {VARIABLE tent_down yes}
    [/then]
[/if]
#enddef
        
