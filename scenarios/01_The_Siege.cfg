#textdomain wesnoth-rtl

[scenario]
    id=01_The_Siege
    name= _ "The Siege"
    map_data="{~add-ons/The_Rootless/maps/01_The_Siege.map}"
    {TURNS 20 17 15}
    next_scenario=02_The_Hunt
    victory_when_enemies_defeated=no

    {SCENARIO_MUSIC       casualties_of_war.ogg}
    {EXTRA_SCENARIO_MUSIC battle.ogg}
    {EXTRA_SCENARIO_MUSIC the_dangerous_symphony.ogg}
    {DEFAULT_SCHEDULE}
    {RECALL_DISCOUNT}
    {DEATHS_THE_SIEGE}
    {MAIN_CHARACTERS_EVENTS}

    [story]
        [part]
            music=northerners-old.ogg
            background=story-orc.jpg
            story= _ "The arrival of humans and orcs caused turmoil among the nations of the Great Continent. Lich-Lord Jevyan was defeated and destroyed, while his orc minions fled back to the Green Isle. The victorious human prince, Haldric, was crowned the first King of Wesnoth and his people settled the lands provided by the elves."
        [/part]
        [part]
            background=story-orc.jpg
            story= _ "Yet despite the mutual promises of friendship and alliance, both humans and elves secretly plotted to undermine the other party. The elvish council, Ka'lian, decided not to help in an event of a new war with orcs, hoping that the two races would weaken each other and never again pose any threat."
        [/part]
        [part]
            background=story-orc.jpg
            story= _ "King Haldric was similarly treacherous in that he forged a treaty, lying to the remaining Lich-Lords that the powerful Ruby of Fire have been exchanged with the elves for the new land. Thus all the help between men and elves was half hearted in the first seven years of Wesnoth's history."
        [/part]
        [part]
            background=story-orc.jpg
            story= _ "Yet humans managed to break one orcish attack after the other and build the new fortified city of Elensefar, from which they could push any orcish horde back into the sea. That did not stop one foolish warlord from trying to capture the human capital and take his rightful place in the orcish songs. Yet this is not his story."
        [/part]
    [/story]

    {RTL_TRACK {JOURNEY_01_NEW}}

    [side]
        side=1
        controller=human
        {GOLD 100 90 90}
        {INCOME 5 3 2}
        team_name=Orcs
        user_team_name= _ "Orcs"
        {FLAG_VARIANT6 ragged}
        recruit="Orcish Archer,Goblin Spearman"
        type=Orcish Assassin
        id=Arshag
        unrenamable=yes
        name= _ "Arshag"
        profile=portraits/arshag.webp
        x,y=4,2
        [modifications]
            {TRAIT_INTELLIGENT}
        [/modifications]
        canrecruit=yes
        facing=se
    [/side]
    {STARTING_VILLAGES_AREA 1 4 2 2}

    [side]
        side=2
        controller=ai
        facing=se
        type=Knight
        ai=guardian
        x,y=16,17
        team_name=Elensefar
        recruit="Spearman,Bowman,Mage,Heavy Infantryman"
        {GOLD 0 0 0}
        {INCOME -2 -2 -2}
        village_gold=0
        user_team_name= _ "Elensefar"
        {FLAG_VARIANT loyalist}
        [modifications] #in case he gets a funny idea to let himself be killed
            [object]
                [effect]
                    apply_to=movement_costs
                    replace=yes
                    [movement_costs]
                        flat={UNREACHABLE}
                        castle={UNREACHABLE}
                    [/movement_costs]
                [/effect]
            [/object]
        [/modifications]
        #defenders do not venture out of the city
        [ai]
            [avoid]
                [not]
                    x="3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24"
                    y="16-20,15-20,15-21,14-21,14-22,13-22,13-22,12-23,12-24,11-24,11-25,10-24,10-25,9-24,10-25,10-24,11-24,11-23,12-22,12-19,14-18,14-15"
                [/not]
            [/avoid]
        [/ai]
    [/side]
    {STARTING_VILLAGES 2 7}

    [side]
        side=3
        color=black
        controller=ai
        {GOLD 120 120 120}
        {INCOME 0 0 0}
        team_name=Orcs_2
        user_team_name= _ "Orc Horde"
        {FLAG_VARIANT6 ragged}
        facing=nw
        id=Dumb Warlord
        type=Orcish Warlord
        x,y=32,23
    [/side]
    {STARTING_VILLAGES_AREA 3 32 23 2}

    [side]
        side=4
        color=blue
        controller=ai
        team_name=Elensefar
        user_team_name= _ "King Haldric"
        hidden=yes
        {FLAG_VARIANT loyalist}
    [/side]

    [side]
        side=5
        color=black
        controller=ai
        {GOLD 100 105 115}
        {INCOME 0 1 1}
        team_name=Orcs_2,Orcs
        user_team_name= _ "Orc Horde"
        {FLAG_VARIANT6 ragged}
        id=Sidekick
        type=Orcish Warrior
        recruit=Orcish Archer,Orcish Grunt
        #ifdef EASY
            recruitment_pattern=fighter,fighter,archer
        #endif
        x,y=30,10
        facing=nw
        #north bank orcs will not attack Elensefar
        [ai]
            [avoid]
                x="3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24"
	            y="16-20,15-20,15-21,14-21,14-22,13-22,13-22,12-23,12-24,11-24,11-25,10-24,10-25,9-24,10-25,10-24,11-24,11-23,12-22,12-19,14-18,14-15"
            [/avoid]
        [/ai]
    [/side]

    {STARTING_VILLAGES_AREA 5 30 10 2}

    [event]
        name=prestart

#ifdef EASY
        {VARIABLE rootless_hints yes}
        {ROOTLESS_HELP_OFF}
#else
        {ROOTLESS_HELP}
#endif
        {HINT_TERRAIN}
        {PLACE_IMAGE (scenery/bush.png) 31 3}
        {PLACE_IMAGE (scenery/bush2.png) 31 4}
        {PLACE_IMAGE (items/scarecrow.png) 9 27}
        {PLACE_IMAGE (items/straw-bale1.png) 15 20}
        {PLACE_IMAGE (items/straw-bale2.png) 16 20}
        {PLACE_IMAGE (scenery/wreck-2.png) 2 24}
        {PLACE_IMAGE (scenery/wreck-3.png) 11 22}
        {PLACE_IMAGE (scenery/village-human-burned2.png) 7 27}
        {PLACE_IMAGE (scenery/village-human-burned1.png) 21 30}
        {PLACE_IMAGE (scenery/village-human-burned4.png) 25 21}

        [objectives]
            [objective]
                description= _ "Move Vudhar to the mountain in the east"
                condition=win
                [show_if]
                    [have_unit]
                        id=Vudhar
                    [/have_unit]
                [/show_if]
            [/objective]

            [objective]
                description= _ "Destroy the orcish leader on the northern riverbank"
                condition=win
                [show_if]
                    [variable]
                        name=sidekick
                        boolean_equals=yes
                    [/variable]
                [/show_if]
            [/objective]

            [objective]
                description= _ "Death of Arshag"
                condition=lose
            [/objective]

            [objective]
                description= _ "Death of Vudhar"
                condition=lose
                [show_if]
                    [have_unit]
                        id=Vudhar
                    [/have_unit]
                [/show_if]
            [/objective]

            [objective]
                description= _ "Death of Toruk"
                condition=lose
                [show_if]
                    [have_unit]
                        side=1
                        id=Toruk
                    [/have_unit]
                [/show_if]
            [/objective]

            [objective]
                description= _ "Death of Clerila"
                condition=lose
            [/objective]

            {TURNS_RUN_OUT}

            {HINT "Clerila will return back home after smuggling you."}

            [gold_carryover]
                carryover_percentage=0
                bonus=no
            [/gold_carryover]

        [/objectives]

        [unit]
            side=1
            type=RTL Orcish Shaman
            id=Vudhar
            unrenamable=yes
            name= _ "Vudhar"
            profile=portraits/vudhar.webp
            x,y=5,3
            facing=se
            [modifications]
                {TRAIT_LOYAL_HERO}
                {TRAIT_INTELLIGENT}
            [/modifications]
        [/unit]

        [unit]
            side=5
            type=RTL Old Grunt
            id=Toruk
            unrenamable=yes
            name= _ "Toruk"
            x,y=30,9
            profile=portraits/toruk.webp
            facing=nw
            [modifications]
                {TRAIT_LOYAL_HERO}
                {TRAIT_RESILIENT}
            [/modifications]
        [/unit]

        #ifdef EASY
        [unit]
            side=1
            type=Goblin Spearman
            x,y=5,2
            facing=se
            [modifications]
                {TRAIT_LOYAL}
                {TRAIT_STRONG}
            [/modifications]
        [/unit]
        #endif

        #spawn the defenders of Elensefar
        {ELENSEFAR_DEFENDERS}

#ifdef EASY
        {MODIFY_TERRAIN Gg^Vh 15 3}
#endif

    [if]
        [lua]
            code=<<

            if wesnoth.game_config.debug == true then
                return true;
            end

                return false;

            >>
        [/lua]
        [then]
            [lua]
                code = << wesnoth.interface.add_chat_message("Beta 1.1.3", "You see this information because debug mode is active.") >>
            [/lua]
        [/then]
    [/if]

    [/event]

    [event]
        name=start

        [message]
            speaker=Dumb Warlord
            message= _ "Come on, take the city!"
        [/message]

        [animate_unit]
            flag=attack
            [filter]
                x,y=16,23
            [/filter]
            [animate]
                flag=defend
                [filter]
                    x,y=17,24
                [/filter]
                hits=yes
            [/animate]
            [primary_attack]
                range=melee
            [/primary_attack]
            hits=yes
        [/animate_unit]
        [animate_unit]
            flag=attack
            [filter]
                x,y=18,23
            [/filter]
            [animate]
                flag=defend
                [filter]
                    x,y=17,24
                [/filter]
                hits=yes
            [/animate]
            [primary_attack]
                range=melee
            [/primary_attack]
            hits=yes
        [/animate_unit]
        [kill]
            x,y=17,24
            animate=yes
        [/kill]

        [message]
            speaker=Dumb Warlord
            message= _ "You filthy scum, stop dying!"
        [/message]

        [message]
            speaker=Arshag
            message= _ "Chief, this is madness!"
        [/message]

        [message]
            speaker=Dumb Warlord
            message= _ "What did you say?"
        [/message]

        [animate_unit]
            flag=attack
            [filter]
                x,y=20,21
            [/filter]
            [animate]
                flag=defend
                [filter]
                    x,y=21,21
                [/filter]
                hits=yes
            [/animate]
            [primary_attack]
                range=melee
            [/primary_attack]
            hits=yes
        [/animate_unit]

        [kill]
            x,y=21,21
            animate=yes
        [/kill]

        [message]
            speaker=Arshag
            message= _ "Can you not see? The sun is rising and our troops are getting overwhelmed."
        [/message]

        [message]
            speaker=Dumb Warlord
            message= _ "I'll have you whipped for this insolence! You lack the strength and willpower of a true orc, assassin."
        [/message]

        [animate_unit]
            flag=attack
            [filter]
                x,y=14,11
            [/filter]
            [animate]
                flag=defend
                [filter]
                    x,y=15,11
                [/filter]
                hits=yes
            [/animate]
            [primary_attack]
                range=melee
            [/primary_attack]
            hits=yes
        [/animate_unit]

        [kill]
            x,y=15,11
            animate=yes
        [/kill]

        [message]
            speaker=Arshag
            message= _ "Doesn't look like the strength and willpower of a true orc helps much."
        [/message]

        [message]
            speaker=Vudhar
            message= _ "Chief, we should really consider regrouping."
        [/message]

        [message]
            speaker=Dumb Warlord
            message= _ "Even you, shaman? I swear I'll drink from the skull of the commander of Elensefar before the sun sets!"
        [/message]

        [animate_unit]
            flag=attack
            [filter]
                x,y=16,11
            [/filter]
            [animate]
                flag=defend
                [filter]
                    x,y=17,12
                [/filter]
                hits=yes
            [/animate]
            [primary_attack]
                range=ranged
            [/primary_attack]
            hits=yes
        [/animate_unit]

        [kill]
            x,y=17,12
            animate=yes
        [/kill]

        [message]
            speaker=Toruk
            message= _ "Come on, chief. That is enough bloodshed for one morning."
        [/message]

        [message]
            speaker=Dumb Warlord
            message= _ "Alright, alright you cowards.
            
You have until dusk to catch your breath. Then we attack again."
        [/message]

        [message]
            speaker=Arshag
            message= _ "We don't even have siege weapons capable of razing those stone walls they build now."
        [/message]

        [message]
            type=Spearman
            message= _ {WHISPER _"Good thing we learned from the attack of those fire breathing lizards few years back."}
        [/message]

        [message]
            speaker=Vudhar
            message= _ "You're right, son, but what can we do?

It's not like the warlord will let us leave if we ask him."
        [/message]

        [message]
            speaker=Arshag
            message= _ "Well, let's not ask him. I already have a plan."
        [/message]

        [move_unit_fake]
            type=Rogue
            gender=female
            side=1
            x=7,6
            y=12,2
            image_mods=RC(magenta>lightblue)
        [/move_unit_fake]

        [unit]
            type=Rogue
            id=Clerila
            name="Clerila"
            gender=female
            x,y=6,2
            facing=nw
            side=1
            [modifications]
                {TRAIT_LOYAL_HERO}
                {TRAIT_DEXTROUS}
                [object]
                    [effect]
                    apply_to=attack
                    range=ranged
                        [set_specials]
                            mode=append
                        {WEAPON_SPECIAL_SLOW}
                        [/set_specials]
                    [/effect]
                    [effect] #no Assassin for Clerila to prevent players from wasting XP
                        apply_to=remove_advancement
                        types=Assassin
                    [/effect]
                    [effect]
                        apply_to=new_advancement
                        replace=yes
                        {AMLA_DEFAULT}
                    [/effect]
                    [effect]
                        apply_to=image_mod
                        add=RC(magenta>lightblue)
                    [/effect]
                [/object]
            [/modifications]
        [/unit]

        [message]
            speaker=Arshag
            message= _ "I paid the smugglers for a boat that can take us upriver."
        [/message]

        [message]
            speaker=Clerila
            message= _ "All is ready, but they can't come while the weather is clear.

They would be spotted and arrested before they could leave the city."
        [/message]

        [message]
            speaker=Vudhar
            message= _ "There is a ritual that can cast fog around the river.
            
You just have to get me to the top of that mountain, Arshag. My magic will be far more powerful there."
        [/message]

        {HIGHLIGHT_IMAGE 30 3 items/gohere.png ()}

    [/event]

    [event]
        name=side 5 turn

        [message]
            id=Sidekick
            message= _ "Arshag! What do you think you're doing?"
        [/message]

        [message]
            speaker=Arshag
            message= _ "Escaping this stupid siege, of course. I advise you to come with us."
        [/message]

        [message]
            id=Dumb Warlord
            message= _ "You treatcherous worm!

Fifty gold pieces to anyone who brings me Arshag's head!"
        [/message]

        [message]
            id=Sidekick
            message= _ "With pleasure, chief!"
        [/message]

        [modify_side]
            side=5
            team_name=Orcs_2
        [/modify_side]

        [message]
            speaker=Toruk
            message= _ "Come now, we're killing our own?"
        [/message]

        [message]
            id=Sidekick
            message= _ "Shut up or I'll take your head as well!"
        [/message]

        {VARIABLE sidekick yes}

        [show_objectives]
        [/show_objectives]

    [/event]

    [event]
        name=attack

        [filter]
            id=Toruk
        [/filter]
        [filter_second]
            side=1
        [/filter_second]

        [if]
            [have_unit]
                id=Toruk
                side=5
            [/have_unit]

            [then]

                [message]
                    id=Toruk
                    message= _ "I have had enough of this madness. I'm with you, Arshag."
                [/message]

                [message]
                    id=Sidekick
                    message= _ "You vermin!"
                [/message]

                [modify_unit]
                    [filter]
                        id=Toruk
                    [/filter]
                    side=1
                    [object]
                        duration=turn
                        [effect]
                            apply_to=resistance
                            replace=yes
                            [resistance]
                                blade=10
                                pierce=10
                                fire=10
                            [/resistance]
                        [/effect]
                    [/object]
                [/modify_unit]

                [allow_recruit]
                    side=1
                    type=Orcish Grunt
                [/allow_recruit]

                [message]
                    id=Toruk
                    message= _ "Am I the only one who haven't crossed the great sea just to bleed into the mud under the walls of this human city?"
                [/message]

                [message]
                    speaker=narrator
                    message= _ "You can now recruit Orcish Grunts."
                    image=wesnoth-icon.png
                [/message]
            [/then]

        [/if]

    [/event]

    [event]
        id=attack_clerila
        name=attacker hits

        [filter]
            id=Clerila
        [/filter]

        [filter_attack]
            name=throwing knives
        [/filter_attack]
                
        [message]
            id=Arshag
            message= _ "What? You can slow enemies with your throwing knives?"
        [/message]

        [message]
            id=Clerila
            message= _ "It's easy, I just target their weak points.
            
It helps to practice while hunting animals, since they don't wear any armor."
        [/message]

        [remove_event]
            id=defense_clerila
        [/remove_event]
    [/event]

    [event]
        id=defense_clerila
        name=defender hits

        [filter_second]
            id=Clerila
        [/filter_second]

        [filter_second_attack]
            name=throwing knives
        [/filter_second_attack]
                
        [message]
            id=Arshag
            message= _ "What? You can slow enemies with your throwing knives?"
        [/message]

        [message]
            id=Clerila
            message= _ "It's easy, I just target their weak points.
            
It helps to practice while hunting animals, since they don't wear any armor."
        [/message]

        [remove_event]
            id=attack_clerila
        [/remove_event]
    [/event]

    [event]
        name=attack

        [filter]
            side=1
        [/filter]
        [filter_second]
            id=Toruk
            side=5
        [/filter_second]

        [message]
            id=Toruk
            message= _ "Enough of this. I haven't crossed the great sea just to bleed into the mud under the walls of this human city."
        [/message]

        [message]
            id=Sidekick
            message= _ "You vermin!"
        [/message]

        [message]
            id=Toruk
            message= _ "I'm with you, Arshag. Let's get as far from this damn place as possible."
        [/message]

        [modify_unit]
            [filter]
                id=Toruk
            [/filter]
            side=1
                [object]
                    duration=turn
                    [effect]
                        apply_to=resistance
                        replace=yes
                        [resistance]
                            blade=10
                            pierce=10
                            fire=10
                        [/resistance]
                    [/effect]
                [/object]
        [/modify_unit]

        [allow_recruit]
            side=1
            type=Orcish Grunt
        [/allow_recruit]

        [message]
            speaker=narrator
            message= _ "You can now recruit Orcish Grunts."
            image=wesnoth-icon.png
        [/message]
            
    [/event]

    [event]
        name=time over
        [message]
            id=Clerila
            message= _ "It's taking too long, Arshag.

I'm sorry, but I can't risk the lives of my friends with the royal army surrounding us."
        [/message]
    [/event]

    [event]

        name=moveto
        first_time_only=yes
        [filter]
            id=Vudhar
            x,y=30,3
        [/filter]

        [remove_item]
            x,y=30,3
        [/remove_item]

            [message]
                speaker=Vudhar
                message= _ "O mighty Spirits of the Air! May the winds be calm, so fog can flow."
            [/message]

            [animate_unit]
                flag=attack
                [filter]
                    id=Vudhar
                [/filter]
                hits=kill
                [primary_attack]
                    range=ranged
                [/primary_attack]
                [facing]
                    x=31
                    y=3
                [/facing]
            [/animate_unit]

            [message]
                speaker=Vudhar
                message= _ "O mighty Spirits of the Earth! May the soil be wet, so fog can cover the banks."
            [/message]

            [animate_unit]
                flag=attack
                [filter]
                    id=Vudhar
                [/filter]
                hits=kill
                [primary_attack]
                    range=ranged
                [/primary_attack]
                [facing]
                    x=29
                    y=3
                [/facing]
            [/animate_unit]

            [message]
                speaker=Vudhar
                message= _ "O mighty Spirits of the Water! May the river run strong, so fog can rise!"
            [/message]

            [animate_unit]
                flag=attack
                [filter]
                    id=Vudhar
                [/filter]
                hits=kill
                [primary_attack]
                    range=ranged
                [/primary_attack]
                [facing]
                    x=30
                    y=4
                [/facing]
            [/animate_unit]

            [modify_side]
                fog=yes
            [/modify_side]

            [redraw]
                clear_shroud=yes
            [/redraw]

            [message]
                speaker=Arshag
                message= _ "Yes! The river listens!"
            [/message]

            [unit]
                side=2
                name=Hudoc
                id=ShamanKiller
                type=Ranger
                x,y=31,3
                facing=sw
            [/unit]

            [unit]
                side=2
                id=ShamanKiller2
                type=Longbowman
                x,y=31,4
                facing=nw
            [/unit]

            [message]
                speaker=ShamanKiller
                message= _ "The river isn't the only thing listening."
            [/message]

            [message]
                speaker=Vudhar
                message= _ "No! Arshag!"
            [/message]

            {INCIDENTAL_MUSIC transience.ogg}

            [animate_unit]
                flag=attack
                [filter]
                    id=ShamanKiller
                [/filter]
                hits=kill
                [primary_attack]
                    range=ranged
                [/primary_attack]
                [facing]
                    x,y=30,3
                [/facing]
                [animate]
                    flag=defend
                    [filter]
                        x,y=30,3
                    [/filter]
                    hits=yes
                [/animate]
            [/animate_unit]
            [kill]
                id=Vudhar
                animate=yes
            [/kill]

            [message]
                speaker=Arshag
                message= _ "MOTHER!"
            [/message]

            [kill]
                id=ShamanKiller
                animate=no
            [/kill]

            [move_unit_fake]
                type=Ranger
                side=2
                x=31,36
                y=3,1
            [/move_unit_fake]

            [kill]
                id=ShamanKiller2
                animate=no
            [/kill]

            [move_unit_fake]
                type=Longbowman
                side=2
                x=31,36
                y=4,1
            [/move_unit_fake]

            [message]
                speaker=Toruk
                message= _ "They killed our last shaman!

Without them, we have no history, no future, no connection to these strange lands, winds and waters."
            [/message]

        [if]
            [not]
                [have_unit]
                    id=Sidekick
                [/have_unit]
            [/not]
            [then]
                [message]
                    speaker=Toruk
                    message= _ "It's a great loss, but we cannot afford to dwell on it now. Let's go to the riverbank."
                [/message]
                [fire_event]
                    name=victory
                [/fire_event]
            [/then]
            [else]
                [show_objectives][/show_objectives]
                [message]
                    speaker=Toruk
                    message= _ "We can still save the rest of our people. Let's clear the way to the riverbank."
                [/message]
                [if]
                    [have_unit]
                        id=Haldric
                    [/have_unit]
                    [and]
                        [not]
                            [have_unit]
                                id=Dumb Warlord
                            [/have_unit]
                        [/not]
                    [/and]
                        [then]
                            [micro_ai]
                                [filter]
                                    side=4
                                [/filter]
                                side=4
                                ai_type=zone_guardian
                                action=add
                                [filter_location]
                                    x="3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24"
                                    y="16-20,15-20,15-21,14-21,14-22,13-22,13-22,12-23,12-24,11-24,11-25,10-24,10-25,9-24,10-25,10-24,11-24,11-23,12-22,12-19,14-18,14-15"
                                [/filter_location]
                            [/micro_ai]
                            [message]
                                speaker=Haldric
                                message= _ "Everyone, stay in the city.

This fog isn't natural, it could be a trap.

Bring me a mage who can dispel it!"
                            [/message]
                        [/then]
                [/if]
            [/else]
        [/if]

    [/event]

    [event]

        name=die
        [filter]
            id=Sidekick
        [/filter]

        {VARIABLE sidekick no}

        [message]
            speaker=Arshag
            message= _ "He's out of our way!"
        [/message]

        [message]
            side=5
            message= _ "I don't want to die here. Please, let me join you."
            [not]
                id=Sidekick
            [/not]
        [/message]

        [modify_unit]
            [filter]
                side=5
                [not]
                    id=Sidekick #he appears back from the dead if not filtered out
                [/not]
            [/filter]
            side=1
            moves=$this_unit.max_moves
        [/modify_unit]

        [if]
            [not]
                [have_unit]
                    id=Vudhar
                [/have_unit]
            [/not]
            [then]
                [if]
                    [have_unit]
                        x,y=$x2,$y2
                        id=Arshag
                    [/have_unit]
                    [then]
                        [store_unit]
                            [filter]
                                id=Arshag
                            [/filter]
                            variable=arshag
                        [/store_unit]

                        {VARIABLE_OP arshag.experience add 16}
                        [unstore_unit]
                            variable=arshag
                        [/unstore_unit]

                        {CLEAR_VARIABLE arshag}
                    [/then]
                [/if]

                [if]
                    [have_unit]
                        x,y=$x2,$y2
                        id=Toruk
                    [/have_unit]
                    [then]
                        [store_unit]
                            [filter]
                                id=Toruk
                            [/filter]
                            variable=toruk
                        [/store_unit]

                        {VARIABLE_OP toruk.experience add 16}
                        [unstore_unit]
                            variable=toruk
                        [/unstore_unit]

                        {CLEAR_VARIABLE toruk}
                    [/then]
                [/if]

                [if]
                    [have_unit]
                        x,y=$x2,$y2
                        id=Clerila
                    [/have_unit]
                    [then]
                        [store_unit]
                            [filter]
                                id=Clerila
                            [/filter]
                            variable=clerila
                        [/store_unit]

                        {VARIABLE_OP clerila.experience add 16}
                        [unstore_unit]
                            variable=clerila
                        [/unstore_unit]

                        {CLEAR_VARIABLE clerila}
                    [/then]
                [/if]
                [fire_event]
                    name=victory
                [/fire_event]
            [/then]
            [else]
                [message]
                    speaker=Toruk
                    message= _ "Shame we had to kill our own.

Vudhar, can you do your ritual now so we can leave this cursed city behind?"
                [/message]
                [message]
                    speaker=Vudhar
                    message= _ "With pleasure."
                [/message]
                [show_objectives][/show_objectives]
            [/else]
        [/if]

    [/event]

    [event]
        name=victory

        [message]
            speaker=Clerila
            message= _ "The boat is coming. This is where we part ways."
        [/message]

        [modify_unit] #a hack to prevent heroes from going into water
            [filter]
                id=Arshag,Toruk,Clerila
            [/filter]
            side=1
            [object]
                duration=turn
                [effect]
                    apply_to=movement_costs
                    replace=yes
                    [movement_costs]
                        deep_water={UNREACHABLE}
                        shallow_water={UNREACHABLE}
                        swamp_water={UNREACHABLE}
                    [/movement_costs]
                [/effect]
            [/object]
        [/modify_unit]

        [move_unit]
            id=Arshag,Toruk,Clerila
            to_x=29
            to_y=12
            clear_shroud=yes
            check_passability=yes
        [/move_unit]

        [move_unit_fake]
            type=Boat
            side=1
            x=22,29
            y=16,13
        [/move_unit_fake]

        {PLACE_IMAGE ("units/transport/boat.png~RC(magenta>blue)") 29 13}

        [message]
            speaker=Arshag
            message= _ "Thanks, Clerila. We shall never forget your name, true friend of the orcs."
        [/message]

        [message]
            speaker=Clerila
            message= _ "Well, I was paid handsomely.
            
Here are a few of my throwing knives, so you have something to remember me by."
        [/message]

        [message]
            speaker=Toruk
            message= _ "That's great and all, but get on the boat already, Arshag!"
        [/message]

        {CLEAR_VARIABLE haldric_army}

        {FADE_TO_BLACK}
        [story]
            title=""
            [part]
                background=misc/rootless-logo.png
                music=silence.ogg
                sound=logo.ogg
                #[image]
                #    x,y=0,0
                #    file=misc/rootless-logo.png
                #[/image]
            [/part]
        [/story]

        [kill]
            id=Clerila
            animate=no
        [/kill]

        {CLEAR_VARIABLE sidekick}

        [modify_unit] #in case someone skips the first scenario with debug
            [filter]
                id=Toruk
            [/filter]
            side=1
        [/modify_unit]
        [kill]
            id=Vudhar
            animate=no
        [/kill]

        [endlevel]
            result=victory
            carryover_report=no
            linger_mode=no
            bonus=no
            {NEW_GOLD_CARRYOVER 0}
        [/endlevel]

    [/event]

    [event]
#ifdef EASY
        name=side 4 turn 9
#endif EASY
#ifdef NORMAL
        name=side 4 turn 7
#endif NORMAL
#ifdef HARD
        name=side 4 turn 6
#endif HARD
        {INCIDENTAL_MUSIC main_menu.ogg}

        [if]
            [not]
                [have_unit]
                    id=Vudhar
                [/have_unit]
            [/not]
            [then]
                [lift_fog]
                    side=1
                    x=27-37
                    y=22-30
                [/lift_fog]
            [/then]
        [/if]

        [unit]
            type=RTL Noble Lord
            profile=portraits/haldric.webp
            facing=nw
            id=Haldric
            name= _ "King Haldric I."
            x,y=36,28
            side=4
            canrecruit=yes
            [modifications]
                {PLOT_ARMOR}
            [/modifications]
        [/unit]

        [message]
            speaker=Haldric
            message= _ "We returned just in time. To arms, men! For Wesnoth!"
        [/message]

        {HALDRIC}

        [message]
            speaker=Toruk
            message= _ "It's -"
        [/message]

        [message]
            speaker=Dumb Warlord
            message= _ "- the bastard himself!"
        [/message]

        [message]
            speaker=Arshag
            message= _ "Anyone else want to change the plan and flee now?"
        [/message]

        [message]
            speaker=Sidekick
            message= _ "Screw you, traitor!"
        [/message]
        
        [message]
            speaker=Arshag
            message= _ "*sigh* No wonder humans think us daft."
        [/message]

        [if]
                [have_unit]
                    id=Vudhar
                [/have_unit]
            [then]
                [message]
                    speaker=Vudhar
                    message= _ "We have to hurry, Arshag. Get me on that mountaintop.
                    
The cover of fog should buy us time to escape."
                [/message]
            [/then]
        [/if]

    [/event]

    [event]
        name=die
        [filter]
            id=Dumb Warlord
        [/filter]
        [if]
            [have_unit]
                id=Haldric
            [/have_unit]
            [and]
                [not]
                    [have_unit]
                        id=Vudhar
                    [/have_unit]
                [/not]
            [/and]
                [then]
                    [micro_ai]
                        [filter]
                            side=4
                        [/filter]
                        side=4
                        ai_type=zone_guardian
                        action=add
                        [filter_location]
                            x="3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24"
                            y="16-20,15-20,15-21,14-21,14-22,13-22,13-22,12-23,12-24,11-24,11-25,10-24,10-25,9-24,10-25,10-24,11-24,11-23,12-22,12-19,14-18,14-15"
                        [/filter_location]
                    [/micro_ai]
                    [message]
                        speaker=Haldric
                        message= _ "The warlord is dead. Everyone, back into the city!

We won't advance to the northern bank in this unnatural fog."
                    [/message]
                [/then]
        [/if]
    [/event]

#attacking Elensefar will only make the defenders stronger

    [event]

        first_time_only=no
        name=attack

        [filter_second]
            side=2
        [/filter_second]

        [gold]
            side=2
            amount=25
        [/gold]

    [/event]

    [event]
        first_time_only=no
        name=new turn
        [if]
            [have_unit]
                id=Haldric
            [/have_unit]
            [then]
                {HALDRIC}
            [/then]
        [/if]
    [/event]

    [event]
        name=side 3 turn 4

        [message]
            speaker=Dumb Warlord
            message= _ "Storm the city!"
        [/message]

        [allow_recruit]
            side=3
            type=Orcish Grunt,Orcish Archer,Goblin Spearman,Orcish Assassin
        [/allow_recruit]

    [/event]

    {HINT_LEADER}

[/scenario]