#textdomain wesnoth-rtl

[scenario]
    id=02_The_Hunt
    name= _ "The Hunt"
    map_data="{~add-ons/The_Rootless/maps/02_The_Hunt.map}"
    {TURNS 10 10 10}
    next_scenario=03_The_Deal
    victory_when_enemies_defeated=no

    [time]
        id=rtl_night
        name= _ "Night"
#ifdef EASY
        image=misc/time-schedules/schedule-midnight.png
#else
        image=misc/time-schedules/default/schedule-firstwatch.png
#endif
        lawful_bonus=-25
        red=-75
        green=-45
        blue=-13
    [/time]

    {SCENARIO_MUSIC       knolls.ogg}
    {EXTRA_SCENARIO_MUSIC loyalists.ogg}
    {EXTRA_SCENARIO_MUSIC vengeful.ogg}
    {RECALL_DISCOUNT}
    {DEATHS_THE_HUNT}
    {MAIN_CHARACTERS_EVENTS}
    {HINT_CAVALRY}


    [story]
        [part]
            music=northerners-old.ogg
            background=story-orc.jpg
            story= _ "Arshag's band had a head start, but the king's mounted messengers soon caught up and turned the local settlers against the orcs. The band had to proceed with caution, so Arshag started training some particularly nimble individuals in his stealthy ways. It tooka all the help from the smugglers as well as sheer luck to flee the densely populated coastal lands. And trouble was not over."
        [/part]
        [part]
            background=story-orc.jpg
            story= _ "Soon it became apparent that the Wesnothians weren't going to stop searching for them. Arshag's band got spotted even while travelling through sparsely populated lands upstream around the Great River, so he ordered the orcs to turn north, crossing the water unopposed. As they arrived in a peaceful valley, many started to hope they finally threw off their pursuers. The old one, Toruk, wasn't that optimistic."
        [/part]
    [/story]

    {RTL_TRACK {JOURNEY_02_NEW}}

    # wmllint: validate-off
    [side]
        side=1
        controller=human
        {GOLD 0 0 0}
        {INCOME 0 0 0}
        team_name=Orcs
        user_team_name= _ "Orcs"
        {FLAG_VARIANT6 ragged}
        recruit="Orcish Archer,Goblin Spearman,Orcish Grunt"
        type=Orcish Assassin
        id=Arshag
        shroud=yes
        unrenamable=yes
        name= _ "Arshag"
        profile=portraits/arshag.webp
        x,y=11,17
        [modifications]
            {TRAIT_INTELLIGENT}
        [/modifications]
            canrecruit=yes
            facing=ne
    [/side]
    # wmllint: validate-on

    [side]
        side=2
        hidden=yes
        controller=ai
#ifdef EASY
        recruit="Cavalryman,Bowman,Spearman"
#else
        recruit="Cavalryman,Bowman,Spearman,Fencer"
#endif
        team_name=Loyalists
        user_team_name= _ "Loyalists"
        {FLAG_VARIANT loyalist}
        #todo:hide it
        [ai]
            grouping=offensive
        [/ai]
    [/side]

    [side]
        side=3
        controller=ai
        {GOLD 0 0 0}
        {INCOME 0 0 0}
        team_name=Animals
        user_team_name= _ "Animals"
        {FLAG_VARIANT wood-elvish}
        hidden=yes
        # set these values as they will be displayed in the status table
        gold=0
        income=-2
        village_gold=0
        village_support=0
        # make animals only move within the forest
        [ai]
            [avoid]
                [not]
                    x=1-30
                    y=1-16
                [/not]
            [/avoid]
        [/ai]
    [/side]

    [side]
        side=4
        color=green
        controller=ai
        team_name=Loyalists
        user_team_name= _ "Elves"
        hidden=yes
        {FLAG_VARIANT wood-elvish}
    [/side]

    [event]
        name=prestart

        {ROOTLESS_HELP}
        {PLACE_IMAGE (scenery/cave.png) 15 7}
        {PLACE_IMAGE (scenery/signpost.png) 25 2}

        [objectives]
            [objective]
                description= _ "Hunt animals until the end of turns"
                condition=win
                [show_if]
                    [not]
                        [have_unit]
                            id=Toruk
                        [/have_unit]
                    [/not]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Death of Arshag"
                condition=lose
            [/objective]

            [objective]
                caption= _ "Optional objective:"
                description= _ "Feed the wolves a goblin to tame them"
                condition=win
                [show_if]
                    [variable]
                        name=found_wolves
                        boolean_equals=yes
                    [/variable]
                    [and]
                        [have_unit]
                            side=3
                            race=wolf
                        [/have_unit]
                    [/and]
                [/show_if]
            [/objective]
            [objective]
                caption= _ "Optional objective:"
                description= _ "All of the wolves die"
                condition=lose
                [show_if]
                    [have_unit]
                        side=1
                        type=Wolf
                    [/have_unit]
                [/show_if]
            [/objective]
            [objective]
                condition=lose
                description=_ "Death of Toruk"
                [show_if]
                    [have_unit]
                        id=Toruk
                    [/have_unit]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Survive until the end of turns"
                condition=win
                [show_if]
                    [have_unit]
                        id=Morvin
                    [/have_unit]
                    [and]
                        [not]
                            [have_unit]
                                id=Lord Logalmier
                            [/have_unit]
                        [/not]
                    [/and]
                [/show_if]
            [/objective]
            [objective]
                caption= _ "Alternative objective:"
                description= _ "Defeat Morvin"
                condition=win
                [show_if]
                    [have_unit]
                        id=Morvin
                    [/have_unit]
                    [and]
                    [variable]
                        name=retreat
                        not_equals=yes
                    [/variable]
                    [/and]
                [/show_if]
            [/objective]
            [objective]
                description= _ "Move Arshag to the signpost in the northeast"
                condition=win
                [show_if]
                    [variable]
                        name=retreat
                        boolean_equals=yes
                    [/variable]
                [/show_if]
            [/objective]

            [gold_carryover]
                carryover_percentage=0
                bonus=no
            [/gold_carryover]

        [/objectives]


#spawn Toruk in the camp for a cutscene
        [recall]
            id=Toruk
            x,y=11,17
            facing=se
        [/recall]

        [remove_shroud]
            side=1
        [/remove_shroud]

#set the behaviour of animals in the forest
        [micro_ai]
            [filter]
                type=Wolf
            [/filter]
            side=3
            ai_type=wolves
            action=add
            [filter_second]
            [/filter_second]
        [/micro_ai]
        [micro_ai]
            side=3
            ai_type=forest_animals
            action=add
            deer_type=Piglet
        [/micro_ai]
        [micro_ai]
            side=3
            ai_type=hunter
            action=add
            id=Mum
            home_x,home_y=30,4
        [/micro_ai]

    [/event]

    [event]
        name=start

        [message]
            speaker=Arshag
            message= _ "I'm heading into the forest, Toruk. We'll catch something for breakfast."
        [/message]

        [message]
            speaker=Toruk
            message= _ "Good, but be back soon. Gotta keep together. Can't have those pink maggots sneak up on us."
        [/message]

        [message]
            speaker=Arshag
            message= _ "I think we've lost them."
        [/message]

        [message]
            speaker=Toruk
            message= _ "I sure hope so."
        [/message]

        [message]
            speaker=Arshag
            message= _ "Stop making that long face of yours. I'll bring you a tasty piglet to fill your stomach, old dog."
        [/message]

        [message]
            speaker=Toruk
            message= _ "Yeah, that will lift my spirits."
        [/message]

        {MOVE_UNIT id=Arshag 9 4}

        [unit]
            side=1
            type=Orcish Archer
            x,y=10,4
            facing=ne
        [/unit]

        [unit]
            side=1
#ifdef EASY
            type=Orcish Archer
#endif EASY
#ifdef NORMAL
            type=Orcish Archer
#endif NORMAL
#ifdef HARD
            type=Goblin Spearman
#endif HARD
            x,y=8,4
            facing=ne
        [/unit]


#ifdef EASY
        [unit]
            side=1
            type=Goblin Spearman
            x,y=8,4
            facing=ne
        [/unit]
#endif EASY

        [unit]
            side=1
            type=Goblin Spearman
            x,y=8,3
            facing=ne
        [/unit]

        [unit]
            side=1
            type=Goblin Spearman
            x,y=9,5
            facing=ne
        [/unit]

#ifdef EASY
        [unit]
            side=1
            type=Goblin Spearman
            x,y=7,4
            facing=ne
        [/unit]
#endif EASY

        [unit]
            id=Wolf1
            side=3
            type=Wolf
            upkeep=loyal
            x,y=25,10
            [modifications]
                {TRAIT_RTL_YOUNG}
            [/modifications]
        [/unit]

        [unit]
            id=Wolf2
            side=3
            type=Wolf
            upkeep=loyal
            x,y=26,10
            [modifications]
                {TRAIT_RTL_YOUNG}
            [/modifications]
        [/unit]

        [unit]
            id=Wolf3
            side=3
            type=Wolf
            upkeep=loyal
            x,y=25,11
        [/unit]

        [unit]
            side=3
            type=Piglet
            x,y=3,3
        [/unit]

        [unit]
            side=3
            type=Piglet
            x,y=12,6
        [/unit]

        [unit]
            side=3
            type=Piglet
            x,y=4,11
        [/unit]


        [unit]
            side=3
            type=Piglet
            id=Kid
            x,y=30,4
        [/unit]

        [unit]
            side=3
            type=Piglet
            id=Kid
            x,y=29,4
        [/unit]

        [store_unit]
            [filter]
                id=Toruk
            [/filter]
            variable=toruk_store
        [/store_unit]

        [kill]
            id=Toruk
            animate=no
        [/kill]

        [place_shroud]
            [filter_side]
                side=1
            [/filter_side]
            radius=50
        [/place_shroud]

        [redraw]
            clear_shroud=yes
        [/redraw]

        [if]
            [have_unit]
                id=Arshag
                type=Orcish Nightblade
            [/have_unit]
            [then]
                [remove_object]
                    id=Arshag
                    object_id=arshag_nightblade_compatibility
                [/remove_object]
            [/then]
            [else]
                {VARIABLE hunting_phase yes}
            [/else]
        [/if]

        [if]
            [have_unit]
                id=Arshag
                [has_attack]
                    special_id=slow
                [/has_attack]
            [/have_unit]
            [then]
            [/then]
            [else]
                [object] #switches Arshag's weapon special to slow for the hunt
                        id=knives_slowing
                        [filter]
                            id=Arshag
                        [/filter]

                        [effect]
                            apply_to=attack
                            range=ranged
                            remove_specials=poison
                            set_icon="data/core/images/attacks/dagger-thrown-human.png"
                            [set_specials]
                                mode=append
                                {WEAPON_SPECIAL_SLOW}
                            [/set_specials]
                        [/effect]

                    [/object]

                    [message]
                        speaker=Arshag
                        message= _ "I'll practice a bit with Clerila's knives for the hunt."
                    [/message]
            [/else]
        [/if]

        [replace_map]
            map_file=Small.map
            shrink=yes
            expand=yes
        [/replace_map]

    [/event]

    [event]
        name=time over
        [message]
            race=orc
            [not]
                id=Arshag
            [/not]
            message= _ "They're encircling us!"
        [/message]

        [message]
            speaker=Arshag
            message= _ "We will never leave this valley alive!"
        [/message]
    [/event]

    [event]
    #pigs respawn forever

        name=last breath
        first_time_only=no

        [filter]
            type=Piglet
        [/filter]

        [set_variable]
            name=xpig
            rand=1..30
        [/set_variable]
        [set_variable]
            name=ypig
            rand=1..16
        [/set_variable]

        [unit]
            side=3
            type=Piglet
            x,y=$xpig,$ypig
        [/unit]

    [/event]

    [event] #Morvin dies and drops a crossbow
        name=last breath
        [filter]
            id=Morvin
        [/filter]

        [if]
            [have_unit]
                id=Lord Logalmier
            [/have_unit]
            [then]
                [message]
                    speaker=unit
                    message= _ "I may fall, but the Kingdom of Wesnoth will triumph."
                [/message]

                {VARIABLE morvin_dead yes}
                {VARIABLE cbowX $x1}
                {VARIABLE cbowY $y1}

                [kill]
                    id=Morvin
                    animate=yes
                [/kill]

                {PLACE_IMAGE (items/crossbow.png) ($cbowX) ($cbowY)}

            [/then]
            [else]
                [message]
                    id=Morvin
                    message= _ "It seems I'm destined to die in this strange new land. I'll take comfort in knowing that all of you shall soon join me."
                [/message]

                [message]
                    id=Toruk
                    message= _ "What are you talking about?"
                [/message]

                [message]
                    id=Morvin
                    message= _ "I've sent message to Logalmier, one of the elvish lords of Wesmere. He dwells nearby and hates orcs with a burning passion."
                [/message]

                {VARIABLE cbowX $x1}
                {VARIABLE cbowY $y1}

                [kill]
                    id=Morvin
                    animate=yes
                [/kill]

                {PLACE_IMAGE (items/crossbow.png) ($cbowX) ($cbowY)}

                [message]
                    id=Toruk
                    message= _ "Arshag! We can't hope to defeat an entire army!"
                [/message]

                [message]
                    id=Arshag
                    message= _ "I know. We go north for the mountains. It's the only way to escape the elvish riders."
                [/message]

                {HIGHLIGHT_IMAGE 25 2 scenery/signpost.png ()}

                [set_variable]
                    name=logalmier
#ifdef EASY     
                    value="$($turn_number + 5)"
#endif
#ifdef NORMAL     
                    value="$($turn_number + 4)"
#endif
#ifdef HARD     
                    value="$($turn_number + 3)"
#endif
                [/set_variable]

                [modify_turns]
                    add=10
                [/modify_turns]

                {VARIABLE retreat yes}

                [show_objectives]
                [/show_objectives]
            [/else]
        [/if]
    [/event]

    [event]
        name=sighted
        [filter]
            id=Kid
        [/filter]
        
        [filter]
            x=$x1
            y=$y1
	    [/filter]

        [message]
            speaker=Arshag
            message= _ "There's a nice, fat piggy!"
        [/message]

        [unit]
            side=3
            type=Woodland Boar
            id=Mum
            moves=0 #so that the Boar can't attack in it's first turn and one shot L1 Arshag
            x,y=$x1,$y1
#ifdef EASY
            [modifications]
                [object]
                    [effect]
                        apply_to=attack
                        name=tusk
                        remove_specials=charge
                        set_icon="data/core/images/attacks/dagger-thrown-human.png"
                    [/effect]
                [/object]
            [/modifications]
#endif
        [/unit]

        [message]
            speaker=Mum
            message= _ "*roars*"
        [/message]

        [message]
            race=orc
            [not]
                id=Arshag
            [/not]
            message= _ "Chief?"
        [/message]

    [/event]

[event]
        name=sighted
        [filter]
            race=wolf
        [/filter]

        [message]
            race=goblin
            message= _ "Look chief, a wolf!"
        [/message]

        [message]
            speaker=Arshag
            message= _ "We need some to replace those we left on the Green Isle."
        [/message]

        [message]
            speaker=Arshag
            font_size=small
            message= _ "If we <i>feed them</i>, they might follow us to the camp."
        [/message]

        {VARIABLE found_wolves yes}

        [show_objectives]
        [/show_objectives]

    [/event]

    [event]

        name=die
        [filter]
            race=goblin
        [/filter]
        [filter_second]
            race=wolf
        [/filter_second]

            [kill]
                id=$unit
                animate=yes
            [/kill]

            {VARIABLE fed_wolves yes}

            [sound]
                name=bite.ogg
            [/sound]

            [message]
                speaker=$second_unit.id
                image=portraits/wolves/wolf-chewing.webp
                message= _ "*chewing*"
            [/message]

            [if]
                [have_unit]
                    race=orc
                    side=1
                    [not]
                        id=Arshag
                    [/not]
                [/have_unit]
                [then]
                    
                    [message]
                        side=1
                        race=orc
                        font_style=italic
                        [not]
                            id=Arshag
                        [/not]
                        message= _ "Oh, no! The wolf got him!"
                    [/message]

                    [message]
                        speaker=Arshag
                        font_style=italic
                        message= _ "What a tragedy!"
                    [/message]

                    [delay]
                        time=1500
                    [/delay]
                [/then]
            [/if]

            [store_unit]
                [filter]
                    race=wolf
                    side=3
                [/filter]
                variable=wolves_count
            [/store_unit]

            [if]
                [variable]
                    name=wolves_count.length
                    greater_than=1
                [/variable]
                [then]
                    [message]
                        speaker=Arshag
                        message= _ "All right, they seem to enjoy their meal. I think they'll follow us now."
                    [/message]
                [/then]
                [else]
                    [message]
                        speaker=Arshag
                        message= _ "All right, it seems to enjoy the meal. I think it'll follow us now."
                    [/message]
                [/else]
            [/if]

            {CLEAR_VARIABLE wolves_count}

            [modify_unit]
                [filter]
                    race=wolf
                    side=3
                [/filter]
                side=1
                [object]
                    [effect]
                        apply_to=overlay
                        add="misc/protect-icon.png"
                    [/effect]
                [/object]
            [/modify_unit]

            [heal_unit]
                [filter]
                    race=wolf
                    side=1
                [/filter]
            [/heal_unit]

            {HINT_PROTECT}

            [show_objectives]
            [/show_objectives]
    [/event]

#ifdef EASY
    [event]

        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x,y=15,7
        [/filter]

            {VARIANT_SAY "Look! A cave with tasty shrooms!" "Look! A cave with tasssty ssshroomsss!" "Look! A cave with tasty shrooms!" "Look! A cave with tasty shrooms!" "Look! A cave with tasty shrooms!"}

            [message]
                speaker=narrator
                image=wesnoth-icon.png
                message= _ "Your units will restore 8 HP if they end their turn in the cave."
            [/message]

    [/event]

    [event]

        name=new turn
        first_time_only=no

        [heal_unit]
            amount=8
            animate=yes
            [filter]
                side=1
                x,y=15,7
            [/filter]
        [/heal_unit]

    [/event]
#endif EASY

    [event]
        id=cave_normal
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x,y=15,7
                [not]
                    race=wolf
                [/not]
                [not]
                    id=Arshag
                [/not]
        [/filter]
#ifdef NORMAL
            {VARIANT_SAY "Look! Red eyes inside. I'm scared!" "Sssomething with red eyesss isss inssside." "Look! Red eyes inside. I'm scared!" "Look! Red eyes inside. I'm scared!"}
            [unit]
                side=3
                type=Vampire Bat
                x,y=15,7
            [/unit]
#endif
#ifdef HARD
            {VARIANT_SAY "Look! Something big is there. I'm scared!" "Sssomething big isss inssside." "Look! Something big is there. I'm scared!" "Look! Red eyes inside. I'm scared!"}
            [unit]
                side=3
                type=Cave Bear
                x,y=15,7
            [/unit]
#endif
            [remove_event]
                id=cave_wolf,cave_arshag
            [/remove_event]
    [/event]

    [event]
        id=cave_arshag
        name=moveto
        first_time_only=yes
        [filter]
            x,y=15,7
            id=Arshag
        [/filter]
#ifdef NORMAL
            [message]
                speaker=Arshag
                message= _ "There's a large bat in this cave. I probably made him angry."
            [/message]
            [unit]
                side=3
                type=Vampire Bat
                x,y=15,7
            [/unit]
#endif
#ifdef HARD
            [message]
                speaker=Arshag
                message= _ "There's a bear! And he looks like he'd like us for dinner!"
            [/message]
            [unit]
                side=3
                type=Cave Bear
                x,y=15,7
            [/unit]
#endif
            [remove_event]
                id=cave_wolf,cave_normal
            [/remove_event]
    [/event]

    [event]
        id=cave_wolf
        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x,y=15,7
            race=wolf
        [/filter]
#ifdef NORMAL
            [unit]
                side=3
                type=Vampire Bat
                x,y=15,7
            [/unit]
#endif
#ifdef HARD
            [unit]
                side=3
                type=Cave Bear
                x,y=15,7
            [/unit]
#endif
            [remove_event]
                id=cave_arshag,cave_normal
            [/remove_event]
    [/event]


    [event]
#goblin ex machina appears if there is none the player can feed to the wolves

        name=new turn
        first_time_only=no

        [if]  

            [not]
                [have_unit]
                    side=1
                    race=wolf
                [/have_unit]
            [/not]  
            [and]
                [not]  
                    [have_unit]
                        race=goblin
                    [/have_unit] 
                [/not] 
            [/and]
            [and]
                [not]  
                    [have_unit]
                        id=Toruk
                    [/have_unit] 
                [/not] 
            [/and]

            [then]  
            [unit]
                side=1
                type=Goblin Spearman
                placement=leader
            [/unit]

                [message]
                    race=goblin
                    message= _ "Hey, chief! Toruk heard fighting so he sent me."
                [/message]
            [/then]

        [/if]
    [/event]

    [event]

        name=moveto
        first_time_only=yes
        [filter]
            side=1
            x,y=26,21
        [/filter]

            [message]
                speaker=unit
                [not]
                    race=wolf
                [/not]
                message= _ "There's something inside!"
            [/message]

            [unit]
                side=1
                id=Naga
                type=Naga Fighter
                x,y=26,22
                gender=female
                [modifications]
                    {TRAIT_LOYAL}
                [/modifications]
            [/unit]

            [message]
                speaker=Naga
                message= _ "What are you?"
            [/message]

            [message]
                speaker=Arshag
                message= _ "Just a band of orcs trying to get out of the lands controlled by humans."
            [/message]

            [message]
                speaker=Naga
                message= _ "Isssn't everyone? I usssed to live further down the river, until they came and built their sssettlement around the lake. They called me a monster and threw rocksss at me."
            [/message]

            [message]
                speaker=Arshag
                message= _ "They sure throw around a lot of slurs for beings as ugly as they are. Join us on our journey and maybe we'll find a new home together."
            [/message]

            [message]
                speaker=Naga
                message= _ "I sssee they are already in the valley. They'll tassste my blade."
            [/message]

    [/event]

    [event]
#the player loses if all of their wolves are killed

        name=die
        first_time_only=no

        [filter]  
            race=wolf
            side=1
        [/filter]

        [if]
            [not]   
                [have_unit]
                    race=wolf
                    side=1
                [/have_unit] 
            [/not] 

            [then]  
                [message]
                    id=Arshag
                    message= _ "No! The last of our wolves is dead."
                [/message]
                {CLEAR_VARIABLE fed_wolves}
            [/then]

        [/if]
    [/event]

    [event]
        name=die
        first_time_only=no

        [filter]  
            race=wolf
            side=3
        [/filter]

        [if]
            [not]   
                [have_unit]
                    race=wolf
                    side=3
                [/have_unit] 
            [/not] 

            [then]  
                [message]
                    id=Arshag
                    message= _ "No! The last of the wolves is dead!"
                [/message]
                [message]
                    id=Arshag
                    message= _ "This way we don't get any riders until we come upon the next pack."
                [/message]
            [/then]

        [/if]
    [/event]

    [event]
#give a bit of gold for every animal hunted
        name=last breath
        first_time_only=no
        [filter]
            side=3
        [/filter]
        [filter_second]
            side=1
        [/filter_second]
        [gold]
            side=1
            #ifdef EASY
            amount=5
            #endif EASY
            #ifdef NORMAL
            amount=4
            #endif NORMAL
            #ifdef HARD
            amount=3
            #endif HARD
        [/gold]
        [sound]
            name=gold.ogg
        [/sound]
    [/event]


    [event]
#the initial hunt is over, the skirmish starts

        name=side 2 turn 10 end

        [message]
            id=Arshag
            message= _ "Time to get back to the camp."
        [/message]

        [replace_map]
            map_file=02_The_Hunt.map
            shrink=yes
            expand=yes
        [/replace_map]
        {MODIFY_TERRAIN Ce 24 34}
        {MODIFY_TERRAIN Ce 25 34}
        {MODIFY_TERRAIN Ce 26 33}
        {MODIFY_TERRAIN Ce 27 33}
        {MODIFY_TERRAIN Ce 26 34}
        {MODIFY_TERRAIN Ke 27 34}
        {MODIFY_TERRAIN Re^Vct 23 36}
        {MODIFY_TERRAIN Re^Vct 27 36}
        {MODIFY_TERRAIN Re^Vct 29 35}
        {MODIFY_TERRAIN Re^Vct 29 37}
        {MODIFY_TERRAIN Gg^Eb 28 36}
        [capture_village]
            x,y=11,17
            radius=4
            side=1
        [/capture_village]

        [kill]
            side=3
        [/kill]

        {CLEAR_VARIABLE xpig}
        {CLEAR_VARIABLE ypig}
        {CLEAR_VARIABLE found_wolves}

        [move_unit]
            side=1
            to_x=11
            to_y=17
            clear_shroud=yes
        [/move_unit]

        [remove_shroud]
        [/remove_shroud]

        [remove_object]
            id=Arshag
            object_id=knives_slowing
        [/remove_object]

        [if]
            [have_unit]
                id=Arshag
                type=Orcish Nightblade
            [/have_unit]
            [then]
                [modify_unit]
                    [filter]
                        id=Arshag
                    [/filter]
                    [object]
                        id=arshag_nightblade_compatibility
                        duration=forever
                        [effect]
                            apply_to=new_advancement
                            replace=yes
                            types=null
                            {AMLA_ARSHAG}
                        [/effect]
                        [effect]
                            apply_to=max_experience
                            set=36
                        [/effect]
                    [/object]
                [/modify_unit]
            [/then]
            [else]
                {CLEAR_VARIABLE hunting_phase}
            [/else]
        [/if]

        [unstore_unit]
            variable=toruk_store
            find_vacant=yes
        [/unstore_unit]

        {CLEAR_VARIABLE toruk_store}

        [message]
            id=Arshag
            message= _ "We're back."
        [/message]

        [unit]
            type=Lieutenant
            id=Morvin
            name=_ "Morvin"
            canrecruit=yes
            x,y=27,34
            facing=nw
            side=2
            [modifications]
                [object]
                    name= _ "Morvin's Crossbow"
                    duration=forever
                    [effect]
                        apply_to=attack
                        range=ranged
                        [set_specials]
                            mode=append
                            {WEAPON_SPECIAL_MARKSMAN}
                        [/set_specials]
                    [/effect]
                    [effect]
                        apply_to=overlay
                        add="misc/gift-icon.png"
                    [/effect] 
                [/object]
            [/modifications]
        [/unit]

        [modify_side]
            side=2
            {GOLD 160 185 220}
            {INCOME 2 3 4}
            hidden=no
        [/modify_side]

        [capture_village]
            x,y=27,34
            radius=6
            side=2
        [/capture_village]

        [modify_side]
            side=1
            {INCOME 3 0 0}
        [/modify_side]

        [store_gold]
            side=1
        [/store_gold]

        [if]
            [variable]
                name=gold
                greater_than_equal_to={ON_DIFFICULTY 30 24 18}
            [/variable]
            [then]
                [set_achievement]
                    content_for=RTL_SP
                    id=RTL_hunt
                [/set_achievement]
            [/then]
        [/if]

        {CLEAR_VARIABLE gold}

        [gold]
            side=1
            amount={ON_DIFFICULTY 175 140 130}
        [/gold]

        [modify_turns]
            value=25
        [/modify_turns]

        [message]
            id=Toruk
            message= _ "I have some bad news. There are humans on the other side of the river."
        [/message]

        [message]
            id=Arshag
            message= _ "How many?"
        [/message]

        [message]
            id=Toruk
            message= _ "Enough to take us on, I reckon."
        [/message]

        [message]
            id=Morvin
            message= _ "Vile orcs! You've destroyed the Green Isle, the home of our fathers. Your mere existence is an affront to their memory."
        [/message]

        [message]
            id=Arshag
            message= _ "Leave now and no blood will be spilled."
        [/message]

        [message]
            id=Morvin
            message= _ "I'll be damned if I let any of you escape!"
        [/message]

        [message]
            id=Toruk
            message= _ "Arshag, we should flee north."
        [/message]

        [message]
            id=Arshag
            message= _ "There are mountains there, not much to hunt.

The humans are far from their closest settlements. If we hold our camp long enough, they'll have to turn back."
        [/message]

        [message]
            id=Arshag
            message= _ "How would I look as chief if I refused to fight every time?"
        [/message]

        [store_unit]
            [filter]
                race=wolf
                side=1
            [/filter]
            variable=wolves_count
        [/store_unit]

        [if]
            [variable]
                name=wolves_count.length
                greater_than=1
            [/variable]
            [and]
                [have_unit]
                    race=wolf
                    side=1
                [/have_unit]
            [/and]
            [then]
                [message]
                    speaker=Arshag
                    message= _ "Saddle these wolves, take the meat and head into the woods to catch more of them. We're gonna need them in this fight."
                [/message]
            [/then]
            [else]
                [if]
                    [variable]
                        name=wolves_count.length
                        not_equals=0
                    [/variable]
                    [then]
                        [message]
                            speaker=Arshag
                            message= _ "Saddle this wolf, take the meat and head into the woods to catch more of them. We're gonna need them in this fight."
                        [/message]
                    [/then]
                [/if]
            [/else]
        [/if]

        {CLEAR_VARIABLE wolves_count}

        [repeat]
            times=3
            [do]
                {VARIABLE_OP wolves_anim add 1}
                [transform_unit]
                    id=Wolf$wolves_anim
                    transform_to=Wolf Rider
                [/transform_unit]
                [move_unit]
                    id=Wolf$wolves_anim
                    to_x=11
                    to_y=12
                [/move_unit]
                [kill]
                    id=Wolf$wolves_anim
                    animate=no
                [/kill]
            [/do]
        [/repeat]

        {CLEAR_VARIABLE wolves_anim}

        [if]
            [variable]
                name=fed_wolves
                equals=yes
            [/variable]
            [then]
                [allow_recruit]
                    side=1
                    type=Wolf Rider
                [/allow_recruit]
#ifdef EASY
                [message]
                    speaker=narrator
                    message= _ "You can now recruit Wolf Riders."
                    image=wesnoth-icon.png
                [/message]
#endif
            [/then]
        [/if]

        {HINT_ITEM}

        [show_objectives]
        [/show_objectives]

    [/event]

    [event]
        name=turn 11
        [replace_schedule]
            {DEFAULT_SCHEDULE}
#ifdef EASY
            current_time=0
#else
            current_time=4
#endif
        [/replace_schedule]
    [/event]

    [event] #picking up the crossbow
        name=moveto
        first_time_only=no
        [filter]
            side=1
            type=Orcish Archer,Orcish Crossbowman,Orcish Slurbow
            x=$cbowX
            y=$cbowY
        [/filter]

        [if]
            [have_unit]
                type=Orcish Archer
                x,y=$cbowX,$cbowY
            [/have_unit]
            [then]
                [message]
                    speaker=unit
                    caption=""
                    image="wesnoth-icon.png"
                    male_message= _ "What should $unit.name| do with the the crossbow?"
                    female_message= _ "What should female^Should $unit.name| do with the the crossbow?"
                    [option]
                        label= _ "Equip the crossbow"
                        [command]
                            [remove_item]
                                x=$cbowX
                                y=$cbowY
                            [/remove_item]
                            {CLEAR_VARIABLE furX}
                            {CLEAR_VARIABLE furY}
                            [object]
                                id=cbow_morvin
                                name= _ "Morvin's Crossbow"
                                image=attacks/crossbow-human.png
                                duration=forever
                                description= _ "Instantly advances your archer to a crossbowman."
                                [effect]
                                    apply_to=attack
                                    range=ranged
                                    set_icon="data/core/images/attacks/crossbow-human.png"
                                [/effect]
                            [/object]
                            [message]
                                speaker=unit
                                message= _ "This will come handy! Much better than a bow."
                            [/message]
                            {ADVANCE_UNIT (x,y=$cbowX,$cbowY) ()}
                            [remove_item]
                                x,y=$cbowX,$cbowY
                            [/remove_item]
            
                            {CLEAR_VARIABLE cbowX,cbowY}
                        [/command]
                    [/option]
                    [option]
                        label= _ "Nothing"
                        [command]
                            [allow_undo][/allow_undo]
                        [/command]
                    [/option]
                [/message]
            [/then]
            [else]
                [message]
                    speaker=unit
                    caption=""
                    image="wesnoth-icon.png"
                    male_message= _ "What should $unit.name| do with the the crossbow?"
                    female_message= _ "What should female^Should $unit.name| do with the the crossbow?"
                    [option]
                        label= _ "Equip the crossbow"
                        [command]
                            [remove_item]
                                x=$cbowX
                                y=$cbowY
                            [/remove_item]
                            {CLEAR_VARIABLE furX}
                            {CLEAR_VARIABLE furY}
                            [message]
                                speaker=unit
                                message= _ "Great craftsmanship. I'll put it to good use."
                            [/message]
                            [role] #todo: remove once items no longer rely on roles
                                x,y=$cbowX,$cbowY
                                role=Xbowman
                            [/role]
                            [object]
                                id=cbow_morvin
                                name= _ "Morvin's Crossbow"
                                image=attacks/crossbow-human.png
                                duration=forever
                                description= _ "The unit gains <i>marksman</i> special for its ranged attacks."
                                [effect]
                                    apply_to=attack
                                    range=ranged
                                    set_icon="data/core/images/attacks/crossbow-human.png"
                                    [set_specials]
                                        mode=append
                                        {WEAPON_SPECIAL_MARKSMAN}
                                    [/set_specials]
                                [/effect]
                                [effect]
                                    apply_to=overlay
                                    add="misc/gift-icon.png"
                                [/effect] 
                            [/object]
                            [remove_item]
                                x,y=$cbowX,$cbowY
                            [/remove_item]
            
                            {CLEAR_VARIABLE cbowX,cbowY}
                            {HINT_ITEM}
                        [/command]
                    [/option]
                    [option]
                        label= _ "Nothing"
                        [command]
                            [allow_undo][/allow_undo]
                        [/command]
                    [/option]
                [/message]
            [/else]
        [/if]
    [/event]

    [event] #only archer line can pick up the crossbow
        name=moveto
        first_time_only=no
        [filter]
            side=1
            [not]
                type=Orcish Archer,Orcish Crossbowman,Orcish Slurbow
            [/not]
            x=$cbowX
            y=$cbowY
        [/filter]

        {VARIANT_SAY "I don't know how to use this. Better send for some archer." "I don't know how to ussse thisss. Better sssend for sssome archer." "I don't know how to use this. Better send for some archer." "I don't know how to use this. Better send for some archer."}
        [allow_undo][/allow_undo]
    [/event]

    [event]
#Logalmier enters the chat
        name=turn 25

        [if]
            [have_unit]
                id=Morvin
            [/have_unit]

            [then]

                [micro_ai]
                    ai_type=zone_guardian
                    side=4
                    action=add
                    id=Lord Logalmier
                    [filter_location]
                        x,y=3,44
                    [/filter_location]
                [/micro_ai]

                [message]
                    id=Morvin
                    message= _ "Foolish orcs! You're doomed."
                [/message]

                [sound]
			        name=horn-signals/horn-6.ogg
		        [/sound]

                {LOGALMIER_APPEARS}

                [message]
                    id=Lord Logalmier
                    message= _ "So... the human messenger was right. There really are orcs this close to my realm."
                [/message]

                [message]
                    id=Lord Logalmier
                    message= _ "They need to be... eliminated before they can settle and become a threat. Dispose of them."
                [/message]

                [message]
                    type=Elvish Outrider
                    message= _ "At once, my lord."
                [/message]

                [message]
                    id=Toruk
                    message= _ "There's so many of them!"
                [/message]

                [message]
                    id=Arshag
                    message= _ "Everyone, run faster! Only in the mountains can we lose their riders."
                [/message]

                [modify_turns]
                    add=10
                [/modify_turns]

            [/then]
        [/if]

    [/event]

    [event]
#Logalmier after killing Morvin
        name=turn $logalmier

                [micro_ai]
                    ai_type=zone_guardian
                    side=4
                    action=add
                    id=Lord Logalmier
                    [filter_location]
                        x,y=3,44
                    [/filter_location]
                [/micro_ai]

                [sound]
			        name=horn-signals/horn-6.ogg
		        [/sound]

                {LOGALMIER_APPEARS}

                [message]
                    id=Lord Logalmier
                    message= _ "So... the human messenger was right. There really are orcs this close to my realm."
                [/message]

                [message]
                    type=Elvish Hero
                    message= _ "And it seems the humans failed to stop the filth."
                [/message]

                [message]
                    id=Lord Logalmier
                    message= _ "I must say I'm not surprised. It falls to us to cleanse this land of the orcish presence."
                [/message]

                [message]
                    type=Elvish Outrider
                    message= _ "At once, my lord."
                [/message]

                [message]
                    id=Toruk
                    message= _ "Here they are, Arshag. They're many."
                [/message]

                [message]
                    id=Arshag
                    message= _ "Don't look back, run faster!"
                [/message]

    [/event]

    [event]
#elvish army spawns indefinitely
        name=turn end
        first_time_only=no

        [filter_condition]
            [have_unit]
                id=Lord Logalmier
            [/have_unit]
        [/filter_condition]

            {ELVISH_ARMY}

            {CLEAR_VARIABLE elvish_units}

    [/event]

    [event]
        name=moveto
        [filter_condition]
            [variable]
                name=retreat
                boolean_equals=yes
            [/variable]
        [/filter_condition]
        [filter]
            x=25
            y=2
            id=Arshag
        [/filter]
        [if]
            [have_unit]
                id=Lord Logalmier
            [/have_unit]
            [then]
                [message]
                    speaker=Arshag
                    message= _ "We made it!"
                [/message]
                [message]
                    speaker=Lord Logalmier
                    message= _ "Running away won't save you. I'll hunt you to the end of the world if I have to."
                [/message]
                [endlevel]
                    result=victory
                    bonus=no
                    {NEW_GOLD_CARRYOVER 0}
                [/endlevel]
                {CLEAR_VARIABLE retreat}
                {CLEAR_VARIABLE logalmier}
                {CLEAR_VARIABLE elvish_army}
            [/then]
            [else]
                [sound]
			        name=horn-signals/horn-6.ogg
		        [/sound]

                {LOGALMIER_APPEARS}

                [message]
                    id=Lord Logalmier
                    message= _ "So... the human messenger was right. There really are orcs this close to my realm."
                [/message]

                [message]
                    id=Lord Logalmier
                    message= _ "It seems they are retreating. It is of paramount importance that they are eliminated to the last one. We will give pursuit."
                [/message]

                [message]
                    type=Elvish Outrider
                    message= _ "As you wish, my lord."
                [/message]

                [message]
                    id=Toruk
                    message= _ "They're not stopping. I think they'll follow us."
                [/message]

                [message]
                    id=Arshag
                    message= _ "Then we have no time to lose. Onward!"
                [/message]

                [endlevel]
                    result=victory
                    bonus=no
                    {NEW_GOLD_CARRYOVER 0}
                [/endlevel]
                {CLEAR_VARIABLE retreat}
                {CLEAR_VARIABLE logalmier}
                {CLEAR_VARIABLE elvish_army}
            [/else]
        [/if]
    [/event]

    #just in case someone crazy kills Logalmier, but the plot armor should be enough
    [event]
        name=last breath
        first_time_only=no
        [filter]
            id=Lord Logalmier
        [/filter]
        [message]
            speaker=Lord Logalmier
            message= _ "You think you can defeat me, foolish orcs? I'm not even sweating so far..."
        [/message]
        {ADVANCE_UNIT (id="Lord Logalmier") ()}
    [/event]

    [event]
        
#the orcs learn about Logalmier in case they haven't yet disposed of Morvin
#ifdef EASY
        name=turn 20
#endif
#ifdef NORMAL
        name=turn 23
#endif
#ifdef HARD
        name=turn 23
#endif
        first_time_only=no

        [if]
            [have_unit]
                id=Morvin
            [/have_unit]
            [then]
                [unit]
                    id=Question
                    side=2
                    type=Spearman
                    placement=leader
                [/unit]

                [message]
                    speaker=Question
                    message= _ "Sir, they're still resisting! When will the elves come?"
                [/message]

                [message]
                    speaker=Morvin
                    message= _ "Hush, you fool! Keep fighting."
                [/message]

                [message]
                    speaker=Toruk
                    message= _ "Did you hear that?"
                [/message]

                [message]
                    speaker=Arshag
                    message= _ "I did, and I don't like it one bit. Tell everyone to start retreating north."
                [/message]

                {VARIABLE retreat yes}

                {HIGHLIGHT_IMAGE 25 2 scenery/signpost.png ()}

                [show_objectives]
                [/show_objectives]
            [/then]
        [/if]

    [/event]

    [event] #achievement for killing all humans
        name=last breath
        first_time_only=no
        [filter]
            side=2
        [/filter]
        [filter_condition]
            [have_unit]
                id=Lord Logalmier
            [/have_unit]
        [/filter_condition]
        [if]
            [have_unit]
                side=2
                [not]
                    id=$unit.id
                [/not]
            [/have_unit]
            [then]
            [/then]
            [else]
                [set_achievement]
                    content_for=RTL_SP
                    id=RTL_humans
                [/set_achievement]
            [/else]
        [/if]
    [/event]

[/scenario]
