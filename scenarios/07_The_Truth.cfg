#textdomain wesnoth-rtl

[scenario]
    id=07_The_Truth
    name= _ "The Truth"
    map_data="{~add-ons/The_Rootless/maps/07_The_Truth.map}"
    next_scenario=null
    victory_when_enemies_defeated=no

    {SCENARIO_MUSIC heroes_rite.ogg}
    {EXTRA_SCENARIO_MUSIC frantic.ogg}
    {EXTRA_SCENARIO_MUSIC battle-epic.ogg}

    {DEATHS_THE_TRUTH}
    {STAFF_OF_HAUNTING}
    {RECALL_DISCOUNT}
    {MAIN_CHARACTERS_EVENTS}
    {STUURG_LEVELUP}
    {ALBINO_LEVELUP}
    {RING_OF_FROST}
    {ZOFARIAS_LOYAL}
    {LOGALMIER_ARMY}
    {DEFAULT_SCHEDULE_FIRST_WATCH}
    {ARCHER_LEVELUP}

    [story]
        [part]
            music=northerners-old.ogg
            background=story-orc.jpg
            story= _ "As the orcs gathered, Arshag met with the warlords and explained his plan. Unsurprisingly, most of them disagreed. But then Arshag introduced Stuurg and the orc leaders were stunned, as they considered all shamans to have been slaughtered."
        [/part]
        [part]
            background=story-orc.jpg
            story= _ "It is often said that orcs do not know self-sacrifice and do not believe in anything that transcends them. But this is not true."
        [/part]
        [part]
            background=story-orc.jpg
            story= _ "In times of the worst crises, the orcs have always listened to the shamans and those of their leaders who instinctively felt the flow of the world. The more the threat grew, the more did a sense of belonging find its way into the minds of the orcs. Eventually the orc warlords recognized that Arshag was right and understood what they had to do."
        [/part]
    [/story]

    {RTL_TRACK {JOURNEY_07_NEW}}

    [side]
        side=1
        defeat_condition=never
        controller=human
        {GOLD 500 420 350}
        {INCOME 7 5 3}
        village_gold=1
        team_name=Orcs
        user_team_name= _ "Orcs"
        {FLAG_VARIANT6 ragged}
        recruit="Orcish Archer,Goblin Spearman,Orcish Grunt,Orcish Assassin"
        type=Orcish Assassin
        id=Arshag
        unrenamable=yes
        facing=nw
        name= _ "Arshag"
        x,y=21,41
        [modifications]
            {TRAIT_INTELLIGENT}
        [/modifications]
        canrecruit=yes
    [/side]

    [side]
        side=2
        controller=ai
        {GOLD 220 250 270}
        {INCOME 1 2 3}
        name=Zofaria
        id=Zofaria
        [modifications]
            [object]
                [effect]
                    apply_to=image_mod
                    add=RC(magenta>black)
                [/effect]
                [effect]
                    apply_to=attack
                    name=faerie fire
                    set_description=shadow wave
                    set_name=shadow wave
                    set_icon=attacks/dark-missile.png
                [/effect]
            [/object]
            [object]
                [effect]
                    apply_to=new_animation
                    [attack_anim]
                        [filter_attack]
                            name=shadow wave
                        [/filter_attack]
                        start_time=-450
                        {MISSILE_FRAME_CHILL_WAVE 0 -5}
                        {SOUND:HIT_AND_MISS magic-dark.ogg magic-dark-miss.ogg -450}
                        [frame]
                            image="units/elves-wood/enchantress-magic-[1,2*5,1].png:75"
                            halo=halo/undead/black-magic-[1~5].png
                            halo_x,halo_y=0,-10
                        [/frame]
                    [/attack_anim]
                [/effect]
            [/object]
        [/modifications]
        type=Elvish Enchantress
        x,y=15,12
        facing=sw
        team_name=Elves
        user_team_name= _ "Zofaria"
        {FLAG_VARIANT wood-elvish}
        color=green
#ifdef EASY
        recruit="Elvish Fighter,Elvish Shaman,Elvish Archer"
#endif
#ifdef NORMAL
        recruit="Elvish Fighter,Elvish Shaman,Elvish Archer"
#endif
#ifdef HARD
        recruit="Elvish Fighter,Elvish Shaman"
#endif
    [/side]

    [side]
        side=3
        controller=ai
        {GOLD 190 220 220}
        {INCOME 1 3 5}
        id=Vethian
        name="Vethian"
        unrenamable=yes
        facing=ne
        type=Elvish Marshal
        x,y=2,16
        team_name=Elves
        user_team_name= _ "Vethian"
        {FLAG_VARIANT wood-elvish}
        color=green
        shroud=no
#ifdef EASY
        recruit="Elvish Fighter,Elvish Shaman,Elvish Archer,Wose,Elvish Scout"
#endif
#ifdef NORMAL
        recruit="Elvish Fighter,Elvish Shaman,Elvish Archer,Wose,Elvish Scout,Elvish Captain,Elvish Rider"
#endif
#ifdef HARD
        recruit="Elvish Fighter,Elvish Shaman,Elvish Archer,Wose,Elvish Scout,Elvish Captain,Elvish Rider,Elvish Marksman"
#endif
    [/side]

    [side]
        side=4
        controller=ai
        {GOLD 190 220 220}
        {INCOME 1 3 5}
        id=Tasien
        gender=female
        name="Tasien"
        unrenamable=yes
        facing=nw
        type=Elvish Sharpshooter
        x,y=36,11
        team_name=Elves
        user_team_name= _ "Tasien"
        {FLAG_VARIANT wood-elvish}
        color=green
        shroud=no
#ifdef EASY
        recruit="Elvish Fighter,Elvish Shaman,Elvish Archer,Wose,Elvish Scout,Mermaid Initiate,Merman Fighter,Merman Hunter"
#endif
#ifdef NORMAL
        recruit="Elvish Fighter,Elvish Shaman,Elvish Archer,Wose,Elvish Scout,Mermaid Initiate,Merman Fighter,Merman Hunter,Elvish Druid"
#endif
#ifdef HARD
        recruit="Elvish Fighter,Elvish Shaman,Elvish Archer,Wose,Elvish Scout,Mermaid Initiate,Merman Fighter,Merman Hunter,Elvish Druid"
#endif
    [/side]

    [side]
        side=5
        controller=ai
        hidden=yes
        team_name=Orcs,Elves
        user_team_name= _ "Frozen"
        color=white
    [/side]

    [side]
        side=6
        controller=ai
        {GOLD 220 430 500}
        {INCOME 1 3 5}
        id=Lethir
        name="Lethir"
        unrenamable=yes
        facing=nw
        type=Elvish Outrider
        x,y=19,5
        team_name=Elves
        user_team_name= _ "Logalmier's Army"
        {FLAG_VARIANT wood-elvish}
        color=green
        shroud=no
#ifdef EASY
        recruit="Elvish Fighter,Elvish Shaman,Elvish Archer,Wose,Elvish Scout"
#endif
#ifdef NORMAL
        recruit="Elvish Fighter,Elvish Shaman,Elvish Archer,Wose,Elvish Scout,Elvish Hero,Elvish Marksman,Elvish Sorceress"
#endif
#ifdef HARD
        recruit="Elvish Fighter,Elvish Shaman,Elvish Archer,Wose,Elvish Scout,Elvish Hero,Elvish Marksman,Elvish Sorceress,Elvish Rider,Elder Wose"
#endif
    [/side]

    [event]
        name=prestart

        [if] #if the player killed Lethir in S2, another Logalmier's lieutenant will appear
            [variable]
                name=lethir_dead
                equals=yes
            [/variable]
            [then]
                [kill]
                    id=Lethir
                [/kill]
                [unit]
                    type=Elvish Avenger
                    name=NÃ©rian
                    id=Lethir
                    x,y=19,5
                    facing=nw
                    side=6
                    canrecruit=yes
                [/unit]
            [/then]
        [/if]

        {ROOTLESS_HELP}
        {VARIABLE zofaria_money 6}

        {PLACE_IMAGE (items/anvil.png) 23 41}
        {PLACE_IMAGE (items/box.png) 17 37}
        {PLACE_IMAGE (items/box.png) 17 38}

        {READY_THE_ARMIES}

        [capture_village]
            x="1,3,5,16,17,18,19,20,21,22,23,24,33"
	        y="30,39,26,29,24,37-38,37-39,36-39,36-39,36-39,37-39,37-38,18"
            side=1
        [/capture_village]
        [capture_village]
            x="6,13,14,15,16,20,21,22,23"
	        y="4,8,7-8,8-9,8,7,7-8,6-7,7"
            side=6
        [/capture_village]
        [capture_village]
            x="32,35,42"
	        y="10,8,13"
            side=4
        [/capture_village]
        [capture_village]
            x="16,22"
	        y="15,15"
            side=2
        [/capture_village]

        [recall]
            id=Toruk
            x,y=20,41
            facing=ne
        [/recall]
        [recall]
            id=Stuurg
            x,y=22,41
            facing=ne
        [/recall]
        [hide_unit]
            id=Stuurg
        [/hide_unit]
        [recall]
            id=Grokutin
            x,y=21,34
            facing=ne
        [/recall]
        [recall]
            id=Progho
            x,y=16,37
            facing=ne
        [/recall]
        [recall]
            id=Naga
            x,y=19,33
            facing=ne
        [/recall]

        [micro_ai] #Lethir doesn't leave his post
            side=6
            ai_type=zone_guardian
            action=add

            id=Lethir
            [filter_location]
                x,y=19,5
            [/filter_location]
        [/micro_ai]

        [objectives]

            [objective]
                description= _ "Survive the overwhelming elvish attack"
                condition=win
                [show_if]
                    [not]
                        [have_unit]
                            id=Logalmier
                        [/have_unit]
                    [/not]
                    [and]
                        [variable]
                            name=kill_zofaria
                            not_equals=yes
                        [/variable]
                    [/and]
                [/show_if]
            [/objective]

            [objective]
                description= _ "Kill Zofaria"
                condition=win
                [show_if]
                    [variable]
                        name=kill_zofaria
                        equals=yes
                    [/variable]
                    [and]
                        [have_unit]
                            id=Zofaria
                        [/have_unit]
                    [/and]
                [/show_if]
            [/objective]

            [objective]
                description= _ "Kill all Elvish Zealots"
                condition=win
                [show_if]
                    [have_unit]
                        type=RTL Elvish Zealot
                        side=2
                    [/have_unit]
                [/show_if]
            [/objective]

            [objective]
                description= _ "Stuurg escapes north (reaches the bottom of the map)"
                condition=win
                [show_if]
                    [have_unit]
                        id=Lord Logalmier
                    [/have_unit]
                    [and]
                        [have_unit]
                            id=Stuurg
                        [/have_unit]
                    [/and]
                [/show_if]
            [/objective]

            [objective]
                description= _ "Toruk escapes north (reaches the bottom of the map)"
                condition=win
                [show_if]
                    [have_unit]
                        id=Lord Logalmier
                    [/have_unit]
                    [and]
                        [have_unit]
                            id=Toruk
                        [/have_unit]
                    [/and]
                [/show_if]
            [/objective]

            [objective]
                description= _ "Wait in the fortress for Lord Logalmier"
                condition=win
                [show_if]
                    [variable]
                        name=last_stand
                        greater_than=1
                    [/variable]
                [/show_if]
            [/objective]

            [objective]
                description= _ "Elves capture one of the villages in your fortress"
                condition=lose
                [show_if]
                    [not]
                        [have_unit]
                            id=Lord Logalmier
                        [/have_unit]
                    [/not]
                [/show_if]
            [/objective]

            [objective]
                description= _ "Death of Arshag"
                condition=lose
            [/objective]

            [objective]
                description= _ "Death of Stuurg"
                condition=lose
                [show_if]
                    [have_unit]
                        id=Stuurg
                    [/have_unit]
                [/show_if]
            [/objective]

            [objective]
                description= _ "Death of Toruk"
                condition=lose
                [show_if]
                    [have_unit]
                        id=Toruk
                    [/have_unit]
                [/show_if]
            [/objective]

            {HINT "This map has the lower side facing north and the upper side facing south."}

            {IS_LAST_SCENARIO}

        [/objectives]

    [/event]

    [event] #todo: add some dialogue for Toruk
        name=start
        [message]
            speaker=Leras
            message= _ "They are forming on the other side of the plain. Shall we go on the offensive?"
        [/message]
        [message]
            speaker=Lethir
            message= _ "Lord Logalmier gave us very specific instructions, Leras. We are only to prevent the orcs from scattering to all corners of the north until the main force arrives."
        [/message]
        [message]
            speaker=Tasien
            message= _ "There are far fewer of them than we expected. The winter must have been harsh. I'm sure there are many hiding in the camp, especially the old and the sick."
        [/message]
        [message]
            speaker=Zofaria
            message= _ "That means it will be all the easier to eradicate them."
        [/message]
        [move_unit_fake]
            type=RTL Great Shaman
            side=1
            x=12,22
            y=42,41
        [/move_unit_fake]
        [unhide_unit]
            id=Stuurg
        [/unhide_unit]
        [message]
            speaker=Arshag
            message= _ "Stuurg, you're back? How did it go?"
        [/message]
        [message]
            speaker=Stuurg
            message= _ "Our rituals worked. We managed to fight off the last of the spring frosts and melted the snow.

What about you? I see the ranks are already forming."
        [/message]
        [message]
            speaker=Arshag
            message= _ "I'm trying to force a battle on the elves before Logalmier arrives.
            
I thought it best to do it at night, when we hold an advantage."
        [/message]
        [message]
            speaker=Stuurg
            message= _ "There are lot of elves already. It's going to be a massacre."
        [/message]
        [message]
            speaker=Arshag
            message= _ "I know, but Logalmier gave us no choice."
        [/message]
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x="11,12,13,14,15,16,17,18,19,20,21,22,23,24,25"
	        y="3-5,2-7,2-8,1-8,1-9,1-8,1-9,1-9,1-11,1-11,1-12,1-11,2-11,2-10,3-10"
        [/filter]
        [filter_condition]
            variable=lethir_triggered
            not_equals=yes
        [/filter_condition]
        [store_unit]
            [filter]
                side=1
                x="11,12,13,14,15,16,17,18,19,20,21,22,23,24,25"
                y="3-5,2-7,2-8,1-8,1-9,1-8,1-9,1-9,1-11,1-11,1-12,1-11,2-11,2-10,3-10"
            [/filter]
            variable=intruder
        [/store_unit]
        [message]
            speaker=Arshag
            message= _ "Don't push so close to the elvish camp! We could provoke an attack of their reserve."
        [/message]
        {VARIABLE lethir_triggered yes}
    [/event]

    [event]
        name=moveto
        [filter]
            side=1
            x="11,12,13,14,15,16,17,18,19,20,21,22,23,24,25"
	        y="3-5,2-7,2-8,1-8,1-9,1-8,1-9,1-9,1-11,1-11,1-12,1-11,2-11,2-10,3-10"
            [not]
                id=$intruder.id
            [/not]
        [/filter]
        [filter_condition]
            variable=lethir_triggered
            equals=yes
        [/filter_condition]
        [message]
            speaker=Lethir
            message= _ "The orcs are preparing to attack our camp! Prepare to defend yourselves."
        [/message]
        [unit]
            type=Elvish Champion
            placement=leader
            side=6
        [/unit]
        [unit]
            type=Elvish Avenger
            placement=leader
            side=6
        [/unit]
        [unit]
            type=Elvish Champion
            placement=leader
            side=6
        [/unit]
        [unit]
            type=Elvish Avenger
            placement=leader
            side=6
        [/unit]
        [gold]
            amount=220
            side=6
        [/gold]
    [/event]

    [event] #Zofaria is provoked
        name=recruit
        [filter]
            side=2
        [/filter]
        [message]
            speaker=Lethir
            message= _ "Zofaria, what are you doing?"
        [/message]
        [message]
            speaker=Zofaria
            message= _ "What do you think? I'm sending reinforcements."
        [/message]
        [message]
            speaker=Lethir
            message= _ "But Logalmier made it clear that -"
        [/message]
        [message]
            speaker=Zofaria
            message= _ "There's no point in waiting for the main army to arrive. I have a new spell that will turn the tide of this battle.

Let <i>me</i> deal with Logalmier."
        [/message]
    [/event]

    [event] #if Zofaria has a shaman and a fighter in her castle, she turns them into more Zealots
        name=side 2 turn
        first_time_only=no

        [filter_condition]
            [have_unit]
                type=Elvish Shaman
                side=2
                x="14,15,15,16"
	            y="12-13,12,14,12-13"
                [filter_location]
                    time_of_day=chaotic
                [/filter_location]
            [/have_unit]
            [and]
                [have_unit]
                    type=Elvish Fighter
                    side=2
                    x="14,15,15,16"
                    y="12-13,12,14,12-13"
                [/have_unit]
            [/and]
            [and]
                [have_unit]
                    id=Zofaria
                    x="14,15,15,16"
                    y="12-13,12,14,12-13"
                [/have_unit]
            [/and]
            [and]
                [variable]
                    name=create_zealots
                    equals=yes
                [/variable]
            [/and]
        [/filter_condition]

        {ASSIGN_ROLES_TO_THE_ELVES}
        {MOVE_UNIT x,y=15,13 14 15}
        {VARIABLE zealot_creation 1}

        [while]
            [have_unit]
                type=Elvish Shaman
                side=2
                x="14,15,15,16"
	            y="12-13,12,14,12-13"
            [/have_unit]
            [and]
                [have_unit]
                    type=Elvish Fighter
                    side=2
                    x="14,15,15,16"
                    y="12-13,12,14,12-13"
                [/have_unit]
            [/and]
            [and]
                [variable]
                    name=zealot_creation
                    less_than=7
                [/variable]
            [/and]
            [do]
                [if]
                    [have_unit]
                        role=ritual$zealot_creation
                        type=Elvish Shaman
                    [/have_unit]
                    [then]
                        [move_unit]
                            side=2
                            type=Elvish Fighter
                            x="14,15,15,16"
                            y="12-13,12,14,12-13"
                            to_x=15
                            to_y=13
                        [/move_unit]

                        [animate_unit]
                            flag=attack
                            [filter]
                                id=Zofaria
                            [/filter]
                            [facing]
                                x,y=15,13
                            [/facing]
                            [primary_attack]
                                name=shadow wave
                            [/primary_attack]
                            hits=yes
                        [/animate_unit]

                        {ADVANCE_UNIT x,y=15,13 "Elvish Fighter"}

                        [modify_unit]
                            [filter]
                                role=ritual$zealot_creation
                            [/filter]
                            [object]
                                [effect]
                                    apply_to=new_animation
                                    [attack_anim]
                                        [filter_attack]
                                            name=entangle
                                        [/filter_attack]
                                        {MISSILE_FRAME_FAERIE_FIRE}
                                        missile_start_time=-200
                                        {SOUND:HIT_AND_MISS magic-faeriefire.ogg magic-faeriefire-miss.ogg -450}
                                        start_time=-450
                                        [frame]
                                            image="units/elves-wood/shaman.png:225,units/elves-wood/shaman-attack2.png:225,units/elves-wood/shaman.png:100"
                                            halo=halo/elven/nature-halo[1~6].png:75,halo/elven/nature-halo[7~8].png:50
                                            halo_x,halo_y=0,-12
                                        [/frame]
                                        [frame]
                                            image="units/elves-wood/shaman.png:50"
                                        [/frame]
                                    [/attack_anim]
                                [/effect]
                            [/object]
                        [/modify_unit]

                        [animate_unit]
                            flag=attack
                            [filter]
                                role=ritual$zealot_creation
                                x="14,15,15,16"
                                y="12-13,12,14,12-13"
                            [/filter]
                            [facing]
                                x,y=15,13
                            [/facing]
                            [primary_attack]
                                range=ranged
                            [/primary_attack]
                            hits=yes
                        [/animate_unit]

                        {ADVANCE_UNIT x,y=15,13 "RTL Elvish Zealot"}

                        [modify_unit]
                            [filter]
                                x,y=15,13
                            [/filter]
                            [object]
                                id=zealot_mark
                                [effect]
                                    apply_to=overlay
                                    add="misc/slay-icon.png"
                                [/effect]
                            [/object]
                        [/modify_unit]

                        [store_unit]
                            [filter]
                                role=ritual$zealot_creation
                            [/filter]
                            variable=shaman_hex
                            role=ritual$zealot_creation
                        [/store_unit]

                        [kill]
                            animate=yes
                            role=ritual$zealot_creation
                            x="14,15,15,16"
                            y="12-13,12,14,12-13"
                        [/kill]

                        {MOVE_UNIT x,y=15,13 $shaman_hex.x $shaman_hex.y}
                    [/then]
                [/if]
                {VARIABLE_OP zealot_creation add 1}
            [/do]
        [/while]
        [modify_unit]
            [filter]
                x="14,15,15,16"
                y="12-13,12,14,12-13"
                side=2
            [/filter]
            role=""
        [/modify_unit]
        {CLEAR_VARIABLE zealot_creation}
    [/event]

    [event] #enemy enters the camp and finds out most of the orcs are gone
        name=moveto
        [filter]
            x="18,19,20,21,22,23,24"
	        y="37-38,37-39,36-39,36-39,36-39,37-39,37-38"
            [not]
                side=1
            [/not]
        [/filter]
        [if]
            [have_unit]
                id=Lord Logalmier
            [/have_unit]
            [then]
                [message]
                    speaker=unit
                    message= _ "The tent is... empty?!"
                [/message]
                [message]
                    speaker=Lord Logalmier
                    message= _ "This is Arshag's doing!

That's why the orcish army is so small! They're just trying to hold us back while the rest of them run north!

Nobody kill that orc. I'll deal with him personally."
                [/message]
                {VARIABLE tent yes}
            [/then]
            [else]
                [message]
                    speaker=unit
                    message= _ "The tent is... empty?!"
                [/message]
                [message]
                    speaker=Arshag
                    message= _ "Now they'll see through our ruse! All is lost!"
                [/message]
                [endlevel]
                    result=defeat
                [/endlevel]
            [/else]
        [/if]
    [/event]

    [event] #Zofaria starts recruiting the Zealots
        name=side 2 turn 7
        [filter_condition]
            [have_unit]
                id=Zofaria
                x="14,15,15,16"
                y="12-13,12,14,12-13"
            [/have_unit]
        [/filter_condition]

        [if]
            [have_unit]
                [not]
                    id=Zofaria
                [/not]
                side=2,3,4,6
                x="13,14,15,16,17"
	            y="12-14,11-14,11-15,11-14,12-14"
            [/have_unit]
            [then]
                [move_unit] #todo: what if the player reaches the castle at his turn 7?
                    [not]
                        id=Zofaria
                    [/not]
                    side=2,3,4,6
                    x="13,14,15,16,17"
	                y="12-14,11-14,11-15,11-14,12-14"
                    to_x=18
                    to_y=14
                [/move_unit]
            [/then]
        [/if]

        {MOVE_UNIT id=Zofaria 15 12}

        [message]
            speaker=Zofaria
            message= _ "I'm starting to lose patience with these orcs.

My faithful, are you willing to make the sacrifice for our victory?"
        [/message]
        {VARIABLE create_zealots yes}
#ifdef NORMAL
#else
        {NAMED_LOYAL_UNIT 2 (Elvish Fighter) 15 14 (Fighter1) ( _ "Hafil-Al")}
        {NAMED_LOYAL_UNIT 2 (Elvish Shaman) 15 15 (Shaman1) ( _ "Vivya")}
#endif
#ifdef EASY
#else
        {NAMED_LOYAL_UNIT 2 (Elvish Fighter) 14 13 (Fighter2) ( _ "LÃ³nol")}
        {NAMED_LOYAL_UNIT 2 (Elvish Shaman) 14 12 (Shaman2) ( _ "Mipya")}
        {NAMED_LOYAL_UNIT 2 (Elvish Fighter) 16 13 (Fighter3) ( _ "Pethal")}
        {NAMED_LOYAL_UNIT 2 (Elvish Shaman) 16 12 (Shaman3) ( _ "Faeme")}
#endif
        [message]
#ifdef NORMAL
            speaker=Fighter2
#else
            speaker=Fighter1
#endif
            message= _ "We are willing."
        [/message]
#ifdef NORMAL
        {VARIABLE zealot_creation 2}
#else
        {VARIABLE zealot_creation 1}
#endif
        [animate_unit]
            flag=attack
            [filter]
                id=Zofaria
            [/filter]
            [facing]
                x,y=15,13
            [/facing]
            [primary_attack]
                name=shadow wave
            [/primary_attack]
            hits=yes
        [/animate_unit]
        {ADVANCE_UNIT id=Fighter1 "Elvish Fighter"}
        {ADVANCE_UNIT id=Fighter2 "Elvish Fighter"}
        {ADVANCE_UNIT id=Fighter3 "Elvish Fighter"}
        [while]
            [variable]
                name=zealot_creation
                less_than=4
            [/variable]
            [do]
                [modify_unit]
                    [filter]
                        id=Shaman$zealot_creation
                    [/filter]
                    [object]
                        [effect]
                            apply_to=new_animation
                            [attack_anim]
                                [filter_attack]
                                    name=entangle
                                [/filter_attack]
                                {MISSILE_FRAME_FAERIE_FIRE}
                                missile_start_time=-200
                                {SOUND:HIT_AND_MISS magic-faeriefire.ogg magic-faeriefire-miss.ogg -450}
                                start_time=-450
                                [frame]
                                    image="units/elves-wood/shaman.png:225,units/elves-wood/shaman-attack2.png:225,units/elves-wood/shaman.png:100"
                                    halo=halo/elven/nature-halo[1~6].png:75,halo/elven/nature-halo[7~8].png:50
                                    halo_x,halo_y=0,-12
                                [/frame]
                                [frame]
                                    image="units/elves-wood/shaman.png:50"
                                [/frame]
                            [/attack_anim]
                        [/effect]
                    [/object]
                [/modify_unit]

                [animate_unit]
                    flag=attack
                    [filter]
                        id=Shaman$zealot_creation
                    [/filter]
                    [facing]
                        [filter]
                            id=Fighter$zealot_creation
                        [/filter]
                    [/facing]
                    [primary_attack]
                        range=ranged
                    [/primary_attack]
                    hits=yes
                [/animate_unit]

                {ADVANCE_UNIT id=Fighter$zealot_creation "RTL Elvish Zealot"}

                [kill]
                    animate=yes
                    id=Shaman$zealot_creation
                [/kill]
                {VARIABLE_OP zealot_creation add 1}
            [/do]
        [/while]   
        {CLEAR_VARIABLE zealot_creation}     
        [message]
            speaker=Tasien
            message= _ "Zofaria! You can't be serious.

It's dark magic!"
        [/message]
        [message]
            speaker=Zofaria
            message= _ "It's what we need to finally crush these orcs."
        [/message]
        [if]
            [have_unit]
                id=Lethir
                type=Elvish Outrider
            [/have_unit]
            [then]
                [message]
                    speaker=Tasien
                    message= _ "Lethir, stop her! This is madness!"
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Tasien
                    message= _ "NÃ©rian, stop her! This is madness!"
                [/message]
            [/else]
        [/if]
        [message]
            speaker=Lethir
            message= _ "..."
        [/message]
        [message]
            type_adv_tree=Mermaid Initiate
            message= _ "It's a perversion!

I wouldn't have believed elves were capable of such a thing."
        [/message]
        [message]
            speaker=Tasien
            message= _ "I refuse to be a part of this.
            
Ka'lian will learn what happened here today."
        [/message]
        [message]
            speaker=Lethir
            message= _ "I'm afraid we can't let that happen."
        [/message]
        [message]
            speaker=Arshag
            message= _ "Do not attack Tasien's elves! We're on the same side now."
        [/message]
        [modify_side]
            side=4
            color=brightgreen
            team_name=Orcs
        [/modify_side]
    [/event]

    [event] #the objectives change; now the player has to defeat Zofaria
        name=turn 8
        [message]
            speaker=Toruk
            message= _ "This is even better than we hoped, the elves are turning on each other!"
        [/message]
        {DEAD_TORUK Stuurg "Your plan is working out even better than we expected. The elves are fighting amongst themselves!"}
        [message]
            speaker=Arshag
            message= _ "Not exactly. I don't like her magic-empowered elves at all.

If they survive this trap, they could still pose a danger to our people."
        [/message]
        [message]
            speaker=Stuurg
            message= _ "What do we do then?"
        [/message]
        [message]
            speaker=Arshag
            message= _ "Let's take this opportunity to counterattack.

None of these elvish zealots must make it out alive, especially not Zofaria."
        [/message]
        [message]
            speaker=narrator
            message= _ "Arshag gives the order and throws all his remaining orcs into the fray!"
            sound=horn-signals/horn-2.ogg
            image="portraits/goblins/rouser-2.png"
        [/message]
        [gold]
            side=1
            amount=200
        [/gold]
        {INCIDENTAL_MUSIC northerners.ogg}
        {APPEND_MUSIC northerners.ogg}
        [modify_unit]
            [filter]
                type=RTL Elvish Zealot
                side=2
            [/filter]
            [object]
                [effect]
                    apply_to=overlay
                    add="misc/slay-icon.png"
                [/effect]
            [/object]
        [/modify_unit]
        {VARIABLE kill_zofaria yes}
        {HINT_SLAY}
        [show_objectives]
        [/show_objectives]
    [/event]

    [event] #as the elves kill each other, Vethian grows uncomfortable and finally leaves the battlefield
        id=too_much_kinslaying
        name=die
        first_time_only=no
        [filter]
            race=elf
        [/filter]
        [filter_second]
            race=elf
        [/filter_second]
        {VARIABLE_OP kinslaying add 1}
        [if]
            [variable]
                name=kinslaying
#ifdef EASY
                equals=7
#endif
#ifdef NORMAL
                equals=10
#endif
#ifdef HARD
                equals=12
#endif
            [/variable]
            [then]
                [message]
                    speaker=Vethian
                    message= _ "I can no longer tolerate this senseless bloodshed."
                [/message]
                {MOVE_UNIT id=Vethian 1 14}
                [message]
                    speaker=Lethir
                    message= _ "Vethian! How dare you defy Lord Logalmier's will?

Get back to your position!"
                [/message]
                [message]
                    speaker=Vethian
                    message= _ "..."
                [/message]
                [kill]
                    id=Vethian
                [/kill]
                [store_unit]
                    [filter]
                        side=3
                    [/filter]
                    variable=redistribute_units
                [/store_unit]
                [foreach]
                    array=redistribute_units
                    [do]
                        [set_variable]  
                            name=elvish_side
                            rand=1..12
                        [/set_variable]
                        [if]
                            [variable]
                                name=elvish_side
#ifdef EASY
                                greater_than=4
#endif
#ifdef NORMAL
                                greater_than=6
#endif
#ifdef HARD
                                greater_than=8
#endif
                            [/variable]
                            [then]
                                [modify_unit]
                                    [filter]
                                        id=$this_item.id
                                    [/filter]
                                    side=4
                                [/modify_unit]
                            [/then]
                            [else]
                                [modify_unit]
                                    [filter]
                                        id=$this_item.id
                                    [/filter]
                                    side=6
                                [/modify_unit]
                            [/else]
                        [/if]
                    [/do]
                [/foreach]
                {CLEAR_VARIABLE redistribute_units}
                {CLEAR_VARIABLE elvish_side}
            [/then]
        [/if]          
    [/event]

    [event] #Zofaria dies
        name=last breath
        [filter]
            id=Zofaria
        [/filter]
        [message]
            speaker=Zofaria
            message= _ "It is said that... the Wesfolk once knew... the secret of eternal life.

If only... I could overcome... this mortal shell."
        [/message]
        [message]
            speaker=Arshag
            message= _ "Not today!"
        [/message]
        [kill]
            id=Zofaria
            animate=yes
        [/kill]
        [if]
            [not]
                [have_unit]
                    type=RTL Elvish Zealot
                    side=2
                [/have_unit]
            [/not]
            [then]
                [fire_event]
                    name=big_finale
                [/fire_event]
            [/then]
        [/if]
    [/event]

    [event] #Zealots are all killed
        name=die
        first_time_only=no
        [filter]
            type=RTL Elvish Zealot
            side=2
        [/filter]
        [filter_condition]
            [not]
                [have_unit]
                    type=RTL Elvish Zealot
                    side=2
                [/have_unit]
            [/not]
            [and]
                [not]
                    [have_unit]
                        id=Zofaria
                    [/have_unit]
                [/not]
            [/and]
        [/filter_condition]
        [message]
            speaker=Arshag
            message= _ "That was the last of them!"
        [/message]
        [fire_event]
            name=big_finale
        [/fire_event]
    [/event]

    [event] #Logalmier has to survive to the end
        name=last breath
        first_time_only=no
        [filter]
            id=Lord Logalmier
        [/filter]
        [message]
            speaker=Lord Logalmier
            message= _ "You think you can defeat me, foolish orcs? I'm not even sweating so far..."
        [/message]
        {ADVANCE_UNIT (id="Lord Logalmier") ()}
    [/event]

    [event]
        name=big_finale
        [scroll_to]
            x,y=21,1
        [/scroll_to]
        [sound]
            name=horn-signals/horn-6.ogg
        [/sound]
        [delay]
            time=250
        [/delay]
        [modify_side]
            side=6
            recruit=""
        [/modify_side]
        [unit]
            type=Elvish Champion Kalian
            id=Lord Logalmier
            name=_ "Lord Logalmier"
            canrecruit=yes
            profile="portraits/logalmier.png"
            x,y=21,1
            facing=se
            side=6
        [/unit]

        [if] #Logalmier gets an army if Lethir died in the battle
            [not]
                [have_unit]
                    id=Lethir
                [/have_unit]
            [/not]
            [then]
                [while]
                    [variable]
                        name=elvish_units
                        less_than=10
                    [/variable]
                    [do]

                        [set_variable]
                            name=elvish_army 
                            rand="Rider","Captain","Outrider","Marksman","Sharpshooter","Champion","Avenger","Sorceress","Enchantress","Hero","Ranger"
                        [/set_variable]

                        [unit]
                            type="Elvish $elvish_army|"
                            placement=leader
                            facing=ne
                            side=6
                        [/unit]

                        {VARIABLE_OP elvish_units add 1}

                    [/do]

                [/while]
                {CLEAR_VARIABLE elvish_units}
                {CLEAR_VARIABLE elvish_army}
            [/then]
        [/if]

        [modify_side]
            side=2,3,4,6
            [ai]
                [avoid]
                    radius=0
                    x="20,21,21,22"
	                y="40-41,34,40-42,40-41"
                [/avoid]
            [/ai]
        [/modify_side]

        [modify_ai] #todo: works but units still grab villages for some reason. use micro_ai instead?
            side=6
            action=change
            path=aspect[village_value].facet[default_facet]
            [facet]
                value=0
            [/facet]
        [/modify_ai]
        [modify_ai]
            side=6
            action=change
            path=aspect[scout_village_targeting].facet[default_facet]
            [facet]
                value=0
            [/facet]
        [/modify_ai]

        [micro_ai] #Lethir can now move and attack
            side=6
            ai_type=zone_guardian
            action=delete
        [/micro_ai]

        [micro_ai] #Logalmier goes to Arshag
            side=6
            ai_type=goto
            action=add
            release_unit_at_goal=no
            [filter]
                id=Lord Logalmier
            [/filter]
            [filter_location]
                x=21
	            y=33
            [/filter_location]
            ca_score=200000
        [/micro_ai]

        [if]
            [have_unit]
                id=Lethir
                type=Elvish Outrider
            [/have_unit]
            [then]
                [message]
                    speaker=Lord Logalmier
                    message= _ "Lethir! What is the meaning of this!?

My orders were clear."
                [/message]
                [message]
                    speaker=Lethir
                    message= _ "My lord, Zofaria has decided -"
                [/message]
                [modify_unit]
                    [filter]
                        id=Lethir
                    [/filter]
                    canrecruit=no
                    {TRAIT_LOYAL}
                [/modify_unit]
                [message]
                    speaker=Lord Logalmier
                    message= _ "Silence! I have no time for undignified attempts at excuses.

You are stripped of your rank effective immediately. I'll deal with you once we've crushed the orcs."
                [/message]
            [/then]
            [else]
                [if]
                    [have_unit]
                        id=Lethir
                        type=Elvish Avenger
                    [/have_unit]
                    [then]
                        [message]
                            speaker=Lord Logalmier
                            message= _ "NÃ©rian! What is the meaning of this!?

My orders were clear."
                        [/message]
                        [message]
                            speaker=Lethir
                            message= _ "My lord, Zofaria has decided -"
                        [/message]
                        [modify_unit]
                            [filter]
                                id=Lethir
                            [/filter]
                            canrecruit=no
                            {TRAIT_LOYAL}
                        [/modify_unit]
                        [message]
                            speaker=Lord Logalmier
                            message= _ "Silence! I have no time for undignified attempts at excuses.

You are stripped of your rank effective immediately. I'll deal with you once we've crushed the orcs."
                        [/message]
                    [/then]
                    [else]
                        [message]
                            speaker=Lord Logalmier
                            message= _ "Impressive.

The orcs managed to defeat our vanguard. What a pity it won't do them any good.

Crush them."
                        [/message]
                    [/else]
                [/if]
            [/else]
        [/if]
        
        [message]
            speaker=Stuurg
            message= _ "He's here, Arshag."
        [/message]
        [message]
            speaker=Arshag
            message= _ "How much time do we have?"
        [/message]
        [message]
            speaker=Stuurg
            message= _ "It's very close.

I can see it much more clearly than I did back home."
        [/message]
        [if]
            [have_unit]
                id=Toruk
            [/have_unit]
            [then]
                [message]
                    speaker=Arshag
                    message= _ "Then it's time for you and Toruk to leave."
                [/message]
                [message]
                    speaker=Toruk
                    message= _ "I want to stay with you."
                [/message]
                [message]
                    speaker=Arshag
                    message= _ "That's your right and many have chosen to do so today. But I'm asking you to go.

Your experience will be invaluable to our people for years to come."
                [/message]
                [message]
                    speaker=Toruk
                    message= _ "So would your leadership."
                [/message]
                [message]
                    speaker=Arshag
                    message= _ "Yes, but I <i>must</i> stay. Logalmier wants to get me and I will let him."
                [/message]
                [message]
                    speaker=Toruk
                    message= _ "You were the only one I ever followed with pride. I'll trust your judgement one last time."
                [/message]
                [message]
                    speaker=Arshag
                    message= _ "Goodbye Toruk. Goodbye Stuurg."
                [/message]
                [message]
                    speaker=Stuurg
                    message= _ "We'll remember you, Arshag."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Arshag
                    message= _ "Then it's time for you to leave."
                [/message]
                [message]
                    speaker=Stuurg
                    message= _ "Soon you'll sense it yourself. You're blood of the shaman."
                [/message]
                [message]
                    speaker=Arshag
                    message= _ "Thank you for everything, Stuurg."
                [/message]
                [message]
                    speaker=Stuurg
                    message= _ "I should be the one thanking you. My tribe has found a new home and new allies."
                [/message]
                [message]
                    speaker=Arshag
                    message= _ "And my people, in turn, the wise guidance of the shamans.

I trust that it will endure until one day a new generation of orcish shamans rises again."
                [/message]
                [message]
                    speaker=Stuurg
                    message= _ "I'll always remember you, Arshag."
                [/message]
            [/else]
        [/if]
        [modify_side]
            side=1
            recruit=""
        [/modify_side]
        [kill]
            x=recall
            y=recall
            side=1
        [/kill]
        [message]
            speaker=narrator
            image=wesnoth-icon.png
            message= _ "Arshag has no more reserves and can no longer recruit or recall."
        [/message]
        [show_objectives]
        [/show_objectives]
    [/event]

    [event]
        name=moveto
        [filter]
            id=Stuurg
            y=42
        [/filter]
        [filter_condition]
            [have_unit]
                id=Lord Logalmier
            [/have_unit]
        [/filter_condition]
        [kill]
            id=Stuurg
            animate=no
        [/kill]
        [if]
            [not]
                [have_unit]
                    id=Toruk
                [/have_unit]
            [/not]
            [then]
                {VARIABLE last_stand $turn_number}
                {VARIABLE_OP last_stand add 4}
                [show_objectives][/show_objectives]
                [if]
                    [not]
                        [have_unit]
                            id=Arshag
                            x,y=21,41
                        [/have_unit]
                    [/not]
                    [then]
                        {HIGHLIGHT_IMAGE 21 41 items/gohere.png ()}
                    [/then]
                [/if]
            [/then]
        [/if]
    [/event]

    [event]
        name=moveto
        [filter]
            id=Toruk
            y=42
        [/filter]
        [filter_condition]
            [have_unit]
                id=Lord Logalmier
            [/have_unit]
        [/filter_condition]
        [kill]
            id=Toruk
            animate=no
        [/kill]
        [if]
            [not]
                [have_unit]
                    id=Stuurg
                [/have_unit]
            [/not]
            [then]
                {VARIABLE last_stand $turn_number}
                {VARIABLE_OP last_stand add 4}
                [show_objectives][/show_objectives]
                [if]
                    [not]
                        [have_unit]
                            id=Arshag
                            x,y=21,41
                        [/have_unit]
                    [/not]
                    [then]
                        {HIGHLIGHT_IMAGE 21 41 items/gohere.png ()}
                    [/then]
                [/if]
            [/then]
        [/if]
    [/event]

    [event]
        name=exit_hex
        first_time_only=no
        [filter]
            id=Arshag
            x,y=21,41
        [/filter]
        [filter_condition]
            [variable]
                name=last_stand
                greater_than=1
            [/variable]
        [/filter_condition]
        {HIGHLIGHT_IMAGE 21 41 items/gohere.png ()}
    [/event]

    [event]
        name=enter_hex
        first_time_only=no
        [filter]
            id=Arshag
            x,y=21,41
        [/filter]
        [filter_condition]
            [variable]
                name=last_stand
                greater_than=1
            [/variable]
        [/filter_condition]
        [remove_item]
            x,y=21,41
        [/remove_item]
    [/event]

    [event]
        name=turn $($last_stand| - 3)
        {ERUPTION}
        [message]
            race=elf
            [not]
                id=Lord Logalmier
            [/not]
            message= _ "It's the mountain to the south! It's belching smoke and flames!"
        [/message]
        [message]
            speaker=Lord Logalmier
            message= _ "Stay focused!

The volcano is too far away to pose a threat to us. Even the earthquake has subsided."
        [/message]
        [if]
            [have_unit]
                id=Grokutin
            [/have_unit]
            [then]
                [message]
                    speaker=Grokutin
                    message= _ "I do hope my father had managed to ensure everyone's safety."
                [/message]
                [message]
                    speaker=Arshag
                    message= _ "It's time for you to get back to him, Grokutin. Thank you for all you've done for us."
                [/message]
                [message]
                    speaker=Grokutin
                    message= _ "For now I shall merely ascend to a higher altitude.
Though you are not a drake, your scheme is so cunning that I must commit it to my Spoken Memory."
                [/message]
                [message]
                    speaker=Arshag
                    message= _ "Goodbye, Grokutin."
                [/message]
                {MOVE_UNIT id=Grokutin 21 42}
                [kill]
                    id=Grokutin
                [/kill]
            [/then]
        [/if]
    [/event]

    [event]
        name=turn $($last_stand| - 2)
        {TSUNAMI_1}
        [message]
            race=merman
            message= _ "The water is receding from the shores!"
        [/message]
    [/event]

    [event]
        name=turn $($last_stand| - 1)
        {TSUNAMI_2}
    [/event]

    [event]
        name=turn $last_stand

        #todo: side 1 unit could get killed if it stands on Logalmier's hex instead of just moving away
        [remove_item]
            x,y=21,41
        [/remove_item]
        [move_unit]
            [not]
                id=Arshag
            [/not]
            x,y=21,41
            to_x=30
            to_y=40
        [/move_unit]
        {MOVE_UNIT id=Arshag 21 41}
        {MOVE_UNIT x,y=21,34 26 31}
        {MOVE_UNIT id="Lord Logalmier" 21 34}

        [scroll_to]
            x,y=21,42
        [/scroll_to]

        [if]
            [variable]
                name=tent
                equals=yes
            [/variable]
            [then]
                [message]
                    speaker=Lord Logalmier
                    message= _ "It seems I've finally cornered you, Arshag.

I know you are playing for time."
                [/message]
            [/then]
            [else]
                [message]
                    speaker=Lord Logalmier
                    message= _ "I can see from here that all the tents are empty.
                    
You've sent most of your people away hoping you'll keep me as long as possible."
                [/message]
            [/else]
        [/if]

        [message]
            speaker=Lord Logalmier
            message= _ "But it doesn't help anything.

The orcs have a head start, but they'll have to travel slowly because of the old and sick. They won't be able to face this army when I catch up with them."
        [/message]

        [message]
            speaker=Arshag
            message= _ "You won't."
        [/message]

        {REPLACE_SCENARIO_MUSIC sad.ogg}

        [message]
            speaker=Arshag
            message= _ "It's here.
            
Even I can feel it now. Just as Stuurg said."
        [/message]

        [message]
            speaker=Lord Logalmier
            message= _ "Feel what?"
        [/message]

        [message]
            race=elf
            [not]
                id=Lord Logalmier
            [/not]
            message= _ "My lord! Something's coming!"
        [/message]

        {TSUNAMI_WAVE}

        [delay]
            time=1500
        [/delay]

        [message]
            speaker=Lord Logalmier
            message= _ "How is that possible?

What kind of magic is this?"
        [/message]

        {WAVE_BREAK Wo 26,36 "water-blast.wav"}
        {WAVE_BREAK Wwg 25,36 ""}
        {WAVE_BREAK Wwg 24,40 ""}

        [delay]
            time=500
        [/delay]

        [message]
            speaker=Arshag
            message= _ "Maybe <i>your</i> shamans could have warned you if Zofaria hadn't sucked the life out of them."
        [/message]

        {WAVE_BREAK Ww 17,36 "water-blast.wav"}
        {WAVE_BREAK Ww 16,36 ""}
        {WAVE_BREAK Wwg 18,40 ""}

        [delay]
            time=500
        [/delay]

        [message]
            speaker=Arshag
            message= _ "I didn't use any magic, Logalmier. I merely got your army to the right place."
        [/message]

        {WAVE_BREAK Wo 26,37 "water-blast.wav"}
        {WAVE_BREAK Wo 26,38 ""}
        {WAVE_BREAK Wwg 24,41 ""}
        {WAVE_BREAK Wwg 23,42 ""}

        [delay]
            time=500
        [/delay]

        [message]
            speaker=Lord Logalmier
            message= _ "Do you have any idea what you've done?

An orc can never understand how it feels to see century old lives extinguished by this murderous wave!"
        [/message]

        {WAVE_BREAK Wwg 23,35 "water-blast.wav"}
        {WAVE_BREAK Wwg 22,34 ""}
        {WAVE_BREAK Ww 16,38 ""}
        {WAVE_BREAK Ww 17,39 ""}

        [delay]
            time=500
        [/delay]

        [message]
            speaker=Arshag
            message= _ "Oh, I know."
        [/message]

        [message]
            speaker=Arshag
            message= _ "<i>I am the wave.</i>"
        [/message]

        {WAVE_BREAK Wwg 20,34 "water-blast.wav"}
        {WAVE_BREAK Wwg 22,41 ""}
        {WAVE_BREAK Wwg 21,41 ""}
        {WAVE_BREAK Wwg 20,41 ""}

        {FADE_TO_BLACK_HOLD 2000}
        {PLACE_IMAGE ("units/goblins/impaler-death-9.png~RC(magenta>red)") 23 36}
        {PLACE_IMAGE ("units/goblins/spearman-die-4.png~RC(magenta>red)") 15 38}
        {PLACE_IMAGE ("units/goblins/wolf-rider-die-4.png~RC(magenta>red)") 21 38}
        {PLACE_IMAGE ("units/orcs/assassin-die-10.png~RC(magenta>red)") 26 31}
        {PLACE_IMAGE ("units/orcs/grunt-die-8.png~RC(magenta>red)") 22 36}
        {PLACE_IMAGE ("units/orcs/grunt-ne-die-8.png~RC(magenta>red)") 23 33}
        {PLACE_IMAGE ("units/orcs/grunt-die-sword.png") 22 34}
        {PLACE_IMAGE ("units/woses/wose-die-fall-15.png~RC(magenta>green)") 19 37}
        {PLACE_IMAGE ("units/elves-wood/archer-die4.png~RC(magenta>green)") 22 32}
        {PLACE_IMAGE ("units/elves-wood/marksman-die-5.png~RC(magenta>green)") 21 29}
        {PLACE_IMAGE ("units/elves-wood/sharpshooter-die4.png~RC(magenta>green)") 18 34}
        [replace_schedule]
            {DEFAULT_SCHEDULE_DAWN}
        [/replace_schedule]
        {TSUNAMI_3}
        [terrain]
            terrain=Rb
            layer=base
            [and]
                terrain=*^Fdw
            [/and]
        [/terrain]
        [zoom]
            factor=4
        [/zoom]
        [scroll_to]
            x,y=21,34
        [/scroll_to]
        {FADE_IN}

        [delay]
            time=1000
        [/delay]

        [zoom]
            factor=3
        [/zoom]

        [delay]
            time=1000
        [/delay]

        [zoom]
            factor=2
        [/zoom]

        [delay]
            time=1000
        [/delay]

        [zoom]
            factor=1
        [/zoom]

        [delay]
            time=3000
        [/delay]

        [if]
            [variable]
                name=easter_egg_unlocked
                equals=yes
            [/variable]
            [then]
                {CLEAR_VARIABLE easter_egg_unlocked}
                [endlevel]
                    result=victory
                    next_scenario=EE_Secret_Bossfight
                    bonus=no
                    {NEW_GOLD_CARRYOVER 0}
                [/endlevel]
            [/then]
            [else]
                [endlevel]
                    result=victory
                    bonus=no
                    {NEW_GOLD_CARRYOVER 0}
                    end_text="Thank you for playing"
                [/endlevel]
            [/else]
        [/if]
    [/event]

    [event]
        name=turn $zofaria_money
        first_time_only=no

        [filter_condition]
            [have_unit]
                id=Zofaria
            [/have_unit]
        [/filter_condition]

        {VARIABLE_OP zofaria_money add 6}

        [gold]
            side=2
            amount=120
        [/gold]
    [/event]

    #[event] #todo: maybe add a death message to Lethir(s)?
    #    name=last breath
    #    [filter]
    #        id=Lethir
    #    [/filter]
#
    #[/event]

    [event] #a hacky way to make the empowers ability work properly
        name=side 1 turn end
        first_time_only=no

        [modify_unit]
            [filter]
                type=RTL Elvish Zealot
            [/filter]
            [status]
                poisoned=no
            [/status]
        [/modify_unit]
    [/event]

    [event] #Tasien dies
        name=last breath
        [filter]
            id=Tasien
        [/filter]
        [message]
            speaker=Tasien
            message= _ "Better to die than be consumed by dark magic."
        [/message]
        [kill]
            id=Tasien
            animate=yes
        [/kill]
        [if]
            [variable]
                name=kinslaying
#ifdef EASY
                less_than=7
#endif
#ifdef NORMAL
                less_than=10
#endif
#ifdef HARD
                less_than=12
#endif
            [/variable]
            [then]
                [message]
                    speaker=Vethian
                    message= _ "I can no longer tolerate this senseless bloodshed."
                [/message]
                {MOVE_UNIT id=Vethian 1 14}
                [message]
                    speaker=Lethir
                    message= _ "Vethian! How dare you defy Lord Logalmier's will?

Get back to your position!"
                [/message]
                [message]
                    speaker=Vethian
                    message= _ "..."
                [/message]
                [kill]
                    id=Vethian
                [/kill]
                [store_unit]
                    [filter]
                        side=3
                    [/filter]
                    variable=redistribute_units
                [/store_unit]
                [foreach]
                    array=redistribute_units
                    [do]
                        [set_variable]  
                            name=elvish_side
                            rand=1..12
                        [/set_variable]
                        [if]
                            [variable]
                                name=elvish_side
#ifdef EASY
                                greater_than=4
#endif
#ifdef NORMAL
                                greater_than=6
#endif
#ifdef HARD
                                greater_than=8
#endif
                            [/variable]
                            [then]
                                [modify_unit]
                                    [filter]
                                        id=$this_item.id
                                    [/filter]
                                    side=4
                                [/modify_unit]
                            [/then]
                            [else]
                                [modify_unit]
                                    [filter]
                                        id=$this_item.id
                                    [/filter]
                                    side=6
                                [/modify_unit]
                            [/else]
                        [/if]
                    [/do]
                [/foreach]
                {CLEAR_VARIABLE redistribute_units}
                {CLEAR_VARIABLE elvish_side}
            [/then]
        [/if]
        [remove_event]
            id=too_much_kinslaying
        [/remove_event]
    [/event]


[/scenario]
